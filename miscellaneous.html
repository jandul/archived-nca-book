<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Miscellaneous | Advances in Necessary Condition Analysis</title>
  <meta name="description" content="Necessary Condition Analysis (NCA) is an emerging research method that is based on necessity logic. If a condition is not present, the outcome will not exist. Other factors cannot compensate for its absence. This is different from common causal reasoning where factors produce the outcome and can be compensated. The book intends to support users, readers and reviewers of NCA to better understand the method." />
  <meta name="generator" content="bookdown 0.46 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Miscellaneous | Advances in Necessary Condition Analysis" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://bookdown.org/ncabook/advanced_nca2//Image/cover2b.png" />
  <meta property="og:description" content="Necessary Condition Analysis (NCA) is an emerging research method that is based on necessity logic. If a condition is not present, the outcome will not exist. Other factors cannot compensate for its absence. This is different from common causal reasoning where factors produce the outcome and can be compensated. The book intends to support users, readers and reviewers of NCA to better understand the method." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Miscellaneous | Advances in Necessary Condition Analysis" />
  
  <meta name="twitter:description" content="Necessary Condition Analysis (NCA) is an emerging research method that is based on necessity logic. If a condition is not present, the outcome will not exist. Other factors cannot compensate for its absence. This is different from common causal reasoning where factors produce the outcome and can be compensated. The book intends to support users, readers and reviewers of NCA to better understand the method." />
  <meta name="twitter:image" content="https://bookdown.org/ncabook/advanced_nca2//Image/cover2b.png" />




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="statistical.html"/>
<link rel="next" href="glossary.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.33/datatables.js"></script>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
|<img src="logoNCA.png" width="270" height="270">
<li><a href="./">Advances in NCA</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>1</b> Summary of NCA</a>
<ul>
<li class="chapter" data-level="1.1" data-path="summary.html"><a href="summary.html#standalone"><i class="fa fa-check"></i><b>1.1</b> NCA as stand-alone method</a></li>
<li class="chapter" data-level="1.2" data-path="summary.html"><a href="summary.html#complementary"><i class="fa fa-check"></i><b>1.2</b> NCA as a complementary method</a></li>
<li class="chapter" data-level="1.3" data-path="summary.html"><a href="summary.html#formulate"><i class="fa fa-check"></i><b>1.3</b> Formulate the necessary condition hypothesis</a></li>
<li class="chapter" data-level="1.4" data-path="summary.html"><a href="summary.html#collect"><i class="fa fa-check"></i><b>1.4</b> Collect the data</a></li>
<li class="chapter" data-level="1.5" data-path="summary.html"><a href="summary.html#dataanalysissummary"><i class="fa fa-check"></i><b>1.5</b> Analyse the data</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="summary.html"><a href="summary.html#prepare-the-analysis"><i class="fa fa-check"></i><b>1.5.1</b> Prepare the analysis</a></li>
<li class="chapter" data-level="1.5.2" data-path="summary.html"><a href="summary.html#load-the-data"><i class="fa fa-check"></i><b>1.5.2</b> Load the data</a></li>
<li class="chapter" data-level="1.5.3" data-path="summary.html"><a href="summary.html#estimate-effect-size-and-the-p-value-with-nca_analysis"><i class="fa fa-check"></i><b>1.5.3</b> Estimate effect size and the p value with <code>nca_analysis</code></a></li>
<li class="chapter" data-level="1.5.4" data-path="summary.html"><a href="summary.html#create-output-with-nca_output"><i class="fa fa-check"></i><b>1.5.4</b> Create output with <code>nca_output</code></a></li>
<li class="chapter" data-level="1.5.5" data-path="summary.html"><a href="summary.html#summarybottleneck"><i class="fa fa-check"></i><b>1.5.5</b> Perform the bottleneck analysis with <code>nca_output</code></a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="summary.html"><a href="summary.html#report"><i class="fa fa-check"></i><b>1.6</b> Report the results</a></li>
<li class="chapter" data-level="1.7" data-path="summary.html"><a href="summary.html#guidelines"><i class="fa fa-check"></i><b>1.7</b> Basic guidelines for good NCA practice</a></li>
<li class="chapter" data-level="1.8" data-path="summary.html"><a href="summary.html#review"><i class="fa fa-check"></i><b>1.8</b> SCoRe-NCA. A checklist for reviewing an NCA publication</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="theory.html"><a href="theory.html"><i class="fa fa-check"></i><b>2</b> Theory</a>
<ul>
<li class="chapter" data-level="2.1" data-path="theory.html"><a href="theory.html#partstheory"><i class="fa fa-check"></i><b>2.1</b> The four parts of a theory</a></li>
<li class="chapter" data-level="2.2" data-path="theory.html"><a href="theory.html#formulationnecessity"><i class="fa fa-check"></i><b>2.2</b> Formulation of necessity hypotheses</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="theory.html"><a href="theory.html#sources"><i class="fa fa-check"></i><b>2.2.1</b> Sources with potential necessary conditions</a></li>
<li class="chapter" data-level="2.2.2" data-path="theory.html"><a href="theory.html#thoughtexperiment"><i class="fa fa-check"></i><b>2.2.2</b> Thought experiment</a></li>
<li class="chapter" data-level="2.2.3" data-path="theory.html"><a href="theory.html#direction"><i class="fa fa-check"></i><b>2.2.3</b> Direction of necessity</a></li>
<li class="chapter" data-level="2.2.4" data-path="theory.html"><a href="theory.html#relatedmultiple"><i class="fa fa-check"></i><b>2.2.4</b> Related multiple necessary conditions</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="theory.html"><a href="theory.html#justificationnecessity"><i class="fa fa-check"></i><b>2.3</b> Justification of necessity hypotheses</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="theory.html"><a href="theory.html#temporalorder"><i class="fa fa-check"></i><b>2.3.1</b> Temporal order</a></li>
<li class="chapter" data-level="2.3.2" data-path="theory.html"><a href="theory.html#causalmechanism"><i class="fa fa-check"></i><b>2.3.2</b> Causal mechinism</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="theory.html"><a href="theory.html#theoreticalcontribution"><i class="fa fa-check"></i><b>2.4</b> Theoretical contribution</a></li>
<li class="chapter" data-level="2.5" data-path="theory.html"><a href="theory.html#theorytypes"><i class="fa fa-check"></i><b>2.5</b> Types of necessity theories</a></li>
<li class="chapter" data-level="2.6" data-path="theory.html"><a href="theory.html#morecorners"><i class="fa fa-check"></i><b>2.6</b> Two empty corners</a></li>
<li class="chapter" data-level="2.7" data-path="theory.html"><a href="theory.html#necessarybutnotsufficient"><i class="fa fa-check"></i><b>2.7</b> The meaning of ‘necessary but not sufficient’</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>3</b> Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data.html"><a href="data.html#transformation"><i class="fa fa-check"></i><b>3.1</b> Data transformation</a></li>
<li class="chapter" data-level="3.2" data-path="data.html"><a href="data.html#experiment"><i class="fa fa-check"></i><b>3.2</b> Experiment</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data.html"><a href="data.html#the-traditional-experiment"><i class="fa fa-check"></i><b>3.2.1</b> The traditional experiment</a></li>
<li class="chapter" data-level="3.2.2" data-path="data.html"><a href="data.html#necessityexperiment"><i class="fa fa-check"></i><b>3.2.2</b> The necessity experiment</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data.html"><a href="data.html#samplesize"><i class="fa fa-check"></i><b>3.3</b> Sample size</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="data.html"><a href="data.html#smalln"><i class="fa fa-check"></i><b>3.3.1</b> Small N studies</a></li>
<li class="chapter" data-level="3.3.2" data-path="data.html"><a href="data.html#largen"><i class="fa fa-check"></i><b>3.3.2</b> Large N studies</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data.html"><a href="data.html#quantitative"><i class="fa fa-check"></i><b>3.4</b> Quantitative data</a></li>
<li class="chapter" data-level="3.5" data-path="data.html"><a href="data.html#qualitative"><i class="fa fa-check"></i><b>3.5</b> Qualitative data</a></li>
<li class="chapter" data-level="3.6" data-path="data.html"><a href="data.html#longitudinal"><i class="fa fa-check"></i><b>3.6</b> Longitudinal, panel and time-series data</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="data.html"><a href="data.html#pooled"><i class="fa fa-check"></i><b>3.6.1</b> NCA with pooled data</a></li>
<li class="chapter" data-level="3.6.2" data-path="data.html"><a href="data.html#nca-for-describing-time-trends"><i class="fa fa-check"></i><b>3.6.2</b> NCA for describing time trends</a></li>
<li class="chapter" data-level="3.6.3" data-path="data.html"><a href="data.html#interpretation"><i class="fa fa-check"></i><b>3.6.3</b> Interpretation</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="data.html"><a href="data.html#setmembership"><i class="fa fa-check"></i><b>3.7</b> Set membership data</a></li>
<li class="chapter" data-level="3.8" data-path="data.html"><a href="data.html#outliers"><i class="fa fa-check"></i><b>3.8</b> Outliers</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="data.html"><a href="data.html#outliertypes"><i class="fa fa-check"></i><b>3.8.1</b> Outlier types</a></li>
<li class="chapter" data-level="3.8.2" data-path="data.html"><a href="data.html#outlieridentification"><i class="fa fa-check"></i><b>3.8.2</b> Outlier identification</a></li>
<li class="chapter" data-level="3.8.3" data-path="data.html"><a href="data.html#outlierdecisionmaking"><i class="fa fa-check"></i><b>3.8.3</b> Outlier decision approach</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dataanalysis.html"><a href="dataanalysis.html"><i class="fa fa-check"></i><b>4</b> Data analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dataanalysis.html"><a href="dataanalysis.html#visualinspection"><i class="fa fa-check"></i><b>4.1</b> Visual inspection of the scatter plot</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="dataanalysis.html"><a href="dataanalysis.html#is-the-expected-corner-empty"><i class="fa fa-check"></i><b>4.1.1</b> Is the expected corner empty?</a></li>
<li class="chapter" data-level="4.1.2" data-path="dataanalysis.html"><a href="dataanalysis.html#selectioneilingline"><i class="fa fa-check"></i><b>4.1.2</b> What is an appropriate ceiling line?</a></li>
<li class="chapter" data-level="4.1.3" data-path="dataanalysis.html"><a href="dataanalysis.html#what-are-potential-outliers"><i class="fa fa-check"></i><b>4.1.3</b> What are potential outliers?</a></li>
<li class="chapter" data-level="4.1.4" data-path="dataanalysis.html"><a href="dataanalysis.html#what-is-the-data-pattern-in-the-rest-of-plot"><i class="fa fa-check"></i><b>4.1.4</b> What is the data pattern in the rest of plot?</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="dataanalysis.html"><a href="dataanalysis.html#inkind"><i class="fa fa-check"></i><b>4.2</b> The ‘empty space: Necessary condition ’in kind’</a></li>
<li class="chapter" data-level="4.3" data-path="dataanalysis.html"><a href="dataanalysis.html#bottleneck"><i class="fa fa-check"></i><b>4.3</b> The bottleneck table: Necessary conditions ‘in degree’</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="dataanalysis.html"><a href="dataanalysis.html#percentagerange"><i class="fa fa-check"></i><b>4.3.1</b> Levels expressed as percentage of range</a></li>
<li class="chapter" data-level="4.3.2" data-path="dataanalysis.html"><a href="dataanalysis.html#actual"><i class="fa fa-check"></i><b>4.3.2</b> Levels expressed as actual values</a></li>
<li class="chapter" data-level="4.3.3" data-path="dataanalysis.html"><a href="dataanalysis.html#percentile"><i class="fa fa-check"></i><b>4.3.3</b> Levels expressed as percentiles</a></li>
<li class="chapter" data-level="4.3.4" data-path="dataanalysis.html"><a href="dataanalysis.html#percentagemax"><i class="fa fa-check"></i><b>4.3.4</b> Levels expressed as percentage of maximum</a></li>
<li class="chapter" data-level="4.3.5" data-path="dataanalysis.html"><a href="dataanalysis.html#bottleneckothercorners"><i class="fa fa-check"></i><b>4.3.5</b> Interpretation of the bottleneck table with other corners</a></li>
<li class="chapter" data-level="4.3.6" data-path="dataanalysis.html"><a href="dataanalysis.html#na"><i class="fa fa-check"></i><b>4.3.6</b> NN and NA in the bottleneck table</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="dataanalysis.html"><a href="dataanalysis.html#robustnesschecks"><i class="fa fa-check"></i><b>4.4</b> Robustness checks</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="dataanalysis.html"><a href="dataanalysis.html#choiceceiling"><i class="fa fa-check"></i><b>4.4.1</b> Choice of ceiling line</a></li>
<li class="chapter" data-level="4.4.2" data-path="dataanalysis.html"><a href="dataanalysis.html#choiceeffectsize"><i class="fa fa-check"></i><b>4.4.2</b> Choice of the threshold level of the effect size</a></li>
<li class="chapter" data-level="4.4.3" data-path="dataanalysis.html"><a href="dataanalysis.html#choicepvalue"><i class="fa fa-check"></i><b>4.4.3</b> Choice of the threshold level of the p value</a></li>
<li class="chapter" data-level="4.4.4" data-path="dataanalysis.html"><a href="dataanalysis.html#choicescope"><i class="fa fa-check"></i><b>4.4.4</b> Choice of the scope</a></li>
<li class="chapter" data-level="4.4.5" data-path="dataanalysis.html"><a href="dataanalysis.html#choiceoutlier"><i class="fa fa-check"></i><b>4.4.5</b> Choice of outlier removal</a></li>
<li class="chapter" data-level="4.4.6" data-path="dataanalysis.html"><a href="dataanalysis.html#choice-of-target-outcome"><i class="fa fa-check"></i><b>4.4.6</b> Choice of target outcome</a></li>
<li class="chapter" data-level="4.4.7" data-path="dataanalysis.html"><a href="dataanalysis.html#robustnesstable"><i class="fa fa-check"></i><b>4.4.7</b> Robustness table</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="dataanalysis.html"><a href="dataanalysis.html#ncaregression"><i class="fa fa-check"></i><b>4.5</b> Combining NCA with regression analysis</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="dataanalysis.html"><a href="dataanalysis.html#introduction"><i class="fa fa-check"></i><b>4.5.1</b> Introduction</a></li>
<li class="chapter" data-level="4.5.2" data-path="dataanalysis.html"><a href="dataanalysis.html#logic-and-theory"><i class="fa fa-check"></i><b>4.5.2</b> Logic and theory</a></li>
<li class="chapter" data-level="4.5.3" data-path="dataanalysis.html"><a href="dataanalysis.html#data-analysis"><i class="fa fa-check"></i><b>4.5.3</b> Data analysis</a></li>
<li class="chapter" data-level="4.5.4" data-path="dataanalysis.html"><a href="dataanalysis.html#how-to-combine-nca-and-regression"><i class="fa fa-check"></i><b>4.5.4</b> How to combine NCA and regression</a></li>
<li class="chapter" data-level="4.5.5" data-path="dataanalysis.html"><a href="dataanalysis.html#what-is-the-same-in-nca-and-regression"><i class="fa fa-check"></i><b>4.5.5</b> What is the same in NCA and regression?</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="dataanalysis.html"><a href="dataanalysis.html#ncaplssem"><i class="fa fa-check"></i><b>4.6</b> Combining NCA with (PLS-)SEM</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="dataanalysis.html"><a href="dataanalysis.html#stepsncasem"><i class="fa fa-check"></i><b>4.6.1</b> Steps for conducting NCA with SEM</a></li>
<li class="chapter" data-level="4.6.2" data-path="dataanalysis.html"><a href="dataanalysis.html#examplencaplssem"><i class="fa fa-check"></i><b>4.6.2</b> Demonstration of combining NCA and PLS-SEM with R</a></li>
<li class="chapter" data-level="4.6.3" data-path="dataanalysis.html"><a href="dataanalysis.html#recommendations-for-combining-nca-and-pls-sem"><i class="fa fa-check"></i><b>4.6.3</b> Recommendations for combining NCA and (PLS-)SEM</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="dataanalysis.html"><a href="dataanalysis.html#ncaqca"><i class="fa fa-check"></i><b>4.7</b> Combining NCA with QCA</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="dataanalysis.html"><a href="dataanalysis.html#introduction-to-qca"><i class="fa fa-check"></i><b>4.7.1</b> Introduction to QCA</a></li>
<li class="chapter" data-level="4.7.2" data-path="dataanalysis.html"><a href="dataanalysis.html#the-differences-between-nca-and-qca"><i class="fa fa-check"></i><b>4.7.2</b> The differences between NCA and QCA</a></li>
<li class="chapter" data-level="4.7.3" data-path="dataanalysis.html"><a href="dataanalysis.html#recommendation-for-combining-nca-and-qca"><i class="fa fa-check"></i><b>4.7.3</b> Recommendation for combining NCA and QCA</a></li>
<li class="chapter" data-level="4.7.4" data-path="dataanalysis.html"><a href="dataanalysis.html#examples"><i class="fa fa-check"></i><b>4.7.4</b> Examples</a></li>
<li class="chapter" data-level="4.7.5" data-path="dataanalysis.html"><a href="dataanalysis.html#misinterpretationsqca"><i class="fa fa-check"></i><b>4.7.5</b> Logical misinterpretations when combining NCA and QCA</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="dataanalysis.html"><a href="dataanalysis.html#causalinference"><i class="fa fa-check"></i><b>4.8</b> Causal inference</a></li>
<li class="chapter" data-level="4.9" data-path="dataanalysis.html"><a href="dataanalysis.html#metaanalysis"><i class="fa fa-check"></i><b>4.9</b> Meta-analysis</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mathematical.html"><a href="mathematical.html"><i class="fa fa-check"></i><b>5</b> NCA’s mathematical backgrounds</a>
<ul>
<li class="chapter" data-level="5.1" data-path="mathematical.html"><a href="mathematical.html#formalexpression"><i class="fa fa-check"></i><b>5.1</b> Formal mathematical expression</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="mathematical.html"><a href="mathematical.html#effectsize"><i class="fa fa-check"></i><b>5.1.1</b> Effect size</a></li>
<li class="chapter" data-level="5.1.2" data-path="mathematical.html"><a href="mathematical.html#necinefficiency"><i class="fa fa-check"></i><b>5.1.2</b> Necessity inefficiency</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="mathematical.html"><a href="mathematical.html#multiplenca"><i class="fa fa-check"></i><b>5.2</b> Multiple NCA</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="statistical.html"><a href="statistical.html"><i class="fa fa-check"></i><b>6</b> NCA’s statistics</a>
<ul>
<li class="chapter" data-level="6.1" data-path="statistical.html"><a href="statistical.html#ncas-statistical-expression"><i class="fa fa-check"></i><b>6.1</b> NCA’s statistical expression</a></li>
<li class="chapter" data-level="6.2" data-path="statistical.html"><a href="statistical.html#permutationtest"><i class="fa fa-check"></i><b>6.2</b> NCA’s statistical test</a></li>
<li class="chapter" data-level="6.3" data-path="statistical.html"><a href="statistical.html#simulations-with-nca"><i class="fa fa-check"></i><b>6.3</b> Simulations with NCA</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="statistical.html"><a href="statistical.html#requirementssim"><i class="fa fa-check"></i><b>6.3.1</b> Requirements for simulations with NCA</a></li>
<li class="chapter" data-level="6.3.2" data-path="statistical.html"><a href="statistical.html#power"><i class="fa fa-check"></i><b>6.3.2</b> Simulations for estimating the power of NCA’s statistical test</a></li>
<li class="chapter" data-level="6.3.3" data-path="statistical.html"><a href="statistical.html#ceilingquality"><i class="fa fa-check"></i><b>6.3.3</b> Simulations for evaluating a ceiling line and its effect size</a></li>
<li class="chapter" data-level="6.3.4" data-path="statistical.html"><a href="statistical.html#simulations-of-correlation"><i class="fa fa-check"></i><b>6.3.4</b> Simulations of correlation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="miscellaneous.html"><a href="miscellaneous.html"><i class="fa fa-check"></i><b>7</b> Miscellaneous</a>
<ul>
<li class="chapter" data-level="7.1" data-path="miscellaneous.html"><a href="miscellaneous.html#software"><i class="fa fa-check"></i><b>7.1</b> NCA software</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="miscellaneous.html"><a href="miscellaneous.html#rsoftware"><i class="fa fa-check"></i><b>7.1.1</b> Main NCA software: R package</a></li>
<li class="chapter" data-level="7.1.2" data-path="miscellaneous.html"><a href="miscellaneous.html#othersoftware"><i class="fa fa-check"></i><b>7.1.2</b> Other NCA software packages</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="miscellaneous.html"><a href="miscellaneous.html#learning-about-nca"><i class="fa fa-check"></i><b>7.2</b> Learning about NCA</a></li>
<li class="chapter" data-level="7.3" data-path="miscellaneous.html"><a href="miscellaneous.html#hqscatterplots"><i class="fa fa-check"></i><b>7.3</b> Producing high-quality NCA scatter plots</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="miscellaneous.html"><a href="miscellaneous.html#standard-plot"><i class="fa fa-check"></i><b>7.3.1</b> Standard plot</a></li>
<li class="chapter" data-level="7.3.2" data-path="miscellaneous.html"><a href="miscellaneous.html#standard-plot-with-basic-adaptations"><i class="fa fa-check"></i><b>7.3.2</b> Standard plot with basic adaptations</a></li>
<li class="chapter" data-level="7.3.3" data-path="miscellaneous.html"><a href="miscellaneous.html#standard-plot-with-advanced-adaptations"><i class="fa fa-check"></i><b>7.3.3</b> Standard plot with advanced adaptations</a></li>
<li class="chapter" data-level="7.3.4" data-path="miscellaneous.html"><a href="miscellaneous.html#plot-with-plotly"><i class="fa fa-check"></i><b>7.3.4</b> Plot with <code>plotly</code></a></li>
<li class="chapter" data-level="7.3.5" data-path="miscellaneous.html"><a href="miscellaneous.html#plot-with-ggplot"><i class="fa fa-check"></i><b>7.3.5</b> Plot with <code>ggplot</code></a></li>
<li class="chapter" data-level="7.3.6" data-path="miscellaneous.html"><a href="miscellaneous.html#saving-the-plot-from-within-the-r-script"><i class="fa fa-check"></i><b>7.3.6</b> Saving the plot from within the R script</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="miscellaneous.html"><a href="miscellaneous.html#additionalcode"><i class="fa fa-check"></i><b>7.4</b> Additional functions for use with the NCA softare in R (beta)</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="miscellaneous.html"><a href="miscellaneous.html#ncarobustnesstablegeneral"><i class="fa fa-check"></i><b>7.4.1</b> <code>nca_robustness_table_general.R</code></a></li>
<li class="chapter" data-level="7.4.2" data-path="miscellaneous.html"><a href="miscellaneous.html#ncarobustnesschecksgeneral"><i class="fa fa-check"></i><b>7.4.2</b> <code>nca_robustness_checks_general.R</code></a></li>
<li class="chapter" data-level="7.4.3" data-path="miscellaneous.html"><a href="miscellaneous.html#getoutliers"><i class="fa fa-check"></i><b>7.4.3</b> <code>get_outliers.R</code></a></li>
<li class="chapter" data-level="7.4.4" data-path="miscellaneous.html"><a href="miscellaneous.html#getindicatordata"><i class="fa fa-check"></i><b>7.4.4</b> <code>get_indicator_data_TAM.R</code></a></li>
<li class="chapter" data-level="7.4.5" data-path="miscellaneous.html"><a href="miscellaneous.html#estimatesemmodel"><i class="fa fa-check"></i><b>7.4.5</b> <code>estimate_sem_model_TAM.R</code></a></li>
<li class="chapter" data-level="7.4.6" data-path="miscellaneous.html"><a href="miscellaneous.html#significancesem"><i class="fa fa-check"></i><b>7.4.6</b> <code>get_signficance_sem.R</code></a></li>
<li class="chapter" data-level="7.4.7" data-path="miscellaneous.html"><a href="miscellaneous.html#unstandardize"><i class="fa fa-check"></i><b>7.4.7</b> <code>unstandardize.R</code></a></li>
<li class="chapter" data-level="7.4.8" data-path="miscellaneous.html"><a href="miscellaneous.html#normalize"><i class="fa fa-check"></i><b>7.4.8</b> <code>normalize.R</code></a></li>
<li class="chapter" data-level="7.4.9" data-path="miscellaneous.html"><a href="miscellaneous.html#getbottleneckcases"><i class="fa fa-check"></i><b>7.4.9</b> <code>get_bottleneck_cases.R</code></a></li>
<li class="chapter" data-level="7.4.10" data-path="miscellaneous.html"><a href="miscellaneous.html#getipmadf"><i class="fa fa-check"></i><b>7.4.10</b> <code>get_ipma_df.R</code></a></li>
<li class="chapter" data-level="7.4.11" data-path="miscellaneous.html"><a href="miscellaneous.html#getipmaplot"><i class="fa fa-check"></i><b>7.4.11</b> <code>get_ipma_plot.R</code></a></li>
<li class="chapter" data-level="7.4.12" data-path="miscellaneous.html"><a href="miscellaneous.html#getcipmadf"><i class="fa fa-check"></i><b>7.4.12</b> <code>get_cipma_df.R</code></a></li>
<li class="chapter" data-level="7.4.13" data-path="miscellaneous.html"><a href="miscellaneous.html#getcipmaplot"><i class="fa fa-check"></i><b>7.4.13</b> <code>get_cipma_plot.R</code></a></li>
<li class="chapter" data-level="7.4.14" data-path="miscellaneous.html"><a href="miscellaneous.html#getsinglebottleneckcases"><i class="fa fa-check"></i><b>7.4.14</b> <code>get_single_bottleneck_cases.R</code></a></li>
<li class="chapter" data-level="7.4.15" data-path="miscellaneous.html"><a href="miscellaneous.html#getbipmadf"><i class="fa fa-check"></i><b>7.4.15</b> <code>get_bipma_df.R</code></a></li>
<li class="chapter" data-level="7.4.16" data-path="miscellaneous.html"><a href="miscellaneous.html#getbipmaplot"><i class="fa fa-check"></i><b>7.4.16</b> <code>get_bipma_plot.R</code></a></li>
<li class="chapter" data-level="7.4.17" data-path="miscellaneous.html"><a href="miscellaneous.html#ncasem"><i class="fa fa-check"></i><b>7.4.17</b> <code>ncasem.R</code></a></li>
<li class="chapter" data-level="7.4.18" data-path="miscellaneous.html"><a href="miscellaneous.html#ncasemexample"><i class="fa fa-check"></i><b>7.4.18</b> <code>ncasem_example_TAM.R</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html"><i class="fa fa-check"></i>Glossary</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<a href="https://www.erim.eur.nl/necessary-condition-analysis/">
<img alt="erim" src="NCAwebsite2.png" width="270"></a
<a href="https://www.erim.eur.nl/necessary-condition-analysis/" target="blank">NCA website</a></li>
<li><a href="mailto:jdul@rsm.nl">Send email to the author</a>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advances in Necessary Condition Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="miscellaneous" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Miscellaneous<a href="miscellaneous.html#miscellaneous" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="software" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> NCA software<a href="miscellaneous.html#software" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="rsoftware" class="section level3 hasAnchor" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Main NCA software: R package<a href="miscellaneous.html#rsoftware" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The main NCA software is a free package in R called <code>NCA</code><span class="citation">(<a href="#ref-ncar">Dul &amp; Buijs, 2026</a>)</span>.The first version of this software was released in 2015 just before the online publication of NCA’s core paper <span class="citation">(<a href="#ref-dul2016orm">Dul, 2016b</a>)</span> on 15 July, 2015. Since then the software was updated several times to correct bugs, integrate new NCA developments, and make improvements based on feedback from users.
The following versions have been released so far:</p>
<p>NCA_1.0 (2015-07-02)</p>
<p>NCA_1.1 (2015-10-10)</p>
<p>NCA_2.0 (2016-05-18)</p>
<p>NCA_3.0 (2018-08-01)</p>
<p>NCA_3.0.1 (2018-08-21)</p>
<p>NCA_3.0.2 (2019-11-22)</p>
<p>NCA_3.0.3 (2020-06-11)</p>
<p>NCA_3.1.0 (2021-03-02)</p>
<p>NCA_3.1.1 (2021-05-03)</p>
<p>NCA_3.2.0 (2022-04-05)</p>
<p>NCA_3.2.1 (2022-09-15)</p>
<p>NCA_3.3.0 (2023-02-06)</p>
<p>NCA_3.3.1 (2023-02-10)</p>
<p>NCA_3.3.2 (2023-06-27)</p>
<p>NCA_3.3.3 (2023-09-05)</p>
<p>NCA_4.0.0 (2024-02-16)</p>
<p>NCA_4.0.1 (2024-02-23)</p>
<p>NCA_4.0.2 (2024-11-09)</p>
<p>NCA_4.0.3 (2025-10-14)</p>
<p>NCA_4.0.4 (2025-11-14)</p>
<p>NCA_4.0.5 (2025-12-21)</p>
<p>When the first digit of the version number increases, major changes were implemented. Version 1 was the first limited version, version 2 was the first comprehensive version, version 3 includes the statistical test for NCA, and version 4 introduced two new functions <code>nca_random</code> and <code>nca_power</code>. The second digit refers to larger changes and the third digit minor changes.</p>
<p>The currently installed version of the NCA software and the availability of a new version can be checked as follows:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="miscellaneous.html#cb124-1" tabindex="-1"></a><span class="fu">packageVersion</span>(<span class="st">&quot;NCA&quot;</span>) <span class="co"># installed version</span></span>
<span id="cb124-2"><a href="miscellaneous.html#cb124-2" tabindex="-1"></a><span class="fu">available.packages</span>()[<span class="st">&quot;NCA&quot;</span>,<span class="dv">2</span>] <span class="co"># available version</span></span></code></pre></div>
<p>The cumulative number of downloads of the NCA software from the CRAN website are shown in
Figure <a href="miscellaneous.html#fig:downloads">7.1</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:downloads"></span>
<img src="Cumulative.software.downloads.png" alt="Cumulative number of downloads from the CRAN website of the NCA software since its launch)." width="100%" />
<p class="caption">
Figure 7.1: Cumulative number of downloads from the CRAN website of the NCA software since its launch).
</p>
</div>
<p>Until 31 December 2025 the software was downloaded almost 70,000 times.</p>
<!-- The current cumulative number of downloads can be obtained by: -->
<!-- ```{r, warning=FALSE} -->
<!-- library("cranlogs") -->
<!-- x <- cran_downloads(packages = "NCA", from = "2015-07-02", to = Sys.Date()) -->
<!-- cat("total downloads on") -->
<!-- Sys.Date() -->
<!-- tail(cumsum(x[,2]),n=1) -->
<!-- ``` -->
<p>The <a href="https://repub.eur.nl/pub/78323/">Quick Start Guide</a>
(also <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2624981">here</a>)
helps novice users of R and NCA to get started, but the guide also includes more advanced features. The <code>NCA</code> package has a build-in help function with examples. Within R, the help function can be called as follows:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="miscellaneous.html#cb125-1" tabindex="-1"></a><span class="fu">help</span>(<span class="at">package =</span> <span class="st">&quot;NCA&quot;</span>)</span></code></pre></div>
<p>When help is needed for a specific function in <code>NCA</code>, for example <code>nca_analysis</code> the help for this function can be called as follows:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="miscellaneous.html#cb126-1" tabindex="-1"></a><span class="fu">help</span>(<span class="st">&quot;nca_analysis&quot;</span>)</span></code></pre></div>
</div>
<div id="othersoftware" class="section level3 hasAnchor" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Other NCA software packages<a href="miscellaneous.html#othersoftware" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Based on the R package a Stata module is available for conducting NCA <span class="citation">(<a href="#ref-ncastata">Spinelli et al., 2023</a>)</span>. NCA is also part of the SmartPLS software for conducting NCA in combination with PLS-SEM <span class="citation">(<a href="#ref-ncasmartpls">SmartPLS Development Team, 2023</a>)</span>. These versions enable conducting a basic NCA in other software environments than R, but lack more advanced functions and recent developments of NCA.
Currently, no NCA software is available for other platforms like SPSS or SAS.</p>
</div>
</div>
<div id="learning-about-nca" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Learning about NCA<a href="miscellaneous.html#learning-about-nca" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Several possibilities exist to learn about NCA. Apart from reading books and publications about the NCA methodology (Table <a href="index.html#tab:methodspubstable">0.2</a>) and reading publications with examples of NCA applications (Table <a href="index.html#tab:pubstable">0.1</a>) several on site and online courses are available at the introduction and advanced levels.
Major international conferences often host a professional development workshop on site to learn about NCA. An example is annual conference of the the Academy of Management. Also online short introduction courses exist for NCA. An example is a free on-demand introduction seminar hosted by <a href="https://instats.org/seminar/introduction-to-necessary-condition-anal7646">Instats</a>. A longer free introduction MOOC course is available from <a href="https://www.coursera.org/learn/necessary-condition-analysis">Coursera</a>.
At the advanced level, an on-demand course is hosted by <a href="https://instats.org/seminar/necessary-condition-analysis-nca-foun3">Instats</a>. Also an NCA paper development workshop is regularly organized. More information about NCA training and events can be found in the <a href="https://www.erim.eur.nl/necessary-condition-analysis/training-and-events/">NCA website</a>.</p>
</div>
<div id="hqscatterplots" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Producing high-quality NCA scatter plots<a href="miscellaneous.html#hqscatterplots" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One of the primary results of NCA is the ‘NCA plot’, which is a scatter plot with ceiling line(s). Users often wish to save a high quality NCA plot for further use, for example for a publication. There are several ways to make and save a high quality NCA plot. In this section six ways are presented that have different levels of user flexibility:</p>
<ol style="list-style-type: decimal">
<li><p>Standard plot.</p></li>
<li><p>Standard plot with basic adaptations.</p></li>
<li><p>Standard plot with advanced adaptations.</p></li>
<li><p>Advanced plot with <code>plotly</code>.</p></li>
<li><p>Advanced plot with <code>ggplot</code>.</p></li>
<li><p>From within R script.</p></li>
</ol>
<div id="standard-plot" class="section level3 hasAnchor" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Standard plot<a href="miscellaneous.html#standard-plot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When NCA for R is used with RStudio, the standard NCA plot is displayed in the Plots window of RStudio. The plot can be produced with the argument <code>plots = TRUE</code> of the <code>nca_output</code> function. For the example dataset in NCA package, the standard plot can be obtained as follows:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="miscellaneous.html#cb127-1" tabindex="-1"></a><span class="fu">library</span> (NCA)</span>
<span id="cb127-2"><a href="miscellaneous.html#cb127-2" tabindex="-1"></a><span class="fu">data</span>(nca.example)</span>
<span id="cb127-3"><a href="miscellaneous.html#cb127-3" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">nca_analysis</span>(nca.example, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb127-4"><a href="miscellaneous.html#cb127-4" tabindex="-1"></a><span class="fu">nca_output</span>(model, <span class="at">plots =</span> <span class="cn">TRUE</span>, <span class="at">summaries =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:standard"></span>
<img src="Standard.png" alt="Standard scatter plot of nca.example." width="100%" />
<p class="caption">
Figure 7.2: Standard scatter plot of nca.example.
</p>
</div>
</div>
<div id="standard-plot-with-basic-adaptations" class="section level3 hasAnchor" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> Standard plot with basic adaptations<a href="miscellaneous.html#standard-plot-with-basic-adaptations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It may be desirable to change the appearance of the plot, such as the color of the points and the lines, the type of lines and the type of points. These characteristics can be changed with the graphical functions that are included in the NCA software.
Before running nca_output, the NCA plot can be customized by changing the point type (for all points), the line types and line colors (for each ceiling line separately) and the line width (for all ceiling lines). For instance, a publisher may require a black and white or grayscale plot, with thicker lines and with solid points. Then the standard plot can be adapted as follows (changing of plot dimensions and the saving the plot is the same as for the standard plot):</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="miscellaneous.html#cb128-1" tabindex="-1"></a>line.colors[<span class="st">&#39;ce_fdh&#39;</span>] <span class="ot">&lt;-</span> <span class="st">&#39;black&#39;</span></span>
<span id="cb128-2"><a href="miscellaneous.html#cb128-2" tabindex="-1"></a>line.colors[<span class="st">&#39;cr_fdh&#39;</span>] <span class="ot">&lt;-</span> <span class="st">&#39;black&#39;</span></span>
<span id="cb128-3"><a href="miscellaneous.html#cb128-3" tabindex="-1"></a>line.colors[<span class="st">&#39;ols&#39;</span>] <span class="ot">&lt;-</span> <span class="st">&#39;grey&#39;</span></span>
<span id="cb128-4"><a href="miscellaneous.html#cb128-4" tabindex="-1"></a>point.color <span class="ot">&lt;-</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb128-5"><a href="miscellaneous.html#cb128-5" tabindex="-1"></a>point.type <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb128-6"><a href="miscellaneous.html#cb128-6" tabindex="-1"></a>line.width <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb128-7"><a href="miscellaneous.html#cb128-7" tabindex="-1"></a><span class="fu">nca_output</span>(model, <span class="at">plots =</span> <span class="cn">TRUE</span>, <span class="at">summaries =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:standardplot1"></span>
<img src="Standard%20with%20basic%20adaptations.png" alt="Standard scatter plot of nca.example in black/grey/white." width="100%" />
<p class="caption">
Figure 7.3: Standard scatter plot of nca.example in black/grey/white.
</p>
</div>
</div>
<div id="standard-plot-with-advanced-adaptations" class="section level3 hasAnchor" number="7.3.3">
<h3><span class="header-section-number">7.3.3</span> Standard plot with advanced adaptations<a href="miscellaneous.html#standard-plot-with-advanced-adaptations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If further changes in the plot are needed, for example changes of the individual line types or the plot title, a special R script must be downloaded from:
<a href="https://raw.githubusercontent.com/eur-rsm/nca_scripts/master/display_plot.R" class="uri">https://raw.githubusercontent.com/eur-rsm/nca_scripts/master/display_plot.R</a>
<!-- https://stash.ict.eur.nl/projects/NCA/repos/public/browse/display_plot.R?raw  -->
This script is used as an alternative for making the NCA plot with <code>plots = TRUE</code> in the <code>nca_output</code> function. The script can be copy/paste or otherwise loaded in your R session.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="miscellaneous.html#cb129-1" tabindex="-1"></a><span class="co"># Default values copied from p_constants</span></span>
<span id="cb129-2"><a href="miscellaneous.html#cb129-2" tabindex="-1"></a>line_colors <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ols=</span><span class="st">&quot;green&quot;</span>,        <span class="at">lh=</span><span class="st">&quot;red3&quot;</span>,            <span class="at">cols=</span><span class="st">&quot;darkgreen&quot;</span>,</span>
<span id="cb129-3"><a href="miscellaneous.html#cb129-3" tabindex="-1"></a>                    <span class="at">qr=</span><span class="st">&quot;blue&quot;</span>,          <span class="at">ce_vrs=</span><span class="st">&quot;orchid4&quot;</span>,     <span class="at">cr_vrs=</span><span class="st">&quot;violet&quot;</span>,</span>
<span id="cb129-4"><a href="miscellaneous.html#cb129-4" tabindex="-1"></a>                    <span class="at">ce_fdh=</span><span class="st">&quot;red&quot;</span>,       <span class="at">cr_fdh=</span><span class="st">&quot;orange&quot;</span>,      <span class="at">sfa=</span><span class="st">&quot;darkgoldenrod&quot;</span>,</span>
<span id="cb129-5"><a href="miscellaneous.html#cb129-5" tabindex="-1"></a>                    <span class="at">c_lp=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb129-6"><a href="miscellaneous.html#cb129-6" tabindex="-1"></a>line_types  <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ols=</span><span class="dv">3</span>,              <span class="at">lh=</span><span class="dv">2</span>,                 <span class="at">cols=</span><span class="dv">3</span>,</span>
<span id="cb129-7"><a href="miscellaneous.html#cb129-7" tabindex="-1"></a>                    <span class="at">qr=</span><span class="dv">4</span>,               <span class="at">ce_vrs=</span><span class="dv">5</span>,             <span class="at">cr_vrs=</span><span class="dv">1</span>,</span>
<span id="cb129-8"><a href="miscellaneous.html#cb129-8" tabindex="-1"></a>                    <span class="at">ce_fdh=</span><span class="dv">6</span>,           <span class="at">cr_fdh=</span><span class="dv">1</span>,             <span class="at">sfa=</span><span class="dv">7</span>,</span>
<span id="cb129-9"><a href="miscellaneous.html#cb129-9" tabindex="-1"></a>                    <span class="at">c_lp=</span><span class="dv">2</span>)</span>
<span id="cb129-10"><a href="miscellaneous.html#cb129-10" tabindex="-1"></a>line_width  <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb129-11"><a href="miscellaneous.html#cb129-11" tabindex="-1"></a>point_type  <span class="ot">&lt;-</span> <span class="dv">23</span></span>
<span id="cb129-12"><a href="miscellaneous.html#cb129-12" tabindex="-1"></a>point_color <span class="ot">&lt;-</span> <span class="st">&#39;red&#39;</span></span>
<span id="cb129-13"><a href="miscellaneous.html#cb129-13" tabindex="-1"></a>display_plot <span class="ot">&lt;-</span></span>
<span id="cb129-14"><a href="miscellaneous.html#cb129-14" tabindex="-1"></a>  <span class="cf">function</span> (plot) {</span>
<span id="cb129-15"><a href="miscellaneous.html#cb129-15" tabindex="-1"></a>    flip.x <span class="ot">&lt;-</span> plot<span class="sc">$</span>flip.x</span>
<span id="cb129-16"><a href="miscellaneous.html#cb129-16" tabindex="-1"></a>    flip.y <span class="ot">&lt;-</span> plot<span class="sc">$</span>flip.y</span>
<span id="cb129-17"><a href="miscellaneous.html#cb129-17" tabindex="-1"></a>    <span class="co"># Determine the bounds of the plot based on the scope</span></span>
<span id="cb129-18"><a href="miscellaneous.html#cb129-18" tabindex="-1"></a>    xlim <span class="ot">&lt;-</span> <span class="fu">c</span>(plot<span class="sc">$</span>scope.theo[<span class="dv">1</span> <span class="sc">+</span> flip.x], plot<span class="sc">$</span>scope.theo[<span class="dv">2</span> <span class="sc">-</span> flip.x])</span>
<span id="cb129-19"><a href="miscellaneous.html#cb129-19" tabindex="-1"></a>    ylim <span class="ot">&lt;-</span> <span class="fu">c</span>(plot<span class="sc">$</span>scope.theo[<span class="dv">3</span> <span class="sc">+</span> flip.y], plot<span class="sc">$</span>scope.theo[<span class="dv">4</span> <span class="sc">-</span> flip.y])</span>
<span id="cb129-20"><a href="miscellaneous.html#cb129-20" tabindex="-1"></a>    <span class="co"># Reset/append colors etc. if needed</span></span>
<span id="cb129-21"><a href="miscellaneous.html#cb129-21" tabindex="-1"></a>    <span class="cf">for</span> (method <span class="cf">in</span> <span class="fu">names</span>(line_types)) {</span>
<span id="cb129-22"><a href="miscellaneous.html#cb129-22" tabindex="-1"></a>      line.types[[method]] <span class="ot">&lt;-</span> line_types[[method]]</span>
<span id="cb129-23"><a href="miscellaneous.html#cb129-23" tabindex="-1"></a>    }</span>
<span id="cb129-24"><a href="miscellaneous.html#cb129-24" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.numeric</span>(line_width)) {</span>
<span id="cb129-25"><a href="miscellaneous.html#cb129-25" tabindex="-1"></a>      line.width <span class="ot">&lt;-</span> line_width</span>
<span id="cb129-26"><a href="miscellaneous.html#cb129-26" tabindex="-1"></a>    }</span>
<span id="cb129-27"><a href="miscellaneous.html#cb129-27" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.numeric</span>(point_type)) {</span>
<span id="cb129-28"><a href="miscellaneous.html#cb129-28" tabindex="-1"></a>      point.type <span class="ot">&lt;-</span> point_type</span>
<span id="cb129-29"><a href="miscellaneous.html#cb129-29" tabindex="-1"></a>    }</span>
<span id="cb129-30"><a href="miscellaneous.html#cb129-30" tabindex="-1"></a>    <span class="cf">if</span> (point_color <span class="sc">%in%</span> <span class="fu">colors</span>()) {</span>
<span id="cb129-31"><a href="miscellaneous.html#cb129-31" tabindex="-1"></a>      point.color <span class="ot">&lt;-</span> point_color</span>
<span id="cb129-32"><a href="miscellaneous.html#cb129-32" tabindex="-1"></a>    }</span>
<span id="cb129-33"><a href="miscellaneous.html#cb129-33" tabindex="-1"></a>    <span class="co"># Only needed until the next release (3.0.2)</span></span>
<span id="cb129-34"><a href="miscellaneous.html#cb129-34" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">&quot;point.color&quot;</span>)) {</span>
<span id="cb129-35"><a href="miscellaneous.html#cb129-35" tabindex="-1"></a>      point.color <span class="ot">&lt;-</span> <span class="st">&quot;blue&quot;</span></span>
<span id="cb129-36"><a href="miscellaneous.html#cb129-36" tabindex="-1"></a>    }</span>
<span id="cb129-37"><a href="miscellaneous.html#cb129-37" tabindex="-1"></a>    <span class="co"># Plot the data points</span></span>
<span id="cb129-38"><a href="miscellaneous.html#cb129-38" tabindex="-1"></a>    <span class="fu">plot</span> (plot<span class="sc">$</span>x, plot<span class="sc">$</span>y, <span class="at">pch=</span>point.type, <span class="at">col=</span>point.color, <span class="at">bg=</span>point.color,</span>
<span id="cb129-39"><a href="miscellaneous.html#cb129-39" tabindex="-1"></a>          <span class="at">xlim=</span>xlim, <span class="at">ylim=</span>ylim, <span class="at">xlab=</span><span class="fu">colnames</span>(plot<span class="sc">$</span>x), <span class="at">ylab=</span><span class="fu">tail</span>(plot<span class="sc">$</span>names, <span class="at">n=</span><span class="dv">1</span>))</span>
<span id="cb129-40"><a href="miscellaneous.html#cb129-40" tabindex="-1"></a>    <span class="co"># Plot the scope outline</span></span>
<span id="cb129-41"><a href="miscellaneous.html#cb129-41" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">v=</span>plot<span class="sc">$</span>scope.theo[<span class="dv">1</span>], <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;grey&quot;</span>)</span>
<span id="cb129-42"><a href="miscellaneous.html#cb129-42" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">v=</span>plot<span class="sc">$</span>scope.theo[<span class="dv">2</span>], <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;grey&quot;</span>)</span>
<span id="cb129-43"><a href="miscellaneous.html#cb129-43" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h=</span>plot<span class="sc">$</span>scope.theo[<span class="dv">3</span>], <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;grey&quot;</span>)</span>
<span id="cb129-44"><a href="miscellaneous.html#cb129-44" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h=</span>plot<span class="sc">$</span>scope.theo[<span class="dv">4</span>], <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;grey&quot;</span>)</span>
<span id="cb129-45"><a href="miscellaneous.html#cb129-45" tabindex="-1"></a>    <span class="co"># Plot the legend before adding the clipping area</span></span>
<span id="cb129-46"><a href="miscellaneous.html#cb129-46" tabindex="-1"></a>    legendParams <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb129-47"><a href="miscellaneous.html#cb129-47" tabindex="-1"></a>    <span class="cf">for</span> (method <span class="cf">in</span> plot<span class="sc">$</span>methods) {</span>
<span id="cb129-48"><a href="miscellaneous.html#cb129-48" tabindex="-1"></a>      line.color <span class="ot">&lt;-</span> line.colors[[method]]</span>
<span id="cb129-49"><a href="miscellaneous.html#cb129-49" tabindex="-1"></a>      line.type  <span class="ot">&lt;-</span> line.types[[method]]</span>
<span id="cb129-50"><a href="miscellaneous.html#cb129-50" tabindex="-1"></a>      name <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="st">&quot;-&quot;</span>, <span class="fu">toupper</span>(method))</span>
<span id="cb129-51"><a href="miscellaneous.html#cb129-51" tabindex="-1"></a>      legendParams<span class="sc">$</span>names  <span class="ot">=</span> <span class="fu">append</span>(legendParams<span class="sc">$</span>names, name)</span>
<span id="cb129-52"><a href="miscellaneous.html#cb129-52" tabindex="-1"></a>      legendParams<span class="sc">$</span>types  <span class="ot">=</span> <span class="fu">append</span>(legendParams<span class="sc">$</span>types, line.type)</span>
<span id="cb129-53"><a href="miscellaneous.html#cb129-53" tabindex="-1"></a>      legendParams<span class="sc">$</span>colors <span class="ot">=</span> <span class="fu">append</span>(legendParams<span class="sc">$</span>colors, line.color)</span>
<span id="cb129-54"><a href="miscellaneous.html#cb129-54" tabindex="-1"></a>    }</span>
<span id="cb129-55"><a href="miscellaneous.html#cb129-55" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(legendParams) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb129-56"><a href="miscellaneous.html#cb129-56" tabindex="-1"></a>      <span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">cex=</span><span class="fl">0.7</span>, legendParams<span class="sc">$</span>names,</span>
<span id="cb129-57"><a href="miscellaneous.html#cb129-57" tabindex="-1"></a>             <span class="at">lty=</span>legendParams<span class="sc">$</span>types, <span class="at">col=</span>legendParams<span class="sc">$</span>colors, <span class="at">bg=</span><span class="cn">NA</span>)</span>
<span id="cb129-58"><a href="miscellaneous.html#cb129-58" tabindex="-1"></a>    }</span>
<span id="cb129-59"><a href="miscellaneous.html#cb129-59" tabindex="-1"></a>    <span class="co"># Apply clipping to the lines</span></span>
<span id="cb129-60"><a href="miscellaneous.html#cb129-60" tabindex="-1"></a>    <span class="fu">clip</span>(xlim[<span class="dv">1</span>], xlim[<span class="dv">2</span>], ylim[<span class="dv">1</span>], ylim[<span class="dv">2</span>])</span>
<span id="cb129-61"><a href="miscellaneous.html#cb129-61" tabindex="-1"></a>    <span class="co"># Plot the lines</span></span>
<span id="cb129-62"><a href="miscellaneous.html#cb129-62" tabindex="-1"></a>    <span class="cf">for</span> (method <span class="cf">in</span> plot<span class="sc">$</span>methods) {</span>
<span id="cb129-63"><a href="miscellaneous.html#cb129-63" tabindex="-1"></a>      line <span class="ot">&lt;-</span> plot<span class="sc">$</span>lines[[method]]</span>
<span id="cb129-64"><a href="miscellaneous.html#cb129-64" tabindex="-1"></a>      line.color <span class="ot">&lt;-</span> line.colors[[method]]</span>
<span id="cb129-65"><a href="miscellaneous.html#cb129-65" tabindex="-1"></a>      line.type  <span class="ot">&lt;-</span> line.types[[method]]</span>
<span id="cb129-66"><a href="miscellaneous.html#cb129-66" tabindex="-1"></a>      <span class="cf">if</span> (method <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;lh&quot;</span>, <span class="st">&quot;ce_vrs&quot;</span>, <span class="st">&quot;ce_fdh&quot;</span>)) {</span>
<span id="cb129-67"><a href="miscellaneous.html#cb129-67" tabindex="-1"></a>        <span class="fu">lines</span>(line[[<span class="dv">1</span>]], line[[<span class="dv">2</span>]], <span class="at">type=</span><span class="st">&quot;l&quot;</span>,</span>
<span id="cb129-68"><a href="miscellaneous.html#cb129-68" tabindex="-1"></a>              <span class="at">lty=</span>line.type, <span class="at">col=</span>line.color, <span class="at">lwd=</span>line.width)</span>
<span id="cb129-69"><a href="miscellaneous.html#cb129-69" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb129-70"><a href="miscellaneous.html#cb129-70" tabindex="-1"></a>        <span class="fu">abline</span>(line, <span class="at">lty=</span>line.type, <span class="at">col=</span>line.color, <span class="at">lwd=</span>line.width)</span>
<span id="cb129-71"><a href="miscellaneous.html#cb129-71" tabindex="-1"></a>      }</span>
<span id="cb129-72"><a href="miscellaneous.html#cb129-72" tabindex="-1"></a>    }</span>
<span id="cb129-73"><a href="miscellaneous.html#cb129-73" tabindex="-1"></a>    <span class="co"># Plot the title</span></span>
<span id="cb129-74"><a href="miscellaneous.html#cb129-74" tabindex="-1"></a>    <span class="fu">title</span>(<span class="fu">paste0</span>(<span class="st">&quot;Advanced Standard NCA Plot : &quot;</span>, plot<span class="sc">$</span>title), <span class="at">cex.main=</span><span class="dv">1</span>)</span>
<span id="cb129-75"><a href="miscellaneous.html#cb129-75" tabindex="-1"></a>  }</span></code></pre></div>
<p>The different default values of the plot can be changed as desired. For example, a researcher may wish to change the <code>ols</code> line into a dotted line (<code>line.type</code> to value 3), and to have a point type that is squared (<code>point.type = 23</code>) with red color of the points (<code>point.color = 'red'</code>). Also, the title of the plot can be changed at the end of the script into for example “Advanced NCA plot …”.<br />
For producing the plot the final call is :</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="miscellaneous.html#cb130-1" tabindex="-1"></a><span class="fu">display_plot</span>(model<span class="sc">$</span>plots[[<span class="dv">1</span>]])</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:standardplot2"></span>
<img src="Standard%20plot%20with%20advanced%20adaptations.png" alt="Standard scatter plot of nca.example with advance adaptations." width="100%" />
<p class="caption">
Figure 7.4: Standard scatter plot of nca.example with advance adaptations.
</p>
</div>
<p>The plot can be reset to default values by:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="miscellaneous.html#cb131-1" tabindex="-1"></a>line.colors <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb131-2"><a href="miscellaneous.html#cb131-2" tabindex="-1"></a>line.types <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb131-3"><a href="miscellaneous.html#cb131-3" tabindex="-1"></a>line.width <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb131-4"><a href="miscellaneous.html#cb131-4" tabindex="-1"></a>point.color <span class="ot">&lt;-</span> <span class="st">&quot;blue&quot;</span></span>
<span id="cb131-5"><a href="miscellaneous.html#cb131-5" tabindex="-1"></a>point.type <span class="ot">&lt;-</span> <span class="dv">21</span></span></code></pre></div>
</div>
<div id="plot-with-plotly" class="section level3 hasAnchor" number="7.3.4">
<h3><span class="header-section-number">7.3.4</span> Plot with <code>plotly</code><a href="miscellaneous.html#plot-with-plotly" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The NCA software can also produce a plot made by <code>plotly</code>. The main goal is to provide the user a possibility for graphical exploration of NCA results. However, it is also possible to save the plot. The plot with <code>plotly</code> can be produced with the <code>nca_output</code> function as follows:.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="miscellaneous.html#cb132-1" tabindex="-1"></a><span class="fu">nca_output</span>(model, <span class="at">plotly=</span><span class="cn">TRUE</span>, <span class="at">summaries =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>It is possible to label subgroups of points. For example, the continents of the countries in the <code>nca.example</code> dataset can be identified as follows (in the order of the rows in the dataset):</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="miscellaneous.html#cb133-1" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Australia&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;North America&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;North America&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Australia&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;Europe&quot;</span>, <span class="st">&quot;North America&quot;</span>) </span>
<span id="cb133-2"><a href="miscellaneous.html#cb133-2" tabindex="-1"></a><span class="fu">nca_output</span>(model, <span class="at">plotly=</span>labels, <span class="at">summaries =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>The plot opens in the Viewer tab of the plots window (Figure <a href="miscellaneous.html#fig:plotly1">7.5</a>). The interactive version can be approached <a href="https://www.erim.eur.nl/fileadmin/user_upload/plotly.html">here</a>. The plot identifies the ‘peers’ in red. Peers are points near the ceiling line that are used for drawing the default and other ceiling lines. When moving in the computer screen the pointer over the top of the plot, a toolbar pops up. One of its functions is “Download plot as png”, which saves the plot in the download folder of the computer (not in the working directory). Saving is also possible with Export tab -&gt; Save as Image.</p>
<div class="figure"><span style="display:block;" id="fig:plotly1"></span>
<img src="Plotly.png" alt="Plotly scatter plot of nca.example. The interactive version can be approached [here](https://www.erim.eur.nl/fileadmin/user_upload/plotly.html)." width="100%" />
<p class="caption">
Figure 7.5: Plotly scatter plot of nca.example. The interactive version can be approached <a href="https://www.erim.eur.nl/fileadmin/user_upload/plotly.html">here</a>.
</p>
</div>
</div>
<div id="plot-with-ggplot" class="section level3 hasAnchor" number="7.3.5">
<h3><span class="header-section-number">7.3.5</span> Plot with <code>ggplot</code><a href="miscellaneous.html#plot-with-ggplot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The function <code>ggplot</code> is an advanced graphical function in R. Output of NCA can be used as input for <code>ggplot</code>. For example, when the ceiling line is a straight line (such as the default ceiling line <code>cr_fdh</code>) the intercept and slope of the ceiling line can be used in <code>ggplot</code> to plot the ceiling line.
First, these NCA parameters must be extracted from the NCA results:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="miscellaneous.html#cb134-1" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> model<span class="sc">$</span>summaries<span class="sc">$</span>Individualism<span class="sc">$</span>params[<span class="st">&quot;Intercept&quot;</span>,<span class="st">&quot;cr_fdh&quot;</span>]  </span>
<span id="cb134-2"><a href="miscellaneous.html#cb134-2" tabindex="-1"></a>slope <span class="ot">&lt;-</span> model<span class="sc">$</span>summaries<span class="sc">$</span>Individualism<span class="sc">$</span>params[<span class="st">&quot;Slope&quot;</span>, <span class="st">&quot;cr_fdh&quot;</span>]</span></code></pre></div>
<p>Next the <code>ggplot</code> can be produced:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="miscellaneous.html#cb135-1" tabindex="-1"></a><span class="fu">library</span> (ggplot2)</span>
<span id="cb135-2"><a href="miscellaneous.html#cb135-2" tabindex="-1"></a><span class="fu">ggplot</span>(nca.example, <span class="fu">aes</span>(Individualism,<span class="st">`</span><span class="at">Innovation performance</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb135-3"><a href="miscellaneous.html#cb135-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb135-4"><a href="miscellaneous.html#cb135-4" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept=</span>intercept, <span class="at">slope=</span>slope, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-74"></span>
<img src="_main_files/figure-html/unnamed-chunk-74-1.png" alt="ggplot scatter plot of nca.example." width="100%" />
<p class="caption">
Figure 7.6: ggplot scatter plot of nca.example.
</p>
</div>
<p>The <code>ggplot</code> function gives many graphical opportunities (see its documentation) to make the plot as desired.<br />
Changing of plot dimensions and the saving the plot is the same as for the standard plot.</p>
</div>
<div id="saving-the-plot-from-within-the-r-script" class="section level3 hasAnchor" number="7.3.6">
<h3><span class="header-section-number">7.3.6</span> Saving the plot from within the R script<a href="miscellaneous.html#saving-the-plot-from-within-the-r-script" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>All above options for saving an NCA plot are based on first displaying the plot in R and then saving it. It is also possible to save the plot from within the R script. The following script saves a standard NCA plot as a png file with the name “nca.example.png”) in the working directory with a given size and resolution:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="miscellaneous.html#cb136-1" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;nca_example.png&quot;</span>,<span class="at">units=</span><span class="st">&quot;cm&quot;</span>, <span class="dv">15</span>,<span class="dv">15</span>, <span class="at">res=</span><span class="dv">300</span>) </span>
<span id="cb136-2"><a href="miscellaneous.html#cb136-2" tabindex="-1"></a><span class="fu">nca_output</span>(model, <span class="at">plots =</span> <span class="cn">TRUE</span>, <span class="at">summaries =</span> <span class="cn">FALSE</span>)</span>
<span id="cb136-3"><a href="miscellaneous.html#cb136-3" tabindex="-1"></a><span class="fu">dev.off</span>() </span></code></pre></div>
<p>It is also possible to save a pdf file:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="miscellaneous.html#cb137-1" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&quot;nca_example.pdf&quot;</span>,<span class="dv">5</span>,<span class="dv">5</span>) </span>
<span id="cb137-2"><a href="miscellaneous.html#cb137-2" tabindex="-1"></a><span class="fu">nca_output</span>(model, <span class="at">plots =</span> <span class="cn">TRUE</span>, <span class="at">summaries =</span> <span class="cn">FALSE</span>)</span>
<span id="cb137-3"><a href="miscellaneous.html#cb137-3" tabindex="-1"></a><span class="fu">dev.off</span>() </span></code></pre></div>
</div>
</div>
<div id="additionalcode" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Additional functions for use with the NCA softare in R (beta)<a href="miscellaneous.html#additionalcode" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="ncarobustnesstablegeneral" class="section level3 hasAnchor" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> <code>nca_robustness_table_general.R</code><a href="miscellaneous.html#ncarobustnesstablegeneral" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="miscellaneous.html#cb138-1" tabindex="-1"></a><span class="co"># Helper function to produce the general robustness table</span></span>
<span id="cb138-2"><a href="miscellaneous.html#cb138-2" tabindex="-1"></a></span>
<span id="cb138-3"><a href="miscellaneous.html#cb138-3" tabindex="-1"></a>nca_robustness_table_general <span class="ot">&lt;-</span> <span class="cf">function</span>(data,</span>
<span id="cb138-4"><a href="miscellaneous.html#cb138-4" tabindex="-1"></a>                                      conditions,</span>
<span id="cb138-5"><a href="miscellaneous.html#cb138-5" tabindex="-1"></a>                                      outcome, </span>
<span id="cb138-6"><a href="miscellaneous.html#cb138-6" tabindex="-1"></a>                                      <span class="at">ceiling =</span> <span class="st">&quot;ce_fdh&quot;</span>,</span>
<span id="cb138-7"><a href="miscellaneous.html#cb138-7" tabindex="-1"></a>                                      <span class="at">scope =</span> <span class="cn">NULL</span>, </span>
<span id="cb138-8"><a href="miscellaneous.html#cb138-8" tabindex="-1"></a>                                      <span class="at">d_threshold =</span> <span class="fl">0.1</span>,</span>
<span id="cb138-9"><a href="miscellaneous.html#cb138-9" tabindex="-1"></a>                                      <span class="at">p_threshold =</span> <span class="fl">0.05</span>,</span>
<span id="cb138-10"><a href="miscellaneous.html#cb138-10" tabindex="-1"></a>                                      <span class="at">outliers =</span> <span class="dv">0</span>,</span>
<span id="cb138-11"><a href="miscellaneous.html#cb138-11" tabindex="-1"></a>                                      <span class="at">bottleneck.y =</span> <span class="st">&quot;percentile&quot;</span>,</span>
<span id="cb138-12"><a href="miscellaneous.html#cb138-12" tabindex="-1"></a>                                      <span class="at">target_outcome =</span> <span class="dv">75</span>,</span>
<span id="cb138-13"><a href="miscellaneous.html#cb138-13" tabindex="-1"></a>                                      <span class="at">plots =</span> <span class="cn">FALSE</span>,</span>
<span id="cb138-14"><a href="miscellaneous.html#cb138-14" tabindex="-1"></a>                                      <span class="at">checks =</span> checks</span>
<span id="cb138-15"><a href="miscellaneous.html#cb138-15" tabindex="-1"></a>) {</span>
<span id="cb138-16"><a href="miscellaneous.html#cb138-16" tabindex="-1"></a>  </span>
<span id="cb138-17"><a href="miscellaneous.html#cb138-17" tabindex="-1"></a>  <span class="co"># Define the configurations for each robustness check</span></span>
<span id="cb138-18"><a href="miscellaneous.html#cb138-18" tabindex="-1"></a>  </span>
<span id="cb138-19"><a href="miscellaneous.html#cb138-19" tabindex="-1"></a>  </span>
<span id="cb138-20"><a href="miscellaneous.html#cb138-20" tabindex="-1"></a>  <span class="co"># Initialize an empty list to store results</span></span>
<span id="cb138-21"><a href="miscellaneous.html#cb138-21" tabindex="-1"></a>  results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb138-22"><a href="miscellaneous.html#cb138-22" tabindex="-1"></a>  </span>
<span id="cb138-23"><a href="miscellaneous.html#cb138-23" tabindex="-1"></a>  <span class="co"># Perform each robustness check</span></span>
<span id="cb138-24"><a href="miscellaneous.html#cb138-24" tabindex="-1"></a>  <span class="cf">for</span> (check <span class="cf">in</span> checks) {</span>
<span id="cb138-25"><a href="miscellaneous.html#cb138-25" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">nca_robustness_checks_general</span>(</span>
<span id="cb138-26"><a href="miscellaneous.html#cb138-26" tabindex="-1"></a>      <span class="at">data =</span> data,</span>
<span id="cb138-27"><a href="miscellaneous.html#cb138-27" tabindex="-1"></a>      <span class="at">conditions =</span> conditions,</span>
<span id="cb138-28"><a href="miscellaneous.html#cb138-28" tabindex="-1"></a>      <span class="at">outcome =</span> outcome,</span>
<span id="cb138-29"><a href="miscellaneous.html#cb138-29" tabindex="-1"></a>      <span class="at">ceiling =</span> check<span class="sc">$</span>ceiling,</span>
<span id="cb138-30"><a href="miscellaneous.html#cb138-30" tabindex="-1"></a>      <span class="at">scope =</span> check<span class="sc">$</span>scope,</span>
<span id="cb138-31"><a href="miscellaneous.html#cb138-31" tabindex="-1"></a>      <span class="at">d_threshold =</span> check<span class="sc">$</span>d_threshold,</span>
<span id="cb138-32"><a href="miscellaneous.html#cb138-32" tabindex="-1"></a>      <span class="at">p_threshold =</span> check<span class="sc">$</span>p_threshold,</span>
<span id="cb138-33"><a href="miscellaneous.html#cb138-33" tabindex="-1"></a>      <span class="at">outliers =</span> check<span class="sc">$</span>outliers,</span>
<span id="cb138-34"><a href="miscellaneous.html#cb138-34" tabindex="-1"></a>      <span class="at">bottleneck.y =</span> bottleneck.y,</span>
<span id="cb138-35"><a href="miscellaneous.html#cb138-35" tabindex="-1"></a>      <span class="at">target_outcome =</span> check<span class="sc">$</span>target_outcome,</span>
<span id="cb138-36"><a href="miscellaneous.html#cb138-36" tabindex="-1"></a>      <span class="at">plots =</span> plots</span>
<span id="cb138-37"><a href="miscellaneous.html#cb138-37" tabindex="-1"></a>    )</span>
<span id="cb138-38"><a href="miscellaneous.html#cb138-38" tabindex="-1"></a>    result<span class="sc">$</span><span class="st">`</span><span class="at">Robustness check</span><span class="st">`</span> <span class="ot">&lt;-</span> check<span class="sc">$</span>name</span>
<span id="cb138-39"><a href="miscellaneous.html#cb138-39" tabindex="-1"></a>    results_list[[check<span class="sc">$</span>name]] <span class="ot">&lt;-</span> result</span>
<span id="cb138-40"><a href="miscellaneous.html#cb138-40" tabindex="-1"></a>  }</span>
<span id="cb138-41"><a href="miscellaneous.html#cb138-41" tabindex="-1"></a>  </span>
<span id="cb138-42"><a href="miscellaneous.html#cb138-42" tabindex="-1"></a>  <span class="co"># Combine all results into one data frame</span></span>
<span id="cb138-43"><a href="miscellaneous.html#cb138-43" tabindex="-1"></a>  results_all <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, results_list)</span>
<span id="cb138-44"><a href="miscellaneous.html#cb138-44" tabindex="-1"></a>  </span>
<span id="cb138-45"><a href="miscellaneous.html#cb138-45" tabindex="-1"></a>  <span class="co"># Reorder columns</span></span>
<span id="cb138-46"><a href="miscellaneous.html#cb138-46" tabindex="-1"></a>  results_all <span class="ot">&lt;-</span> results_all[<span class="fu">c</span>(<span class="st">&quot;Condition&quot;</span>, <span class="st">&quot;Robustness check&quot;</span>, <span class="st">&quot;Effect_size&quot;</span>, <span class="st">&quot;p_value&quot;</span>, <span class="st">&quot;Necessity&quot;</span>, <span class="st">&quot;Bottlenecks_percent&quot;</span>, <span class="st">&quot;Bottlenecks_count&quot;</span>)]</span>
<span id="cb138-47"><a href="miscellaneous.html#cb138-47" tabindex="-1"></a>  <span class="fu">row.names</span>(results_all) <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb138-48"><a href="miscellaneous.html#cb138-48" tabindex="-1"></a>  </span>
<span id="cb138-49"><a href="miscellaneous.html#cb138-49" tabindex="-1"></a>  <span class="co"># Reorganize the dataframe into new blocks (one block per condition)</span></span>
<span id="cb138-50"><a href="miscellaneous.html#cb138-50" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(conditions) <span class="co"># Block size</span></span>
<span id="cb138-51"><a href="miscellaneous.html#cb138-51" tabindex="-1"></a>  rows_per_block <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, n) <span class="co"># Sequence of row indices in one block</span></span>
<span id="cb138-52"><a href="miscellaneous.html#cb138-52" tabindex="-1"></a>  </span>
<span id="cb138-53"><a href="miscellaneous.html#cb138-53" tabindex="-1"></a>  <span class="co"># Create a new column to assign new block numbers</span></span>
<span id="cb138-54"><a href="miscellaneous.html#cb138-54" tabindex="-1"></a>  results_all<span class="sc">$</span>NewBlock <span class="ot">&lt;-</span> <span class="fu">rep</span>(rows_per_block, <span class="at">length.out =</span> <span class="fu">nrow</span>(results_all))</span>
<span id="cb138-55"><a href="miscellaneous.html#cb138-55" tabindex="-1"></a>  </span>
<span id="cb138-56"><a href="miscellaneous.html#cb138-56" tabindex="-1"></a>  <span class="co"># Split the dataframe into blocks and combine the blocks sequentially</span></span>
<span id="cb138-57"><a href="miscellaneous.html#cb138-57" tabindex="-1"></a>  reorganized_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(rows_per_block, <span class="cf">function</span>(i) {</span>
<span id="cb138-58"><a href="miscellaneous.html#cb138-58" tabindex="-1"></a>    results_all[results_all<span class="sc">$</span>NewBlock <span class="sc">==</span> i, ] <span class="co"># Subset rows for the current block</span></span>
<span id="cb138-59"><a href="miscellaneous.html#cb138-59" tabindex="-1"></a>  }))</span>
<span id="cb138-60"><a href="miscellaneous.html#cb138-60" tabindex="-1"></a>  </span>
<span id="cb138-61"><a href="miscellaneous.html#cb138-61" tabindex="-1"></a>  <span class="co"># Remove the helper column and reset row names</span></span>
<span id="cb138-62"><a href="miscellaneous.html#cb138-62" tabindex="-1"></a>  reorganized_df <span class="ot">&lt;-</span> reorganized_df[, <span class="sc">-</span><span class="fu">ncol</span>(reorganized_df)]</span>
<span id="cb138-63"><a href="miscellaneous.html#cb138-63" tabindex="-1"></a>  <span class="fu">row.names</span>(reorganized_df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb138-64"><a href="miscellaneous.html#cb138-64" tabindex="-1"></a>  robustness_table_general <span class="ot">&lt;-</span> reorganized_df</span>
<span id="cb138-65"><a href="miscellaneous.html#cb138-65" tabindex="-1"></a>  <span class="fu">return</span>(robustness_table_general)</span>
<span id="cb138-66"><a href="miscellaneous.html#cb138-66" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="ncarobustnesschecksgeneral" class="section level3 hasAnchor" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> <code>nca_robustness_checks_general.R</code><a href="miscellaneous.html#ncarobustnesschecksgeneral" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="miscellaneous.html#cb139-1" tabindex="-1"></a><span class="co"># Helper function to conduct general robustness checks</span></span>
<span id="cb139-2"><a href="miscellaneous.html#cb139-2" tabindex="-1"></a></span>
<span id="cb139-3"><a href="miscellaneous.html#cb139-3" tabindex="-1"></a>nca_robustness_checks_general <span class="ot">&lt;-</span> <span class="cf">function</span>(data, </span>
<span id="cb139-4"><a href="miscellaneous.html#cb139-4" tabindex="-1"></a>                           conditions, </span>
<span id="cb139-5"><a href="miscellaneous.html#cb139-5" tabindex="-1"></a>                           outcome, </span>
<span id="cb139-6"><a href="miscellaneous.html#cb139-6" tabindex="-1"></a>                           <span class="at">ceiling =</span> <span class="st">&quot;ce_fdh&quot;</span>, </span>
<span id="cb139-7"><a href="miscellaneous.html#cb139-7" tabindex="-1"></a>                           <span class="at">d_threshold =</span> <span class="fl">0.1</span>, </span>
<span id="cb139-8"><a href="miscellaneous.html#cb139-8" tabindex="-1"></a>                           <span class="at">p_threshold =</span> <span class="fl">0.05</span>, </span>
<span id="cb139-9"><a href="miscellaneous.html#cb139-9" tabindex="-1"></a>                           <span class="at">scope =</span> <span class="cn">NULL</span>,</span>
<span id="cb139-10"><a href="miscellaneous.html#cb139-10" tabindex="-1"></a>                           <span class="at">outliers =</span> <span class="dv">0</span>, </span>
<span id="cb139-11"><a href="miscellaneous.html#cb139-11" tabindex="-1"></a>                           <span class="at">bottleneck.y =</span> <span class="st">&quot;percentile&quot;</span>, </span>
<span id="cb139-12"><a href="miscellaneous.html#cb139-12" tabindex="-1"></a>                           <span class="at">target_outcome =</span> <span class="dv">75</span>, </span>
<span id="cb139-13"><a href="miscellaneous.html#cb139-13" tabindex="-1"></a>                           <span class="at">plots =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb139-14"><a href="miscellaneous.html#cb139-14" tabindex="-1"></a>  </span>
<span id="cb139-15"><a href="miscellaneous.html#cb139-15" tabindex="-1"></a>  <span class="co"># Remove outliers if needed</span></span>
<span id="cb139-16"><a href="miscellaneous.html#cb139-16" tabindex="-1"></a>  <span class="cf">if</span> (outliers <span class="sc">!=</span> <span class="dv">0</span>) {</span>
<span id="cb139-17"><a href="miscellaneous.html#cb139-17" tabindex="-1"></a>    <span class="fu">source</span>(<span class="st">&quot;get_outliers.R&quot;</span>)</span>
<span id="cb139-18"><a href="miscellaneous.html#cb139-18" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">get_outliers</span>(data, conditions, outcome, ceiling, outliers)</span>
<span id="cb139-19"><a href="miscellaneous.html#cb139-19" tabindex="-1"></a>    all_outliers <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">unlist</span>(out<span class="sc">$</span>outliers_df)[<span class="sc">!</span><span class="fu">is.na</span>(out<span class="sc">$</span>outliers_df)])</span>
<span id="cb139-20"><a href="miscellaneous.html#cb139-20" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data[<span class="sc">-</span>all_outliers, ]</span>
<span id="cb139-21"><a href="miscellaneous.html#cb139-21" tabindex="-1"></a>  }</span>
<span id="cb139-22"><a href="miscellaneous.html#cb139-22" tabindex="-1"></a>  </span>
<span id="cb139-23"><a href="miscellaneous.html#cb139-23" tabindex="-1"></a>  <span class="co"># Run the NCA analysis</span></span>
<span id="cb139-24"><a href="miscellaneous.html#cb139-24" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">nca_analysis</span>(</span>
<span id="cb139-25"><a href="miscellaneous.html#cb139-25" tabindex="-1"></a>    data,</span>
<span id="cb139-26"><a href="miscellaneous.html#cb139-26" tabindex="-1"></a>    conditions, </span>
<span id="cb139-27"><a href="miscellaneous.html#cb139-27" tabindex="-1"></a>    outcome, </span>
<span id="cb139-28"><a href="miscellaneous.html#cb139-28" tabindex="-1"></a>    <span class="at">ceilings =</span> ceiling, </span>
<span id="cb139-29"><a href="miscellaneous.html#cb139-29" tabindex="-1"></a>    <span class="at">bottleneck.x =</span> <span class="st">&#39;percentile&#39;</span>,</span>
<span id="cb139-30"><a href="miscellaneous.html#cb139-30" tabindex="-1"></a>    <span class="at">bottleneck.y =</span> bottleneck.y, </span>
<span id="cb139-31"><a href="miscellaneous.html#cb139-31" tabindex="-1"></a>    <span class="at">steps =</span> <span class="fu">c</span>(target_outcome, <span class="cn">NA</span>),</span>
<span id="cb139-32"><a href="miscellaneous.html#cb139-32" tabindex="-1"></a>    <span class="at">test.rep =</span> <span class="dv">1000</span>,</span>
<span id="cb139-33"><a href="miscellaneous.html#cb139-33" tabindex="-1"></a>    <span class="at">scope =</span> scope</span>
<span id="cb139-34"><a href="miscellaneous.html#cb139-34" tabindex="-1"></a>  )</span>
<span id="cb139-35"><a href="miscellaneous.html#cb139-35" tabindex="-1"></a>  </span>
<span id="cb139-36"><a href="miscellaneous.html#cb139-36" tabindex="-1"></a>  <span class="co"># View scatter plots</span></span>
<span id="cb139-37"><a href="miscellaneous.html#cb139-37" tabindex="-1"></a>  <span class="cf">if</span> (plots) {</span>
<span id="cb139-38"><a href="miscellaneous.html#cb139-38" tabindex="-1"></a>  <span class="fu">nca_output</span>(model, <span class="at">summaries =</span> <span class="cn">FALSE</span>) <span class="co">#add pdf=plots to save pdf scatter plots</span></span>
<span id="cb139-39"><a href="miscellaneous.html#cb139-39" tabindex="-1"></a>  }</span>
<span id="cb139-40"><a href="miscellaneous.html#cb139-40" tabindex="-1"></a>  </span>
<span id="cb139-41"><a href="miscellaneous.html#cb139-41" tabindex="-1"></a>  <span class="co"># Extract effect size and p value</span></span>
<span id="cb139-42"><a href="miscellaneous.html#cb139-42" tabindex="-1"></a>  effect_size <span class="ot">&lt;-</span> <span class="fu">sapply</span>(conditions, <span class="cf">function</span>(e) model<span class="sc">$</span>summaries[[e]][[<span class="dv">2</span>]][[<span class="dv">2</span>]])</span>
<span id="cb139-43"><a href="miscellaneous.html#cb139-43" tabindex="-1"></a>  p_value <span class="ot">&lt;-</span> <span class="fu">sapply</span>(conditions, <span class="cf">function</span>(p) model<span class="sc">$</span>summaries[[p]][[<span class="dv">2</span>]][[<span class="dv">6</span>]])</span>
<span id="cb139-44"><a href="miscellaneous.html#cb139-44" tabindex="-1"></a>  necessity <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(effect_size <span class="sc">&gt;=</span> d_threshold <span class="sc">&amp;</span> p_value <span class="sc">&lt;=</span> p_threshold, <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)</span>
<span id="cb139-45"><a href="miscellaneous.html#cb139-45" tabindex="-1"></a>  </span>
<span id="cb139-46"><a href="miscellaneous.html#cb139-46" tabindex="-1"></a>  <span class="co"># Extract the bottlenecks data frame from the model</span></span>
<span id="cb139-47"><a href="miscellaneous.html#cb139-47" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(model<span class="sc">$</span>bottlenecks[[<span class="dv">1</span>]])</span>
<span id="cb139-48"><a href="miscellaneous.html#cb139-48" tabindex="-1"></a>  row_index <span class="ot">&lt;-</span> <span class="fu">which</span>(b[[<span class="dv">1</span>]] <span class="sc">==</span> target_outcome)</span>
<span id="cb139-49"><a href="miscellaneous.html#cb139-49" tabindex="-1"></a>  row_values <span class="ot">&lt;-</span> b[row_index, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb139-50"><a href="miscellaneous.html#cb139-50" tabindex="-1"></a>  Bottlenecks1 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(row_values) <span class="co"># percentage bottleneck cases </span></span>
<span id="cb139-51"><a href="miscellaneous.html#cb139-51" tabindex="-1"></a>  Bottlenecks2 <span class="ot">&lt;-</span> <span class="fu">round</span>(Bottlenecks1 <span class="sc">*</span> <span class="fu">nrow</span>(data) <span class="sc">/</span> <span class="dv">100</span>) <span class="co"># number bottleneck cases</span></span>
<span id="cb139-52"><a href="miscellaneous.html#cb139-52" tabindex="-1"></a>  </span>
<span id="cb139-53"><a href="miscellaneous.html#cb139-53" tabindex="-1"></a>  <span class="co"># Dataframe results</span></span>
<span id="cb139-54"><a href="miscellaneous.html#cb139-54" tabindex="-1"></a>  results_all <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb139-55"><a href="miscellaneous.html#cb139-55" tabindex="-1"></a>    <span class="at">Condition =</span> conditions,</span>
<span id="cb139-56"><a href="miscellaneous.html#cb139-56" tabindex="-1"></a>    <span class="at">Effect_size =</span> effect_size,</span>
<span id="cb139-57"><a href="miscellaneous.html#cb139-57" tabindex="-1"></a>    <span class="at">p_value =</span> p_value,</span>
<span id="cb139-58"><a href="miscellaneous.html#cb139-58" tabindex="-1"></a>    <span class="at">Necessity =</span> necessity,</span>
<span id="cb139-59"><a href="miscellaneous.html#cb139-59" tabindex="-1"></a>    <span class="at">Bottlenecks_percent =</span> Bottlenecks1,</span>
<span id="cb139-60"><a href="miscellaneous.html#cb139-60" tabindex="-1"></a>    <span class="at">Bottlenecks_count =</span> Bottlenecks2</span>
<span id="cb139-61"><a href="miscellaneous.html#cb139-61" tabindex="-1"></a>  )</span>
<span id="cb139-62"><a href="miscellaneous.html#cb139-62" tabindex="-1"></a>  </span>
<span id="cb139-63"><a href="miscellaneous.html#cb139-63" tabindex="-1"></a>  <span class="fu">return</span>(results_all)</span>
<span id="cb139-64"><a href="miscellaneous.html#cb139-64" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="getoutliers" class="section level3 hasAnchor" number="7.4.3">
<h3><span class="header-section-number">7.4.3</span> <code>get_outliers.R</code><a href="miscellaneous.html#getoutliers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="miscellaneous.html#cb140-1" tabindex="-1"></a><span class="co"># Helper function to get outliers </span></span>
<span id="cb140-2"><a href="miscellaneous.html#cb140-2" tabindex="-1"></a><span class="co"># Revised June 1, 2025</span></span>
<span id="cb140-3"><a href="miscellaneous.html#cb140-3" tabindex="-1"></a></span>
<span id="cb140-4"><a href="miscellaneous.html#cb140-4" tabindex="-1"></a>get_outliers <span class="ot">&lt;-</span> <span class="cf">function</span> (data, conditions, outcome, ceiling, k, <span class="at">row.numbers =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb140-5"><a href="miscellaneous.html#cb140-5" tabindex="-1"></a>  <span class="cf">if</span> (row.numbers) {</span>
<span id="cb140-6"><a href="miscellaneous.html#cb140-6" tabindex="-1"></a>    <span class="fu">rownames</span>(data) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb140-7"><a href="miscellaneous.html#cb140-7" tabindex="-1"></a>  }</span>
<span id="cb140-8"><a href="miscellaneous.html#cb140-8" tabindex="-1"></a></span>
<span id="cb140-9"><a href="miscellaneous.html#cb140-9" tabindex="-1"></a>  <span class="co"># Apply nca_outliers for each condition in the conditions vector</span></span>
<span id="cb140-10"><a href="miscellaneous.html#cb140-10" tabindex="-1"></a>  outliers_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(conditions, <span class="cf">function</span> (condition) {</span>
<span id="cb140-11"><a href="miscellaneous.html#cb140-11" tabindex="-1"></a>    <span class="fu">nca_outliers</span>(data, <span class="at">x =</span> condition, <span class="at">y =</span> outcome, <span class="at">ceiling =</span> ceiling, <span class="at">k =</span> k)</span>
<span id="cb140-12"><a href="miscellaneous.html#cb140-12" tabindex="-1"></a>  })</span>
<span id="cb140-13"><a href="miscellaneous.html#cb140-13" tabindex="-1"></a></span>
<span id="cb140-14"><a href="miscellaneous.html#cb140-14" tabindex="-1"></a>  <span class="co"># Extract the k datapoints for the first outlier, add NA&#39;s if needed</span></span>
<span id="cb140-15"><a href="miscellaneous.html#cb140-15" tabindex="-1"></a>  k_outliers <span class="ot">&lt;-</span> <span class="fu">lapply</span>(outliers_list, <span class="cf">function</span>(o) {</span>
<span id="cb140-16"><a href="miscellaneous.html#cb140-16" tabindex="-1"></a>    <span class="co"># Check if o is a valid list/matrix and has a non-NULL, non-NA string in position [1,1]</span></span>
<span id="cb140-17"><a href="miscellaneous.html#cb140-17" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(o) <span class="sc">||</span> <span class="fu">is.null</span>(o[[<span class="dv">1</span>, <span class="dv">1</span>]]) <span class="sc">||</span> <span class="fu">is.na</span>(o[[<span class="dv">1</span>, <span class="dv">1</span>]]) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.character</span>(o[[<span class="dv">1</span>, <span class="dv">1</span>]])) {</span>
<span id="cb140-18"><a href="miscellaneous.html#cb140-18" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, k))</span>
<span id="cb140-19"><a href="miscellaneous.html#cb140-19" tabindex="-1"></a>    }</span>
<span id="cb140-20"><a href="miscellaneous.html#cb140-20" tabindex="-1"></a>    </span>
<span id="cb140-21"><a href="miscellaneous.html#cb140-21" tabindex="-1"></a>    parts <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(o[[<span class="dv">1</span>, <span class="dv">1</span>]], <span class="st">&quot; - &quot;</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>))</span>
<span id="cb140-22"><a href="miscellaneous.html#cb140-22" tabindex="-1"></a>    <span class="cf">if</span> (row.numbers) {</span>
<span id="cb140-23"><a href="miscellaneous.html#cb140-23" tabindex="-1"></a>      parts <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(parts)</span>
<span id="cb140-24"><a href="miscellaneous.html#cb140-24" tabindex="-1"></a>    }</span>
<span id="cb140-25"><a href="miscellaneous.html#cb140-25" tabindex="-1"></a>    <span class="fu">c</span>(parts, <span class="fu">rep</span>(<span class="cn">NA</span>, k <span class="sc">-</span> <span class="fu">length</span>(parts)))</span>
<span id="cb140-26"><a href="miscellaneous.html#cb140-26" tabindex="-1"></a>  })</span>
<span id="cb140-27"><a href="miscellaneous.html#cb140-27" tabindex="-1"></a>  </span>
<span id="cb140-28"><a href="miscellaneous.html#cb140-28" tabindex="-1"></a>  outliers_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, k_outliers)</span>
<span id="cb140-29"><a href="miscellaneous.html#cb140-29" tabindex="-1"></a>  <span class="fu">colnames</span>(outliers_df) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Outlier&quot;</span>, <span class="dv">1</span><span class="sc">:</span>k)</span>
<span id="cb140-30"><a href="miscellaneous.html#cb140-30" tabindex="-1"></a>  <span class="fu">rownames</span>(outliers_df) <span class="ot">&lt;-</span> conditions</span>
<span id="cb140-31"><a href="miscellaneous.html#cb140-31" tabindex="-1"></a></span>
<span id="cb140-32"><a href="miscellaneous.html#cb140-32" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">outliers_list =</span> outliers_list, <span class="at">outliers_df =</span> outliers_df))</span>
<span id="cb140-33"><a href="miscellaneous.html#cb140-33" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="getindicatordata" class="section level3 hasAnchor" number="7.4.4">
<h3><span class="header-section-number">7.4.4</span> <code>get_indicator_data_TAM.R</code><a href="miscellaneous.html#getindicatordata" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="miscellaneous.html#cb141-1" tabindex="-1"></a><span class="co"># Helper function for getting indicator data of TAM example</span></span>
<span id="cb141-2"><a href="miscellaneous.html#cb141-2" tabindex="-1"></a><span class="co">#revised May 23, 2025</span></span>
<span id="cb141-3"><a href="miscellaneous.html#cb141-3" tabindex="-1"></a></span>
<span id="cb141-4"><a href="miscellaneous.html#cb141-4" tabindex="-1"></a><span class="co"># Literature:</span></span>
<span id="cb141-5"><a href="miscellaneous.html#cb141-5" tabindex="-1"></a><span class="co"># Hauff, S., Richter, N. F., Sarstedt, M., &amp; Ringle, C. M. (2024). </span></span>
<span id="cb141-6"><a href="miscellaneous.html#cb141-6" tabindex="-1"></a><span class="co"># Importance and performance in PLS-SEM and NCA: Introducing the combined importance-performance map analysis (cIPMA).</span></span>
<span id="cb141-7"><a href="miscellaneous.html#cb141-7" tabindex="-1"></a><span class="co"># Journal of Retailing and Consumer Services, 78, 103723.</span></span>
<span id="cb141-8"><a href="miscellaneous.html#cb141-8" tabindex="-1"></a><span class="co"># https://doi.org/10.1016/j.jretconser.2024.103723</span></span>
<span id="cb141-9"><a href="miscellaneous.html#cb141-9" tabindex="-1"></a></span>
<span id="cb141-10"><a href="miscellaneous.html#cb141-10" tabindex="-1"></a><span class="co"># Richter, N. F., Schubring, S., Hauff, S., Ringle, C. M., &amp; Sarstedt, M. (2020). </span></span>
<span id="cb141-11"><a href="miscellaneous.html#cb141-11" tabindex="-1"></a><span class="co"># When predictors of outcomes are necessary: Guidelines for the combined use of PLS-SEM and NCA.</span></span>
<span id="cb141-12"><a href="miscellaneous.html#cb141-12" tabindex="-1"></a><span class="co"># Industrial Management &amp; Data Systems, 120(12), 2243–2267. </span></span>
<span id="cb141-13"><a href="miscellaneous.html#cb141-13" tabindex="-1"></a><span class="co"># https://doi.org/10.1108/IMDS-11-2019-0638</span></span>
<span id="cb141-14"><a href="miscellaneous.html#cb141-14" tabindex="-1"></a></span>
<span id="cb141-15"><a href="miscellaneous.html#cb141-15" tabindex="-1"></a><span class="co"># Richter, N. F., Hauff, S., Ringle, C. M., Sarstedt, M., Kolev, A. E., &amp; Schubring, S. (2023). </span></span>
<span id="cb141-16"><a href="miscellaneous.html#cb141-16" tabindex="-1"></a><span class="co"># How to apply necessary condition analysis in PLS-SEM. In Partial least squares path modeling: Basic concepts, methodological issues and applications (pp. 267–297). </span></span>
<span id="cb141-17"><a href="miscellaneous.html#cb141-17" tabindex="-1"></a><span class="co"># Springer. </span></span>
<span id="cb141-18"><a href="miscellaneous.html#cb141-18" tabindex="-1"></a><span class="co"># https://link.springer.com/chapter/10.1007/978-3-031-37772-3_10</span></span>
<span id="cb141-19"><a href="miscellaneous.html#cb141-19" tabindex="-1"></a></span>
<span id="cb141-20"><a href="miscellaneous.html#cb141-20" tabindex="-1"></a><span class="co"># Sarstedt, M., Richter, N. F., Hauff, S., &amp; Ringle, C. M. (2024). </span></span>
<span id="cb141-21"><a href="miscellaneous.html#cb141-21" tabindex="-1"></a><span class="co"># Combined importance–performance map analysis (cIPMA) in partial least squares structural equation modeling (PLS–SEM): A SmartPLS 4 tutorial. </span></span>
<span id="cb141-22"><a href="miscellaneous.html#cb141-22" tabindex="-1"></a><span class="co"># Journal of Marketing Analytics, 1–15. </span></span>
<span id="cb141-23"><a href="miscellaneous.html#cb141-23" tabindex="-1"></a><span class="co"># https://doi.org/10.1057/s41270-024-00325-y</span></span>
<span id="cb141-24"><a href="miscellaneous.html#cb141-24" tabindex="-1"></a></span>
<span id="cb141-25"><a href="miscellaneous.html#cb141-25" tabindex="-1"></a><span class="co"># Data sources: </span></span>
<span id="cb141-26"><a href="miscellaneous.html#cb141-26" tabindex="-1"></a><span class="co"># Schubring, S., &amp; Richter, N. (2023). </span></span>
<span id="cb141-27"><a href="miscellaneous.html#cb141-27" tabindex="-1"></a><span class="co"># Extended TAM (Version V4). </span></span>
<span id="cb141-28"><a href="miscellaneous.html#cb141-28" tabindex="-1"></a><span class="co"># Mendeley Data. </span></span>
<span id="cb141-29"><a href="miscellaneous.html#cb141-29" tabindex="-1"></a><span class="co"># https://doi.org/10.17632/pd5dp3phx2.4https://osf.io/35a6d/files/osfstorage?view_only=849040255d43480696cd60a43d664660</span></span>
<span id="cb141-30"><a href="miscellaneous.html#cb141-30" tabindex="-1"></a></span>
<span id="cb141-31"><a href="miscellaneous.html#cb141-31" tabindex="-1"></a><span class="co"># Richter, N. F., Hauff, S., Kolev, A. E., &amp; Schubring, S. (2023).</span></span>
<span id="cb141-32"><a href="miscellaneous.html#cb141-32" tabindex="-1"></a><span class="co"># Dataset on an extended technology acceptance model: A combined application of PLS-SEM and NCA. </span></span>
<span id="cb141-33"><a href="miscellaneous.html#cb141-33" tabindex="-1"></a><span class="co"># Data in Brief, 48, 109190. </span></span>
<span id="cb141-34"><a href="miscellaneous.html#cb141-34" tabindex="-1"></a><span class="co"># https://doi.org/10.1016/j.dib.2023.109190</span></span>
<span id="cb141-35"><a href="miscellaneous.html#cb141-35" tabindex="-1"></a></span>
<span id="cb141-36"><a href="miscellaneous.html#cb141-36" tabindex="-1"></a>get_indicator_data_TAM <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb141-37"><a href="miscellaneous.html#cb141-37" tabindex="-1"></a></span>
<span id="cb141-38"><a href="miscellaneous.html#cb141-38" tabindex="-1"></a><span class="co"># Load the data  </span></span>
<span id="cb141-39"><a href="miscellaneous.html#cb141-39" tabindex="-1"></a>df0 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;Extended TAM.csv&quot;</span>)</span>
<span id="cb141-40"><a href="miscellaneous.html#cb141-40" tabindex="-1"></a></span>
<span id="cb141-41"><a href="miscellaneous.html#cb141-41" tabindex="-1"></a><span class="co"># Preview the data</span></span>
<span id="cb141-42"><a href="miscellaneous.html#cb141-42" tabindex="-1"></a><span class="fu">head</span>(df0, <span class="dv">3</span>)</span>
<span id="cb141-43"><a href="miscellaneous.html#cb141-43" tabindex="-1"></a></span>
<span id="cb141-44"><a href="miscellaneous.html#cb141-44" tabindex="-1"></a><span class="co"># Make a new dataset with only indicator scores of SEM model (without last four variables)</span></span>
<span id="cb141-45"><a href="miscellaneous.html#cb141-45" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> df0[, <span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(df0) <span class="sc">-</span> <span class="dv">4</span>)]</span>
<span id="cb141-46"><a href="miscellaneous.html#cb141-46" tabindex="-1"></a></span>
<span id="cb141-47"><a href="miscellaneous.html#cb141-47" tabindex="-1"></a><span class="co"># Rename the indicators </span></span>
<span id="cb141-48"><a href="miscellaneous.html#cb141-48" tabindex="-1"></a><span class="fu">colnames</span>(df1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;PU1&quot;</span>,<span class="st">&quot;PU2&quot;</span>,<span class="st">&quot;PU3&quot;</span>,</span>
<span id="cb141-49"><a href="miscellaneous.html#cb141-49" tabindex="-1"></a>                   <span class="st">&quot;CO1&quot;</span>,<span class="st">&quot;CO2&quot;</span>,<span class="st">&quot;CO3&quot;</span>,</span>
<span id="cb141-50"><a href="miscellaneous.html#cb141-50" tabindex="-1"></a>                   <span class="st">&quot;EOU1&quot;</span>, <span class="st">&quot;EOU2&quot;</span>,<span class="st">&quot;EOU3&quot;</span>,</span>
<span id="cb141-51"><a href="miscellaneous.html#cb141-51" tabindex="-1"></a>                   <span class="st">&quot;EMV1&quot;</span>, <span class="st">&quot;EMV2&quot;</span>,<span class="st">&quot;EMV3&quot;</span>,</span>
<span id="cb141-52"><a href="miscellaneous.html#cb141-52" tabindex="-1"></a>                   <span class="st">&quot;AD1&quot;</span>,  <span class="st">&quot;AD2&quot;</span>,<span class="st">&quot;AD3&quot;</span>,</span>
<span id="cb141-53"><a href="miscellaneous.html#cb141-53" tabindex="-1"></a>                   <span class="st">&quot;USE&quot;</span>)</span>
<span id="cb141-54"><a href="miscellaneous.html#cb141-54" tabindex="-1"></a></span>
<span id="cb141-55"><a href="miscellaneous.html#cb141-55" tabindex="-1"></a><span class="co"># Preview the new dataset</span></span>
<span id="cb141-56"><a href="miscellaneous.html#cb141-56" tabindex="-1"></a><span class="fu">head</span>(df1,<span class="dv">3</span>)</span>
<span id="cb141-57"><a href="miscellaneous.html#cb141-57" tabindex="-1"></a></span>
<span id="cb141-58"><a href="miscellaneous.html#cb141-58" tabindex="-1"></a><span class="fu">return</span>(df1)</span>
<span id="cb141-59"><a href="miscellaneous.html#cb141-59" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="estimatesemmodel" class="section level3 hasAnchor" number="7.4.5">
<h3><span class="header-section-number">7.4.5</span> <code>estimate_sem_model_TAM.R</code><a href="miscellaneous.html#estimatesemmodel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="miscellaneous.html#cb142-1" tabindex="-1"></a><span class="co"># Helper function to estimate SEM model for the TAM example</span></span>
<span id="cb142-2"><a href="miscellaneous.html#cb142-2" tabindex="-1"></a><span class="co"># revised 23 May, 2025</span></span>
<span id="cb142-3"><a href="miscellaneous.html#cb142-3" tabindex="-1"></a></span>
<span id="cb142-4"><a href="miscellaneous.html#cb142-4" tabindex="-1"></a>estimate_sem_model_TAM <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb142-5"><a href="miscellaneous.html#cb142-5" tabindex="-1"></a><span class="co"># Load library for conducting SEM</span></span>
<span id="cb142-6"><a href="miscellaneous.html#cb142-6" tabindex="-1"></a><span class="fu">library</span>(seminr)</span>
<span id="cb142-7"><a href="miscellaneous.html#cb142-7" tabindex="-1"></a></span>
<span id="cb142-8"><a href="miscellaneous.html#cb142-8" tabindex="-1"></a><span class="co"># Specify the measurement model</span></span>
<span id="cb142-9"><a href="miscellaneous.html#cb142-9" tabindex="-1"></a>TAM_mm <span class="ot">&lt;-</span> <span class="fu">constructs</span>(</span>
<span id="cb142-10"><a href="miscellaneous.html#cb142-10" tabindex="-1"></a>  <span class="fu">composite</span>(<span class="st">&quot;Perceived usefulness&quot;</span>, <span class="fu">multi_items</span>(<span class="st">&quot;PU&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)),</span>
<span id="cb142-11"><a href="miscellaneous.html#cb142-11" tabindex="-1"></a>  <span class="fu">composite</span>(<span class="st">&quot;Compatibility&quot;</span>, <span class="fu">multi_items</span>(<span class="st">&quot;CO&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)),</span>
<span id="cb142-12"><a href="miscellaneous.html#cb142-12" tabindex="-1"></a>  <span class="fu">composite</span>(<span class="st">&quot;Perceived ease of use&quot;</span>, <span class="fu">multi_items</span>(<span class="st">&quot;EOU&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)),</span>
<span id="cb142-13"><a href="miscellaneous.html#cb142-13" tabindex="-1"></a>  <span class="fu">composite</span>(<span class="st">&quot;Emotional value&quot;</span>, <span class="fu">multi_items</span>(<span class="st">&quot;EMV&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)),</span>
<span id="cb142-14"><a href="miscellaneous.html#cb142-14" tabindex="-1"></a>  <span class="fu">composite</span>(<span class="st">&quot;Adoption intention&quot;</span>, <span class="fu">multi_items</span>(<span class="st">&quot;AD&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)),</span>
<span id="cb142-15"><a href="miscellaneous.html#cb142-15" tabindex="-1"></a>  <span class="fu">composite</span>(<span class="st">&quot;Technology use&quot;</span>, <span class="fu">single_item</span>(<span class="st">&quot;USE&quot;</span>))</span>
<span id="cb142-16"><a href="miscellaneous.html#cb142-16" tabindex="-1"></a>)</span>
<span id="cb142-17"><a href="miscellaneous.html#cb142-17" tabindex="-1"></a></span>
<span id="cb142-18"><a href="miscellaneous.html#cb142-18" tabindex="-1"></a><span class="co"># Specify the structural model</span></span>
<span id="cb142-19"><a href="miscellaneous.html#cb142-19" tabindex="-1"></a>TAM_sm <span class="ot">&lt;-</span> <span class="fu">relationships</span>(</span>
<span id="cb142-20"><a href="miscellaneous.html#cb142-20" tabindex="-1"></a>  <span class="fu">paths</span>(<span class="at">from =</span> <span class="st">&quot;Perceived usefulness&quot;</span>, <span class="at">to =</span> <span class="fu">c</span>(<span class="st">&quot;Adoption intention&quot;</span>, <span class="st">&quot;Technology use&quot;</span>)),</span>
<span id="cb142-21"><a href="miscellaneous.html#cb142-21" tabindex="-1"></a>  <span class="fu">paths</span>(<span class="at">from =</span> <span class="st">&quot;Compatibility&quot;</span>,         <span class="at">to =</span> <span class="fu">c</span>(<span class="st">&quot;Adoption intention&quot;</span>, <span class="st">&quot;Technology use&quot;</span>)),</span>
<span id="cb142-22"><a href="miscellaneous.html#cb142-22" tabindex="-1"></a>  <span class="fu">paths</span>(<span class="at">from =</span> <span class="st">&quot;Perceived ease of use&quot;</span>, <span class="at">to =</span> <span class="fu">c</span>(<span class="st">&quot;Adoption intention&quot;</span>, <span class="st">&quot;Technology use&quot;</span>)),</span>
<span id="cb142-23"><a href="miscellaneous.html#cb142-23" tabindex="-1"></a>  <span class="fu">paths</span>(<span class="at">from =</span> <span class="st">&quot;Emotional value&quot;</span>,       <span class="at">to =</span> <span class="fu">c</span>(<span class="st">&quot;Adoption intention&quot;</span>, <span class="st">&quot;Technology use&quot;</span>)),</span>
<span id="cb142-24"><a href="miscellaneous.html#cb142-24" tabindex="-1"></a>  <span class="fu">paths</span>(<span class="at">from =</span> <span class="st">&quot;Adoption intention&quot;</span>,    <span class="at">to =</span> <span class="fu">c</span>(<span class="st">&quot;Technology use&quot;</span>))</span>
<span id="cb142-25"><a href="miscellaneous.html#cb142-25" tabindex="-1"></a>)</span>
<span id="cb142-26"><a href="miscellaneous.html#cb142-26" tabindex="-1"></a></span>
<span id="cb142-27"><a href="miscellaneous.html#cb142-27" tabindex="-1"></a><span class="co"># Estimate the pls model (using indicator data)</span></span>
<span id="cb142-28"><a href="miscellaneous.html#cb142-28" tabindex="-1"></a></span>
<span id="cb142-29"><a href="miscellaneous.html#cb142-29" tabindex="-1"></a><span class="co"># Conduct pls estimation with raw indicator scores</span></span>
<span id="cb142-30"><a href="miscellaneous.html#cb142-30" tabindex="-1"></a>TAM_pls <span class="ot">&lt;-</span> <span class="fu">estimate_pls</span>(<span class="at">data =</span> data,</span>
<span id="cb142-31"><a href="miscellaneous.html#cb142-31" tabindex="-1"></a>                        <span class="at">measurement_model =</span> TAM_mm,</span>
<span id="cb142-32"><a href="miscellaneous.html#cb142-32" tabindex="-1"></a>                        <span class="at">structural_model =</span> TAM_sm)</span>
<span id="cb142-33"><a href="miscellaneous.html#cb142-33" tabindex="-1"></a></span>
<span id="cb142-34"><a href="miscellaneous.html#cb142-34" tabindex="-1"></a><span class="co"># Print path coefficients and model fit measures</span></span>
<span id="cb142-35"><a href="miscellaneous.html#cb142-35" tabindex="-1"></a><span class="fu">summary</span>(TAM_pls)</span>
<span id="cb142-36"><a href="miscellaneous.html#cb142-36" tabindex="-1"></a></span>
<span id="cb142-37"><a href="miscellaneous.html#cb142-37" tabindex="-1"></a><span class="fu">return</span> (TAM_pls)</span>
<span id="cb142-38"><a href="miscellaneous.html#cb142-38" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="significancesem" class="section level3 hasAnchor" number="7.4.6">
<h3><span class="header-section-number">7.4.6</span> <code>get_signficance_sem.R</code><a href="miscellaneous.html#significancesem" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="miscellaneous.html#cb143-1" tabindex="-1"></a><span class="co"># Helper function to get significance of SEM predictors</span></span>
<span id="cb143-2"><a href="miscellaneous.html#cb143-2" tabindex="-1"></a><span class="co"># Revised August 4, 2025</span></span>
<span id="cb143-3"><a href="miscellaneous.html#cb143-3" tabindex="-1"></a></span>
<span id="cb143-4"><a href="miscellaneous.html#cb143-4" tabindex="-1"></a>get_significance_sem <span class="ot">&lt;-</span> <span class="cf">function</span>(sem, <span class="at">nboot =</span> <span class="dv">5000</span>) {</span>
<span id="cb143-5"><a href="miscellaneous.html#cb143-5" tabindex="-1"></a>  </span>
<span id="cb143-6"><a href="miscellaneous.html#cb143-6" tabindex="-1"></a>  <span class="co"># Run bootstrap</span></span>
<span id="cb143-7"><a href="miscellaneous.html#cb143-7" tabindex="-1"></a>  boot_model <span class="ot">&lt;-</span> <span class="fu">bootstrap_model</span>(sem, <span class="at">nboot =</span> nboot) <span class="co"># alpha is fixed at 0.05 </span></span>
<span id="cb143-8"><a href="miscellaneous.html#cb143-8" tabindex="-1"></a>  </span>
<span id="cb143-9"><a href="miscellaneous.html#cb143-9" tabindex="-1"></a>  <span class="co"># Extract direct and total path matrices</span></span>
<span id="cb143-10"><a href="miscellaneous.html#cb143-10" tabindex="-1"></a>  df_direct <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">summary</span>(boot_model)[[<span class="dv">2</span>]])</span>
<span id="cb143-11"><a href="miscellaneous.html#cb143-11" tabindex="-1"></a>  df_total  <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">summary</span>(boot_model)[[<span class="dv">6</span>]])</span>
<span id="cb143-12"><a href="miscellaneous.html#cb143-12" tabindex="-1"></a>  </span>
<span id="cb143-13"><a href="miscellaneous.html#cb143-13" tabindex="-1"></a>  <span class="co"># Rename confidence interval columns</span></span>
<span id="cb143-14"><a href="miscellaneous.html#cb143-14" tabindex="-1"></a>  <span class="fu">colnames</span>(df_direct)[<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;CI_low&quot;</span>, <span class="st">&quot;CI_high&quot;</span>)</span>
<span id="cb143-15"><a href="miscellaneous.html#cb143-15" tabindex="-1"></a>  <span class="fu">colnames</span>(df_total)[<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>]  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;CI_low&quot;</span>, <span class="st">&quot;CI_high&quot;</span>)</span>
<span id="cb143-16"><a href="miscellaneous.html#cb143-16" tabindex="-1"></a>  </span>
<span id="cb143-17"><a href="miscellaneous.html#cb143-17" tabindex="-1"></a>  <span class="co"># Add Path column from rownames</span></span>
<span id="cb143-18"><a href="miscellaneous.html#cb143-18" tabindex="-1"></a>  df_direct <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">Path =</span> <span class="fu">rownames</span>(df_direct), df_direct)</span>
<span id="cb143-19"><a href="miscellaneous.html#cb143-19" tabindex="-1"></a>  df_total  <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">Path =</span> <span class="fu">rownames</span>(df_total), df_total)</span>
<span id="cb143-20"><a href="miscellaneous.html#cb143-20" tabindex="-1"></a>  </span>
<span id="cb143-21"><a href="miscellaneous.html#cb143-21" tabindex="-1"></a>  <span class="co"># Reset row names</span></span>
<span id="cb143-22"><a href="miscellaneous.html#cb143-22" tabindex="-1"></a>  <span class="fu">rownames</span>(df_direct) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb143-23"><a href="miscellaneous.html#cb143-23" tabindex="-1"></a>  <span class="fu">rownames</span>(df_total)  <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb143-24"><a href="miscellaneous.html#cb143-24" tabindex="-1"></a>  </span>
<span id="cb143-25"><a href="miscellaneous.html#cb143-25" tabindex="-1"></a>  <span class="co"># Keep original order</span></span>
<span id="cb143-26"><a href="miscellaneous.html#cb143-26" tabindex="-1"></a>  path_order <span class="ot">&lt;-</span> df_direct<span class="sc">$</span>Path</span>
<span id="cb143-27"><a href="miscellaneous.html#cb143-27" tabindex="-1"></a>  </span>
<span id="cb143-28"><a href="miscellaneous.html#cb143-28" tabindex="-1"></a>  <span class="co"># Merge direct and total</span></span>
<span id="cb143-29"><a href="miscellaneous.html#cb143-29" tabindex="-1"></a>  merged_df <span class="ot">&lt;-</span> <span class="fu">merge</span>(df_total, df_direct, <span class="at">by =</span> <span class="st">&quot;Path&quot;</span>, <span class="at">suffixes =</span> <span class="fu">c</span>(<span class="st">&quot;_total&quot;</span>, <span class="st">&quot;_direct&quot;</span>))</span>
<span id="cb143-30"><a href="miscellaneous.html#cb143-30" tabindex="-1"></a>  </span>
<span id="cb143-31"><a href="miscellaneous.html#cb143-31" tabindex="-1"></a>  <span class="co"># Clean column names for safe access</span></span>
<span id="cb143-32"><a href="miscellaneous.html#cb143-32" tabindex="-1"></a>  <span class="fu">colnames</span>(merged_df) <span class="ot">&lt;-</span> <span class="fu">make.names</span>(<span class="fu">colnames</span>(merged_df))</span>
<span id="cb143-33"><a href="miscellaneous.html#cb143-33" tabindex="-1"></a>  </span>
<span id="cb143-34"><a href="miscellaneous.html#cb143-34" tabindex="-1"></a>  <span class="co"># Calculate indirect effect</span></span>
<span id="cb143-35"><a href="miscellaneous.html#cb143-35" tabindex="-1"></a>  merged_df<span class="sc">$</span>Indirect_Estimate <span class="ot">&lt;-</span> merged_df<span class="sc">$</span>Original.Est._total <span class="sc">-</span> merged_df<span class="sc">$</span>Original.Est._direct</span>
<span id="cb143-36"><a href="miscellaneous.html#cb143-36" tabindex="-1"></a>  </span>
<span id="cb143-37"><a href="miscellaneous.html#cb143-37" tabindex="-1"></a>  <span class="co"># Significance flags</span></span>
<span id="cb143-38"><a href="miscellaneous.html#cb143-38" tabindex="-1"></a>  merged_df<span class="sc">$</span>Sig_Direct   <span class="ot">&lt;-</span> (merged_df<span class="sc">$</span>CI_low_direct <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> merged_df<span class="sc">$</span>CI_high_direct <span class="sc">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb143-39"><a href="miscellaneous.html#cb143-39" tabindex="-1"></a>  merged_df<span class="sc">$</span>Sig_Total    <span class="ot">&lt;-</span> (merged_df<span class="sc">$</span>CI_low_total <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> merged_df<span class="sc">$</span>CI_high_total <span class="sc">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb143-40"><a href="miscellaneous.html#cb143-40" tabindex="-1"></a>  merged_df<span class="sc">$</span>Sig_Indirect <span class="ot">&lt;-</span> merged_df<span class="sc">$</span>Sig_Total <span class="sc">&amp;</span> <span class="sc">!</span>merged_df<span class="sc">$</span>Sig_Direct</span>
<span id="cb143-41"><a href="miscellaneous.html#cb143-41" tabindex="-1"></a>  </span>
<span id="cb143-42"><a href="miscellaneous.html#cb143-42" tabindex="-1"></a>  <span class="co"># Final summary</span></span>
<span id="cb143-43"><a href="miscellaneous.html#cb143-43" tabindex="-1"></a>  summary_df <span class="ot">&lt;-</span> merged_df[, <span class="fu">c</span>(</span>
<span id="cb143-44"><a href="miscellaneous.html#cb143-44" tabindex="-1"></a>    <span class="st">&quot;Path&quot;</span>,</span>
<span id="cb143-45"><a href="miscellaneous.html#cb143-45" tabindex="-1"></a>    <span class="st">&quot;Original.Est._direct&quot;</span>, <span class="st">&quot;Indirect_Estimate&quot;</span>, <span class="st">&quot;Original.Est._total&quot;</span>,</span>
<span id="cb143-46"><a href="miscellaneous.html#cb143-46" tabindex="-1"></a>    <span class="st">&quot;Sig_Direct&quot;</span>, <span class="st">&quot;Sig_Indirect&quot;</span>, <span class="st">&quot;Sig_Total&quot;</span></span>
<span id="cb143-47"><a href="miscellaneous.html#cb143-47" tabindex="-1"></a>  )]</span>
<span id="cb143-48"><a href="miscellaneous.html#cb143-48" tabindex="-1"></a>  </span>
<span id="cb143-49"><a href="miscellaneous.html#cb143-49" tabindex="-1"></a>  <span class="co"># Round for readability</span></span>
<span id="cb143-50"><a href="miscellaneous.html#cb143-50" tabindex="-1"></a>  summary_df <span class="ot">&lt;-</span> <span class="fu">within</span>(summary_df, {</span>
<span id="cb143-51"><a href="miscellaneous.html#cb143-51" tabindex="-1"></a>    Original.Est._direct  <span class="ot">&lt;-</span> <span class="fu">round</span>(Original.Est._direct, <span class="dv">3</span>)</span>
<span id="cb143-52"><a href="miscellaneous.html#cb143-52" tabindex="-1"></a>    Indirect_Estimate     <span class="ot">&lt;-</span> <span class="fu">round</span>(Indirect_Estimate, <span class="dv">3</span>)</span>
<span id="cb143-53"><a href="miscellaneous.html#cb143-53" tabindex="-1"></a>    Original.Est._total   <span class="ot">&lt;-</span> <span class="fu">round</span>(Original.Est._total, <span class="dv">3</span>)</span>
<span id="cb143-54"><a href="miscellaneous.html#cb143-54" tabindex="-1"></a>  })</span>
<span id="cb143-55"><a href="miscellaneous.html#cb143-55" tabindex="-1"></a>  </span>
<span id="cb143-56"><a href="miscellaneous.html#cb143-56" tabindex="-1"></a>  <span class="co"># Preserve original order</span></span>
<span id="cb143-57"><a href="miscellaneous.html#cb143-57" tabindex="-1"></a>  summary_df<span class="sc">$</span>Path <span class="ot">&lt;-</span> <span class="fu">factor</span>(summary_df<span class="sc">$</span>Path, <span class="at">levels =</span> path_order)</span>
<span id="cb143-58"><a href="miscellaneous.html#cb143-58" tabindex="-1"></a>  summary_df <span class="ot">&lt;-</span> summary_df[<span class="fu">order</span>(summary_df<span class="sc">$</span>Path), ]</span>
<span id="cb143-59"><a href="miscellaneous.html#cb143-59" tabindex="-1"></a>  </span>
<span id="cb143-60"><a href="miscellaneous.html#cb143-60" tabindex="-1"></a>  <span class="fu">colnames</span>(summary_df)[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Direct&quot;</span>, <span class="st">&quot;Indirect&quot;</span>, <span class="st">&quot;Total&quot;</span>)</span>
<span id="cb143-61"><a href="miscellaneous.html#cb143-61" tabindex="-1"></a>  </span>
<span id="cb143-62"><a href="miscellaneous.html#cb143-62" tabindex="-1"></a>  <span class="co"># Extract predicted variable from path (RHS of arrow)</span></span>
<span id="cb143-63"><a href="miscellaneous.html#cb143-63" tabindex="-1"></a>  get_rhs <span class="ot">&lt;-</span> <span class="cf">function</span>(path_string) {</span>
<span id="cb143-64"><a href="miscellaneous.html#cb143-64" tabindex="-1"></a>    <span class="fu">strsplit</span>(<span class="fu">as.character</span>(path_string), <span class="st">&quot;-&gt;&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>] <span class="sc">|&gt;</span> <span class="fu">trimws</span>()</span>
<span id="cb143-65"><a href="miscellaneous.html#cb143-65" tabindex="-1"></a>  }</span>
<span id="cb143-66"><a href="miscellaneous.html#cb143-66" tabindex="-1"></a>  summary_df<span class="sc">$</span>Predicted <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">as.character</span>(summary_df<span class="sc">$</span>Path), get_rhs)</span>
<span id="cb143-67"><a href="miscellaneous.html#cb143-67" tabindex="-1"></a>  </span>
<span id="cb143-68"><a href="miscellaneous.html#cb143-68" tabindex="-1"></a>  <span class="co"># Return final table</span></span>
<span id="cb143-69"><a href="miscellaneous.html#cb143-69" tabindex="-1"></a>  <span class="fu">return</span>(summary_df)</span>
<span id="cb143-70"><a href="miscellaneous.html#cb143-70" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="unstandardize" class="section level3 hasAnchor" number="7.4.7">
<h3><span class="header-section-number">7.4.7</span> <code>unstandardize.R</code><a href="miscellaneous.html#unstandardize" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="miscellaneous.html#cb144-1" tabindex="-1"></a><span class="co"># Helper function to obtain a dataset with the unstandardized latent variables </span></span>
<span id="cb144-2"><a href="miscellaneous.html#cb144-2" tabindex="-1"></a><span class="co"># using the output of the SEMinR pls model estimation as function argument.</span></span>
<span id="cb144-3"><a href="miscellaneous.html#cb144-3" tabindex="-1"></a></span>
<span id="cb144-4"><a href="miscellaneous.html#cb144-4" tabindex="-1"></a><span class="co"># Revised May 23, 2025</span></span>
<span id="cb144-5"><a href="miscellaneous.html#cb144-5" tabindex="-1"></a>unstandardize <span class="ot">&lt;-</span> <span class="cf">function</span>(sem) {</span>
<span id="cb144-6"><a href="miscellaneous.html#cb144-6" tabindex="-1"></a>  </span>
<span id="cb144-7"><a href="miscellaneous.html#cb144-7" tabindex="-1"></a>  <span class="co"># Extract the original indicators</span></span>
<span id="cb144-8"><a href="miscellaneous.html#cb144-8" tabindex="-1"></a>  original_indicators_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(sem<span class="sc">$</span>rawdata)</span>
<span id="cb144-9"><a href="miscellaneous.html#cb144-9" tabindex="-1"></a>  </span>
<span id="cb144-10"><a href="miscellaneous.html#cb144-10" tabindex="-1"></a>  <span class="co"># Extract the standardized weights and store results in a dataframe</span></span>
<span id="cb144-11"><a href="miscellaneous.html#cb144-11" tabindex="-1"></a>  standardized_weights_matrix <span class="ot">&lt;-</span> sem<span class="sc">$</span>outer_weights</span>
<span id="cb144-12"><a href="miscellaneous.html#cb144-12" tabindex="-1"></a>  standardized_weights_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(standardized_weights_matrix))</span>
<span id="cb144-13"><a href="miscellaneous.html#cb144-13" tabindex="-1"></a>  <span class="fu">colnames</span>(standardized_weights_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Indicator&quot;</span>, <span class="st">&quot;Latent variable&quot;</span>, <span class="st">&quot;Standardized weight&quot;</span>)</span>
<span id="cb144-14"><a href="miscellaneous.html#cb144-14" tabindex="-1"></a>  standardized_weights_df <span class="ot">&lt;-</span> <span class="fu">subset</span>(standardized_weights_df, <span class="st">`</span><span class="at">Standardized weight</span><span class="st">`</span> <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb144-15"><a href="miscellaneous.html#cb144-15" tabindex="-1"></a>  </span>
<span id="cb144-16"><a href="miscellaneous.html#cb144-16" tabindex="-1"></a>  <span class="co"># Match SDs to indicators</span></span>
<span id="cb144-17"><a href="miscellaneous.html#cb144-17" tabindex="-1"></a>  standardized_weights_df<span class="sc">$</span>SD <span class="ot">&lt;-</span> sem<span class="sc">$</span>sdData[<span class="fu">as.character</span>(standardized_weights_df<span class="sc">$</span>Indicator)]</span>
<span id="cb144-18"><a href="miscellaneous.html#cb144-18" tabindex="-1"></a>  </span>
<span id="cb144-19"><a href="miscellaneous.html#cb144-19" tabindex="-1"></a>  <span class="co"># Compute unstandardized weights</span></span>
<span id="cb144-20"><a href="miscellaneous.html#cb144-20" tabindex="-1"></a>  standardized_weights_df<span class="sc">$</span><span class="st">`</span><span class="at">Unstandardized weight</span><span class="st">`</span> <span class="ot">&lt;-</span> </span>
<span id="cb144-21"><a href="miscellaneous.html#cb144-21" tabindex="-1"></a>  standardized_weights_df<span class="sc">$</span><span class="st">`</span><span class="at">Standardized weight</span><span class="st">`</span> <span class="sc">/</span> standardized_weights_df<span class="sc">$</span>SD  <span class="co"># Following Ringle and Sarstedt 2016 </span></span>
<span id="cb144-22"><a href="miscellaneous.html#cb144-22" tabindex="-1"></a>  </span>
<span id="cb144-23"><a href="miscellaneous.html#cb144-23" tabindex="-1"></a>   <span class="co"># Normalize weights within each latent variable</span></span>
<span id="cb144-24"><a href="miscellaneous.html#cb144-24" tabindex="-1"></a>  sum_weights <span class="ot">&lt;-</span> <span class="fu">tapply</span>(</span>
<span id="cb144-25"><a href="miscellaneous.html#cb144-25" tabindex="-1"></a>    standardized_weights_df<span class="sc">$</span><span class="st">`</span><span class="at">Unstandardized weight</span><span class="st">`</span>, </span>
<span id="cb144-26"><a href="miscellaneous.html#cb144-26" tabindex="-1"></a>    standardized_weights_df<span class="sc">$</span><span class="st">`</span><span class="at">Latent variable</span><span class="st">`</span>, </span>
<span id="cb144-27"><a href="miscellaneous.html#cb144-27" tabindex="-1"></a>    sum</span>
<span id="cb144-28"><a href="miscellaneous.html#cb144-28" tabindex="-1"></a>  )</span>
<span id="cb144-29"><a href="miscellaneous.html#cb144-29" tabindex="-1"></a>  </span>
<span id="cb144-30"><a href="miscellaneous.html#cb144-30" tabindex="-1"></a>  standardized_weights_df<span class="sc">$</span><span class="st">`</span><span class="at">Sum unstandardized weight</span><span class="st">`</span> <span class="ot">&lt;-</span> </span>
<span id="cb144-31"><a href="miscellaneous.html#cb144-31" tabindex="-1"></a>    sum_weights[<span class="fu">match</span>(standardized_weights_df<span class="sc">$</span><span class="st">`</span><span class="at">Latent variable</span><span class="st">`</span>, <span class="fu">names</span>(sum_weights))]</span>
<span id="cb144-32"><a href="miscellaneous.html#cb144-32" tabindex="-1"></a>  </span>
<span id="cb144-33"><a href="miscellaneous.html#cb144-33" tabindex="-1"></a>  standardized_weights_df<span class="sc">$</span><span class="st">`</span><span class="at">Normalized unstandardized weight</span><span class="st">`</span> <span class="ot">&lt;-</span> </span>
<span id="cb144-34"><a href="miscellaneous.html#cb144-34" tabindex="-1"></a>    standardized_weights_df<span class="sc">$</span><span class="st">`</span><span class="at">Unstandardized weight</span><span class="st">`</span> <span class="sc">/</span> standardized_weights_df<span class="sc">$</span><span class="st">`</span><span class="at">Sum unstandardized weight</span><span class="st">`</span></span>
<span id="cb144-35"><a href="miscellaneous.html#cb144-35" tabindex="-1"></a>  </span>
<span id="cb144-36"><a href="miscellaneous.html#cb144-36" tabindex="-1"></a>  <span class="co"># Compute unstandardized latent variables</span></span>
<span id="cb144-37"><a href="miscellaneous.html#cb144-37" tabindex="-1"></a>  unstandardized_latent_variable_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(original_indicators_df), <span class="at">ncol =</span> <span class="dv">0</span>))</span>
<span id="cb144-38"><a href="miscellaneous.html#cb144-38" tabindex="-1"></a>  </span>
<span id="cb144-39"><a href="miscellaneous.html#cb144-39" tabindex="-1"></a>  <span class="cf">for</span> (latent_variable <span class="cf">in</span> <span class="fu">unique</span>(standardized_weights_df<span class="sc">$</span><span class="st">`</span><span class="at">Latent variable</span><span class="st">`</span>)) {</span>
<span id="cb144-40"><a href="miscellaneous.html#cb144-40" tabindex="-1"></a>    latent_data <span class="ot">&lt;-</span> <span class="fu">subset</span>(standardized_weights_df, <span class="st">`</span><span class="at">Latent variable</span><span class="st">`</span> <span class="sc">==</span> latent_variable)</span>
<span id="cb144-41"><a href="miscellaneous.html#cb144-41" tabindex="-1"></a>    indicators <span class="ot">&lt;-</span> <span class="fu">as.character</span>(latent_data<span class="sc">$</span>Indicator)</span>
<span id="cb144-42"><a href="miscellaneous.html#cb144-42" tabindex="-1"></a>    weights <span class="ot">&lt;-</span> latent_data<span class="sc">$</span><span class="st">`</span><span class="at">Normalized unstandardized weight</span><span class="st">`</span></span>
<span id="cb144-43"><a href="miscellaneous.html#cb144-43" tabindex="-1"></a>    indicator_scores <span class="ot">&lt;-</span> original_indicators_df[, indicators, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb144-44"><a href="miscellaneous.html#cb144-44" tabindex="-1"></a>    latent_score <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">sweep</span>(indicator_scores, <span class="dv">2</span>, weights, <span class="st">`</span><span class="at">*</span><span class="st">`</span>))</span>
<span id="cb144-45"><a href="miscellaneous.html#cb144-45" tabindex="-1"></a>    unstandardized_latent_variable_df[[latent_variable]] <span class="ot">&lt;-</span> latent_score</span>
<span id="cb144-46"><a href="miscellaneous.html#cb144-46" tabindex="-1"></a>  }</span>
<span id="cb144-47"><a href="miscellaneous.html#cb144-47" tabindex="-1"></a>  </span>
<span id="cb144-48"><a href="miscellaneous.html#cb144-48" tabindex="-1"></a>  <span class="fu">return</span>(unstandardized_latent_variable_df)</span>
<span id="cb144-49"><a href="miscellaneous.html#cb144-49" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="normalize" class="section level3 hasAnchor" number="7.4.8">
<h3><span class="header-section-number">7.4.8</span> <code>normalize.R</code><a href="miscellaneous.html#normalize" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="miscellaneous.html#cb145-1" tabindex="-1"></a><span class="co"># Helper function to min-max normalize data (scale 0-1 or 0-100)</span></span>
<span id="cb145-2"><a href="miscellaneous.html#cb145-2" tabindex="-1"></a><span class="co"># Revised August 9, 2025</span></span>
<span id="cb145-3"><a href="miscellaneous.html#cb145-3" tabindex="-1"></a></span>
<span id="cb145-4"><a href="miscellaneous.html#cb145-4" tabindex="-1"></a>min_max_normalize <span class="ot">&lt;-</span> <span class="cf">function</span>(data, theoretical_min, theoretical_max, scale) {</span>
<span id="cb145-5"><a href="miscellaneous.html#cb145-5" tabindex="-1"></a>  </span>
<span id="cb145-6"><a href="miscellaneous.html#cb145-6" tabindex="-1"></a>  <span class="co"># Validate inputs</span></span>
<span id="cb145-7"><a href="miscellaneous.html#cb145-7" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(scale) <span class="sc">||</span> <span class="fu">length</span>(scale) <span class="sc">!=</span> <span class="dv">2</span>) {</span>
<span id="cb145-8"><a href="miscellaneous.html#cb145-8" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Scale must be a numeric vector with two elements (e.g., c(0, 100)).&quot;</span>)</span>
<span id="cb145-9"><a href="miscellaneous.html#cb145-9" tabindex="-1"></a>  }</span>
<span id="cb145-10"><a href="miscellaneous.html#cb145-10" tabindex="-1"></a>  </span>
<span id="cb145-11"><a href="miscellaneous.html#cb145-11" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(theoretical_min) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.numeric</span>(theoretical_max)) {</span>
<span id="cb145-12"><a href="miscellaneous.html#cb145-12" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Theoretical min and max must be numeric vectors.&quot;</span>)</span>
<span id="cb145-13"><a href="miscellaneous.html#cb145-13" tabindex="-1"></a>  }</span>
<span id="cb145-14"><a href="miscellaneous.html#cb145-14" tabindex="-1"></a>  </span>
<span id="cb145-15"><a href="miscellaneous.html#cb145-15" tabindex="-1"></a>  <span class="co"># Define new scale minimum and maximum</span></span>
<span id="cb145-16"><a href="miscellaneous.html#cb145-16" tabindex="-1"></a>  new_min <span class="ot">&lt;-</span> scale[<span class="dv">1</span>]</span>
<span id="cb145-17"><a href="miscellaneous.html#cb145-17" tabindex="-1"></a>  new_max <span class="ot">&lt;-</span> scale[<span class="dv">2</span>]</span>
<span id="cb145-18"><a href="miscellaneous.html#cb145-18" tabindex="-1"></a>  </span>
<span id="cb145-19"><a href="miscellaneous.html#cb145-19" tabindex="-1"></a>  <span class="co"># Apply normalization column by column</span></span>
<span id="cb145-20"><a href="miscellaneous.html#cb145-20" tabindex="-1"></a>  normalized_data <span class="ot">&lt;-</span> data</span>
<span id="cb145-21"><a href="miscellaneous.html#cb145-21" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(data)) {</span>
<span id="cb145-22"><a href="miscellaneous.html#cb145-22" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.numeric</span>(data[[i]])) {</span>
<span id="cb145-23"><a href="miscellaneous.html#cb145-23" tabindex="-1"></a>      min_val <span class="ot">&lt;-</span> theoretical_min[i]</span>
<span id="cb145-24"><a href="miscellaneous.html#cb145-24" tabindex="-1"></a>      max_val <span class="ot">&lt;-</span> theoretical_max[i]</span>
<span id="cb145-25"><a href="miscellaneous.html#cb145-25" tabindex="-1"></a>      </span>
<span id="cb145-26"><a href="miscellaneous.html#cb145-26" tabindex="-1"></a>      <span class="co"># Standard normalization</span></span>
<span id="cb145-27"><a href="miscellaneous.html#cb145-27" tabindex="-1"></a>      norm_values <span class="ot">&lt;-</span> ((data[[i]] <span class="sc">-</span> min_val) <span class="sc">/</span> (max_val <span class="sc">-</span> min_val)) <span class="sc">*</span> </span>
<span id="cb145-28"><a href="miscellaneous.html#cb145-28" tabindex="-1"></a>        (new_max <span class="sc">-</span> new_min) <span class="sc">+</span> new_min</span>
<span id="cb145-29"><a href="miscellaneous.html#cb145-29" tabindex="-1"></a>      </span>
<span id="cb145-30"><a href="miscellaneous.html#cb145-30" tabindex="-1"></a>      <span class="co"># avoid floating-point error</span></span>
<span id="cb145-31"><a href="miscellaneous.html#cb145-31" tabindex="-1"></a>      tol <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(.Machine<span class="sc">$</span>double.eps) <span class="sc">*</span> <span class="fu">abs</span>(new_max <span class="sc">-</span> new_min)</span>
<span id="cb145-32"><a href="miscellaneous.html#cb145-32" tabindex="-1"></a>      <span class="cf">if</span> (new_min <span class="sc">==</span> <span class="dv">0</span>) norm_values[data[[i]] <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># optional: preserve exact zeros</span></span>
<span id="cb145-33"><a href="miscellaneous.html#cb145-33" tabindex="-1"></a>      norm_values[<span class="fu">abs</span>(norm_values <span class="sc">-</span> new_min) <span class="sc">&lt;</span> tol] <span class="ot">&lt;-</span> new_min</span>
<span id="cb145-34"><a href="miscellaneous.html#cb145-34" tabindex="-1"></a>      norm_values[<span class="fu">abs</span>(norm_values <span class="sc">-</span> new_max) <span class="sc">&lt;</span> tol] <span class="ot">&lt;-</span> new_max</span>
<span id="cb145-35"><a href="miscellaneous.html#cb145-35" tabindex="-1"></a>      norm_values <span class="ot">&lt;-</span> <span class="fu">pmax</span>(new_min, <span class="fu">pmin</span>(new_max, norm_values))</span>
<span id="cb145-36"><a href="miscellaneous.html#cb145-36" tabindex="-1"></a>      </span>
<span id="cb145-37"><a href="miscellaneous.html#cb145-37" tabindex="-1"></a>      normalized_data[[i]] <span class="ot">&lt;-</span> norm_values</span>
<span id="cb145-38"><a href="miscellaneous.html#cb145-38" tabindex="-1"></a>    }</span>
<span id="cb145-39"><a href="miscellaneous.html#cb145-39" tabindex="-1"></a>  }</span>
<span id="cb145-40"><a href="miscellaneous.html#cb145-40" tabindex="-1"></a>    </span>
<span id="cb145-41"><a href="miscellaneous.html#cb145-41" tabindex="-1"></a>  <span class="co"># Return the normalized dataframe</span></span>
<span id="cb145-42"><a href="miscellaneous.html#cb145-42" tabindex="-1"></a>  <span class="fu">return</span>(normalized_data)</span>
<span id="cb145-43"><a href="miscellaneous.html#cb145-43" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="getbottleneckcases" class="section level3 hasAnchor" number="7.4.9">
<h3><span class="header-section-number">7.4.9</span> <code>get_bottleneck_cases.R</code><a href="miscellaneous.html#getbottleneckcases" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="miscellaneous.html#cb146-1" tabindex="-1"></a><span class="co"># Helper function to find the number and percentage of bottleneck cases per condition  </span></span>
<span id="cb146-2"><a href="miscellaneous.html#cb146-2" tabindex="-1"></a><span class="co">#revised August 10, 2025</span></span>
<span id="cb146-3"><a href="miscellaneous.html#cb146-3" tabindex="-1"></a></span>
<span id="cb146-4"><a href="miscellaneous.html#cb146-4" tabindex="-1"></a>get_bottleneck_cases <span class="ot">&lt;-</span> <span class="cf">function</span>(data, conditions, outcome, <span class="at">corner =</span> <span class="dv">1</span>, target_outcome, ceiling) {</span>
<span id="cb146-5"><a href="miscellaneous.html#cb146-5" tabindex="-1"></a>  <span class="co"># Check if target_outcome is within the range of the outcome variable</span></span>
<span id="cb146-6"><a href="miscellaneous.html#cb146-6" tabindex="-1"></a>  outcome_min <span class="ot">&lt;-</span> <span class="fu">min</span>(data[[outcome]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb146-7"><a href="miscellaneous.html#cb146-7" tabindex="-1"></a>  outcome_max <span class="ot">&lt;-</span> <span class="fu">max</span>(data[[outcome]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb146-8"><a href="miscellaneous.html#cb146-8" tabindex="-1"></a>  </span>
<span id="cb146-9"><a href="miscellaneous.html#cb146-9" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(corner) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> corner <span class="sc">==</span> <span class="dv">1</span>) {corner <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(conditions))}</span>
<span id="cb146-10"><a href="miscellaneous.html#cb146-10" tabindex="-1"></a></span>
<span id="cb146-11"><a href="miscellaneous.html#cb146-11" tabindex="-1"></a>  <span class="cf">if</span> (target_outcome <span class="sc">&lt;</span> outcome_min <span class="sc">||</span> target_outcome <span class="sc">&gt;</span> outcome_max) {</span>
<span id="cb146-12"><a href="miscellaneous.html#cb146-12" tabindex="-1"></a>    <span class="fu">stop</span>(</span>
<span id="cb146-13"><a href="miscellaneous.html#cb146-13" tabindex="-1"></a>      <span class="fu">sprintf</span>(</span>
<span id="cb146-14"><a href="miscellaneous.html#cb146-14" tabindex="-1"></a>        <span class="st">&quot;Error: target_outcome (%f) is out of range for the outcome variable &#39;%s&#39;. Minimum: %f, Maximum: %f&quot;</span>,</span>
<span id="cb146-15"><a href="miscellaneous.html#cb146-15" tabindex="-1"></a>        target_outcome, outcome, outcome_min, outcome_max</span>
<span id="cb146-16"><a href="miscellaneous.html#cb146-16" tabindex="-1"></a>      )</span>
<span id="cb146-17"><a href="miscellaneous.html#cb146-17" tabindex="-1"></a>    )</span>
<span id="cb146-18"><a href="miscellaneous.html#cb146-18" tabindex="-1"></a>  }</span>
<span id="cb146-19"><a href="miscellaneous.html#cb146-19" tabindex="-1"></a>  </span>
<span id="cb146-20"><a href="miscellaneous.html#cb146-20" tabindex="-1"></a>  <span class="co"># Initialize matrices to store bottlenecks</span></span>
<span id="cb146-21"><a href="miscellaneous.html#cb146-21" tabindex="-1"></a>  bottleneck_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(data), <span class="at">ncol =</span> <span class="fu">length</span>(conditions))</span>
<span id="cb146-22"><a href="miscellaneous.html#cb146-22" tabindex="-1"></a>  <span class="fu">colnames</span>(bottleneck_matrix) <span class="ot">&lt;-</span> conditions</span>
<span id="cb146-23"><a href="miscellaneous.html#cb146-23" tabindex="-1"></a>  </span>
<span id="cb146-24"><a href="miscellaneous.html#cb146-24" tabindex="-1"></a>  threshold <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">numeric</span>(<span class="fu">length</span>(conditions)), conditions)</span>
<span id="cb146-25"><a href="miscellaneous.html#cb146-25" tabindex="-1"></a>  eps <span class="ot">&lt;-</span> .Machine<span class="sc">$</span>double.eps<span class="sc">^</span><span class="fl">0.5</span>  <span class="co"># Smallest safe numerical tolerance</span></span>
<span id="cb146-26"><a href="miscellaneous.html#cb146-26" tabindex="-1"></a>  </span>
<span id="cb146-27"><a href="miscellaneous.html#cb146-27" tabindex="-1"></a>  <span class="cf">for</span> (condition <span class="cf">in</span> conditions) {</span>
<span id="cb146-28"><a href="miscellaneous.html#cb146-28" tabindex="-1"></a>    <span class="co"># Find index of the condition</span></span>
<span id="cb146-29"><a href="miscellaneous.html#cb146-29" tabindex="-1"></a>    condition_index <span class="ot">&lt;-</span> <span class="fu">which</span>(conditions <span class="sc">==</span> condition)[<span class="dv">1</span>]  <span class="co"># Get the index of the current condition</span></span>
<span id="cb146-30"><a href="miscellaneous.html#cb146-30" tabindex="-1"></a>    </span>
<span id="cb146-31"><a href="miscellaneous.html#cb146-31" tabindex="-1"></a>    <span class="co"># Get corner value</span></span>
<span id="cb146-32"><a href="miscellaneous.html#cb146-32" tabindex="-1"></a>    corner_val <span class="ot">&lt;-</span> corner[condition_index]</span>
<span id="cb146-33"><a href="miscellaneous.html#cb146-33" tabindex="-1"></a>    </span>
<span id="cb146-34"><a href="miscellaneous.html#cb146-34" tabindex="-1"></a>    <span class="co"># Check if corner_val is NA or not in valid range (1 to 4)</span></span>
<span id="cb146-35"><a href="miscellaneous.html#cb146-35" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(corner_val)) {</span>
<span id="cb146-36"><a href="miscellaneous.html#cb146-36" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">sprintf</span>(<span class="st">&quot;Warning: corner value for condition &#39;%s&#39; is NA. Defaulting to 1.&quot;</span>, condition))</span>
<span id="cb146-37"><a href="miscellaneous.html#cb146-37" tabindex="-1"></a>      corner_val <span class="ot">&lt;-</span> <span class="dv">1</span><span class="dt">L</span></span>
<span id="cb146-38"><a href="miscellaneous.html#cb146-38" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span>(corner_val <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)) {</span>
<span id="cb146-39"><a href="miscellaneous.html#cb146-39" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">sprintf</span>(<span class="st">&quot;Warning: corner value for condition &#39;%s&#39; (%d) is out of valid range (1-4). Defaulting to 1.&quot;</span>, condition, corner_val))</span>
<span id="cb146-40"><a href="miscellaneous.html#cb146-40" tabindex="-1"></a>      corner_val <span class="ot">&lt;-</span> <span class="dv">1</span><span class="dt">L</span></span>
<span id="cb146-41"><a href="miscellaneous.html#cb146-41" tabindex="-1"></a>    }</span>
<span id="cb146-42"><a href="miscellaneous.html#cb146-42" tabindex="-1"></a>    </span>
<span id="cb146-43"><a href="miscellaneous.html#cb146-43" tabindex="-1"></a>    <span class="co"># Perform NCA for the given condition</span></span>
<span id="cb146-44"><a href="miscellaneous.html#cb146-44" tabindex="-1"></a>    model1 <span class="ot">&lt;-</span> <span class="fu">nca_analysis</span>(</span>
<span id="cb146-45"><a href="miscellaneous.html#cb146-45" tabindex="-1"></a>      data,</span>
<span id="cb146-46"><a href="miscellaneous.html#cb146-46" tabindex="-1"></a>      condition,</span>
<span id="cb146-47"><a href="miscellaneous.html#cb146-47" tabindex="-1"></a>      outcome,</span>
<span id="cb146-48"><a href="miscellaneous.html#cb146-48" tabindex="-1"></a>      <span class="at">corner =</span> corner_val,</span>
<span id="cb146-49"><a href="miscellaneous.html#cb146-49" tabindex="-1"></a>      <span class="at">ceilings =</span> ceiling,</span>
<span id="cb146-50"><a href="miscellaneous.html#cb146-50" tabindex="-1"></a>      <span class="at">bottleneck.y =</span> <span class="st">&quot;actual&quot;</span>,</span>
<span id="cb146-51"><a href="miscellaneous.html#cb146-51" tabindex="-1"></a>      <span class="at">bottleneck.x =</span> <span class="st">&quot;actual&quot;</span>,</span>
<span id="cb146-52"><a href="miscellaneous.html#cb146-52" tabindex="-1"></a>      <span class="at">steps =</span> <span class="fu">c</span>(target_outcome, <span class="cn">NA</span>)</span>
<span id="cb146-53"><a href="miscellaneous.html#cb146-53" tabindex="-1"></a>    )</span>
<span id="cb146-54"><a href="miscellaneous.html#cb146-54" tabindex="-1"></a>    <span class="co"># Extract accurate threshold</span></span>
<span id="cb146-55"><a href="miscellaneous.html#cb146-55" tabindex="-1"></a>      threshold[condition] <span class="ot">&lt;-</span> <span class="fu">attr</span>(model1[[<span class="st">&quot;bottlenecks&quot;</span>]][[ceiling]][[condition]],<span class="st">&quot;mpx.actual&quot;</span>)[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb146-56"><a href="miscellaneous.html#cb146-56" tabindex="-1"></a>      </span>
<span id="cb146-57"><a href="miscellaneous.html#cb146-57" tabindex="-1"></a>      <span class="cf">if</span> (corner_val <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)) {</span>
<span id="cb146-58"><a href="miscellaneous.html#cb146-58" tabindex="-1"></a>        bottleneck_matrix[, condition] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(</span>
<span id="cb146-59"><a href="miscellaneous.html#cb146-59" tabindex="-1"></a>          data[[condition]] <span class="sc">&lt;</span> (threshold[condition] <span class="sc">-</span> eps)</span>
<span id="cb146-60"><a href="miscellaneous.html#cb146-60" tabindex="-1"></a>        )</span>
<span id="cb146-61"><a href="miscellaneous.html#cb146-61" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb146-62"><a href="miscellaneous.html#cb146-62" tabindex="-1"></a>        bottleneck_matrix[, condition] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(</span>
<span id="cb146-63"><a href="miscellaneous.html#cb146-63" tabindex="-1"></a>          data[[condition]] <span class="sc">&gt;</span> (threshold[condition] <span class="sc">-</span> eps)</span>
<span id="cb146-64"><a href="miscellaneous.html#cb146-64" tabindex="-1"></a>        )</span>
<span id="cb146-65"><a href="miscellaneous.html#cb146-65" tabindex="-1"></a>      }</span>
<span id="cb146-66"><a href="miscellaneous.html#cb146-66" tabindex="-1"></a>      </span>
<span id="cb146-67"><a href="miscellaneous.html#cb146-67" tabindex="-1"></a>    <span class="co"># If no cases are bottlenecks, reset to 0</span></span>
<span id="cb146-68"><a href="miscellaneous.html#cb146-68" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">sum</span>(bottleneck_matrix[, condition]) <span class="sc">==</span> <span class="fu">nrow</span>(data)) {</span>
<span id="cb146-69"><a href="miscellaneous.html#cb146-69" tabindex="-1"></a>        bottleneck_matrix[, condition] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb146-70"><a href="miscellaneous.html#cb146-70" tabindex="-1"></a>      }</span>
<span id="cb146-71"><a href="miscellaneous.html#cb146-71" tabindex="-1"></a>      <span class="cf">if</span> (threshold[condition] <span class="sc">==</span> <span class="sc">-</span><span class="cn">Inf</span>) {</span>
<span id="cb146-72"><a href="miscellaneous.html#cb146-72" tabindex="-1"></a>        threshold[condition] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb146-73"><a href="miscellaneous.html#cb146-73" tabindex="-1"></a>      }</span>
<span id="cb146-74"><a href="miscellaneous.html#cb146-74" tabindex="-1"></a>  }</span>
<span id="cb146-75"><a href="miscellaneous.html#cb146-75" tabindex="-1"></a>  </span>
<span id="cb146-76"><a href="miscellaneous.html#cb146-76" tabindex="-1"></a>  <span class="co"># Calculate the total bottlenecks for each column</span></span>
<span id="cb146-77"><a href="miscellaneous.html#cb146-77" tabindex="-1"></a>  bottlenecks_per_condition <span class="ot">&lt;-</span> <span class="fu">colSums</span>(bottleneck_matrix)</span>
<span id="cb146-78"><a href="miscellaneous.html#cb146-78" tabindex="-1"></a>  bottleneck_cases_num <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span> (bottlenecks_per_condition) <span class="co"># number</span></span>
<span id="cb146-79"><a href="miscellaneous.html#cb146-79" tabindex="-1"></a>  <span class="fu">colnames</span>(bottleneck_cases_num)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Bottlenecks (Y = &quot;</span>, target_outcome, <span class="st">&quot;)&quot;</span>)</span>
<span id="cb146-80"><a href="miscellaneous.html#cb146-80" tabindex="-1"></a>  bottleneck_cases_per <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span> (<span class="dv">100</span> <span class="sc">*</span> (bottleneck_cases_num <span class="sc">/</span> <span class="fu">nrow</span>(data))) <span class="co"># percentage</span></span>
<span id="cb146-81"><a href="miscellaneous.html#cb146-81" tabindex="-1"></a>  </span>
<span id="cb146-82"><a href="miscellaneous.html#cb146-82" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb146-83"><a href="miscellaneous.html#cb146-83" tabindex="-1"></a>    <span class="at">bottleneck_cases_per =</span> bottleneck_cases_per,</span>
<span id="cb146-84"><a href="miscellaneous.html#cb146-84" tabindex="-1"></a>    <span class="at">bottleneck_cases_num =</span> bottleneck_cases_num</span>
<span id="cb146-85"><a href="miscellaneous.html#cb146-85" tabindex="-1"></a>  ))</span>
<span id="cb146-86"><a href="miscellaneous.html#cb146-86" tabindex="-1"></a>  </span>
<span id="cb146-87"><a href="miscellaneous.html#cb146-87" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="getipmadf" class="section level3 hasAnchor" number="7.4.10">
<h3><span class="header-section-number">7.4.10</span> <code>get_ipma_df.R</code><a href="miscellaneous.html#getipmadf" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="miscellaneous.html#cb147-1" tabindex="-1"></a><span class="co"># Helper function to create an IPMA dataset with Importance and Performance</span></span>
<span id="cb147-2"><a href="miscellaneous.html#cb147-2" tabindex="-1"></a><span class="co"># Revised Aug 8, 2025 - includes inversion handling for negative importance</span></span>
<span id="cb147-3"><a href="miscellaneous.html#cb147-3" tabindex="-1"></a></span>
<span id="cb147-4"><a href="miscellaneous.html#cb147-4" tabindex="-1"></a>get_ipma_df <span class="ot">&lt;-</span> <span class="cf">function</span>(data, sem, predictors, predicted) {</span>
<span id="cb147-5"><a href="miscellaneous.html#cb147-5" tabindex="-1"></a>  </span>
<span id="cb147-6"><a href="miscellaneous.html#cb147-6" tabindex="-1"></a>  <span class="co"># Importance = total effects</span></span>
<span id="cb147-7"><a href="miscellaneous.html#cb147-7" tabindex="-1"></a>  Importance_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">summary</span>(sem)<span class="sc">$</span>total_effects)</span>
<span id="cb147-8"><a href="miscellaneous.html#cb147-8" tabindex="-1"></a>  Importance <span class="ot">&lt;-</span> Importance_df[predictors, predicted]</span>
<span id="cb147-9"><a href="miscellaneous.html#cb147-9" tabindex="-1"></a>  </span>
<span id="cb147-10"><a href="miscellaneous.html#cb147-10" tabindex="-1"></a>  <span class="co"># Performance = means of all latent variable scores</span></span>
<span id="cb147-11"><a href="miscellaneous.html#cb147-11" tabindex="-1"></a>  Performance_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">sapply</span>(data, mean))</span>
<span id="cb147-12"><a href="miscellaneous.html#cb147-12" tabindex="-1"></a>  Performance <span class="ot">&lt;-</span> Performance_df[predictors, <span class="dv">1</span>]</span>
<span id="cb147-13"><a href="miscellaneous.html#cb147-13" tabindex="-1"></a>  </span>
<span id="cb147-14"><a href="miscellaneous.html#cb147-14" tabindex="-1"></a>  <span class="co"># Invert names and take absolute values where importance is negative</span></span>
<span id="cb147-15"><a href="miscellaneous.html#cb147-15" tabindex="-1"></a>  renamed_predictors <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Importance <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb147-16"><a href="miscellaneous.html#cb147-16" tabindex="-1"></a>                               <span class="fu">paste0</span>(predictors, <span class="st">&quot;-inv&quot;</span>),</span>
<span id="cb147-17"><a href="miscellaneous.html#cb147-17" tabindex="-1"></a>                               predictors)</span>
<span id="cb147-18"><a href="miscellaneous.html#cb147-18" tabindex="-1"></a>  Importance <span class="ot">&lt;-</span> <span class="fu">abs</span>(Importance)</span>
<span id="cb147-19"><a href="miscellaneous.html#cb147-19" tabindex="-1"></a>  </span>
<span id="cb147-20"><a href="miscellaneous.html#cb147-20" tabindex="-1"></a>  <span class="co"># Combine into IPMA dataframe</span></span>
<span id="cb147-21"><a href="miscellaneous.html#cb147-21" tabindex="-1"></a>  ipma_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb147-22"><a href="miscellaneous.html#cb147-22" tabindex="-1"></a>    <span class="at">predictor =</span> renamed_predictors,</span>
<span id="cb147-23"><a href="miscellaneous.html#cb147-23" tabindex="-1"></a>    <span class="at">Importance =</span> Importance,</span>
<span id="cb147-24"><a href="miscellaneous.html#cb147-24" tabindex="-1"></a>    <span class="at">Performance =</span> Performance</span>
<span id="cb147-25"><a href="miscellaneous.html#cb147-25" tabindex="-1"></a>  )</span>
<span id="cb147-26"><a href="miscellaneous.html#cb147-26" tabindex="-1"></a>  </span>
<span id="cb147-27"><a href="miscellaneous.html#cb147-27" tabindex="-1"></a>  <span class="fu">return</span>(ipma_df)</span>
<span id="cb147-28"><a href="miscellaneous.html#cb147-28" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="getipmaplot" class="section level3 hasAnchor" number="7.4.11">
<h3><span class="header-section-number">7.4.11</span> <code>get_ipma_plot.R</code><a href="miscellaneous.html#getipmaplot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="miscellaneous.html#cb148-1" tabindex="-1"></a><span class="co"># Helper function to create a IPMA plot</span></span>
<span id="cb148-2"><a href="miscellaneous.html#cb148-2" tabindex="-1"></a><span class="co"># Revised May 23, 2025</span></span>
<span id="cb148-3"><a href="miscellaneous.html#cb148-3" tabindex="-1"></a></span>
<span id="cb148-4"><a href="miscellaneous.html#cb148-4" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb148-5"><a href="miscellaneous.html#cb148-5" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb148-6"><a href="miscellaneous.html#cb148-6" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb148-7"><a href="miscellaneous.html#cb148-7" tabindex="-1"></a></span>
<span id="cb148-8"><a href="miscellaneous.html#cb148-8" tabindex="-1"></a>get_ipma_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(ipma_df, </span>
<span id="cb148-9"><a href="miscellaneous.html#cb148-9" tabindex="-1"></a>                          <span class="at">x_range =</span> <span class="cn">NULL</span>,</span>
<span id="cb148-10"><a href="miscellaneous.html#cb148-10" tabindex="-1"></a>                          <span class="at">y_range =</span> <span class="cn">NULL</span>) {</span>
<span id="cb148-11"><a href="miscellaneous.html#cb148-11" tabindex="-1"></a>  </span>
<span id="cb148-12"><a href="miscellaneous.html#cb148-12" tabindex="-1"></a>  <span class="co"># Dynamically set x_range if not provided</span></span>
<span id="cb148-13"><a href="miscellaneous.html#cb148-13" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(x_range)) {</span>
<span id="cb148-14"><a href="miscellaneous.html#cb148-14" tabindex="-1"></a>    x_range <span class="ot">&lt;-</span> <span class="fu">range</span>(ipma_df<span class="sc">$</span>Importance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-15"><a href="miscellaneous.html#cb148-15" tabindex="-1"></a>  }  </span>
<span id="cb148-16"><a href="miscellaneous.html#cb148-16" tabindex="-1"></a>  </span>
<span id="cb148-17"><a href="miscellaneous.html#cb148-17" tabindex="-1"></a>  <span class="co"># Dynamically set y_range if not provided</span></span>
<span id="cb148-18"><a href="miscellaneous.html#cb148-18" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(y_range)) {</span>
<span id="cb148-19"><a href="miscellaneous.html#cb148-19" tabindex="-1"></a>    y_range <span class="ot">&lt;-</span> <span class="fu">range</span>(ipma_df<span class="sc">$</span>Performance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-20"><a href="miscellaneous.html#cb148-20" tabindex="-1"></a>  }  </span>
<span id="cb148-21"><a href="miscellaneous.html#cb148-21" tabindex="-1"></a>  </span>
<span id="cb148-22"><a href="miscellaneous.html#cb148-22" tabindex="-1"></a>  <span class="co"># Generate the IPMA plot</span></span>
<span id="cb148-23"><a href="miscellaneous.html#cb148-23" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(ipma_df, <span class="fu">aes</span>(<span class="at">x =</span> Importance, <span class="at">y =</span> Performance)) <span class="sc">+</span></span>
<span id="cb148-24"><a href="miscellaneous.html#cb148-24" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span>  <span class="co"># Single point layer</span></span>
<span id="cb148-25"><a href="miscellaneous.html#cb148-25" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(</span>
<span id="cb148-26"><a href="miscellaneous.html#cb148-26" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">label =</span> predictor),</span>
<span id="cb148-27"><a href="miscellaneous.html#cb148-27" tabindex="-1"></a>      <span class="at">size =</span> <span class="fl">3.5</span>,</span>
<span id="cb148-28"><a href="miscellaneous.html#cb148-28" tabindex="-1"></a>      <span class="at">box.padding =</span> <span class="dv">2</span> </span>
<span id="cb148-29"><a href="miscellaneous.html#cb148-29" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb148-30"><a href="miscellaneous.html#cb148-30" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> x_range, <span class="at">ylim =</span> y_range) <span class="sc">+</span>  </span>
<span id="cb148-31"><a href="miscellaneous.html#cb148-31" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> x_range) <span class="sc">+</span>  <span class="co"># Adapt x-axis limits dynamically</span></span>
<span id="cb148-32"><a href="miscellaneous.html#cb148-32" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> y_range) <span class="sc">+</span>  <span class="co"># Adapt y-axis limits dynamically</span></span>
<span id="cb148-33"><a href="miscellaneous.html#cb148-33" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb148-34"><a href="miscellaneous.html#cb148-34" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">&quot;classic IPMA&quot;</span>,</span>
<span id="cb148-35"><a href="miscellaneous.html#cb148-35" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Importance&quot;</span>,</span>
<span id="cb148-36"><a href="miscellaneous.html#cb148-36" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">&quot;Performance&quot;</span></span>
<span id="cb148-37"><a href="miscellaneous.html#cb148-37" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb148-38"><a href="miscellaneous.html#cb148-38" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()  <span class="co"># Use a clean theme</span></span>
<span id="cb148-39"><a href="miscellaneous.html#cb148-39" tabindex="-1"></a>  </span>
<span id="cb148-40"><a href="miscellaneous.html#cb148-40" tabindex="-1"></a>  <span class="co"># Display the plot</span></span>
<span id="cb148-41"><a href="miscellaneous.html#cb148-41" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb148-42"><a href="miscellaneous.html#cb148-42" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="getcipmadf" class="section level3 hasAnchor" number="7.4.12">
<h3><span class="header-section-number">7.4.12</span> <code>get_cipma_df.R</code><a href="miscellaneous.html#getcipmadf" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="miscellaneous.html#cb149-1" tabindex="-1"></a><span class="co"># Helper function to create a cIPMA dataset with Importance, Performance, </span></span>
<span id="cb149-2"><a href="miscellaneous.html#cb149-2" tabindex="-1"></a><span class="co"># and Bottlenecks (percentage and number of bottleneck cases)</span></span>
<span id="cb149-3"><a href="miscellaneous.html#cb149-3" tabindex="-1"></a><span class="co"># Revised August 9, 2025</span></span>
<span id="cb149-4"><a href="miscellaneous.html#cb149-4" tabindex="-1"></a></span>
<span id="cb149-5"><a href="miscellaneous.html#cb149-5" tabindex="-1"></a>get_cipma_df <span class="ot">&lt;-</span> <span class="cf">function</span>(ipma_df, bottlenecks, necessity) { </span>
<span id="cb149-6"><a href="miscellaneous.html#cb149-6" tabindex="-1"></a>  </span>
<span id="cb149-7"><a href="miscellaneous.html#cb149-7" tabindex="-1"></a>  <span class="co"># Extract number and percentage of single bottleneck cases</span></span>
<span id="cb149-8"><a href="miscellaneous.html#cb149-8" tabindex="-1"></a>  cases_num <span class="ot">&lt;-</span> bottlenecks<span class="sc">$</span>bottleneck_cases_num</span>
<span id="cb149-9"><a href="miscellaneous.html#cb149-9" tabindex="-1"></a>  cases_per <span class="ot">&lt;-</span> bottlenecks<span class="sc">$</span>bottleneck_cases_per</span>
<span id="cb149-10"><a href="miscellaneous.html#cb149-10" tabindex="-1"></a></span>
<span id="cb149-11"><a href="miscellaneous.html#cb149-11" tabindex="-1"></a>  <span class="co"># Combine IPMA data with bottleneck info</span></span>
<span id="cb149-12"><a href="miscellaneous.html#cb149-12" tabindex="-1"></a>  cipma_df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb149-13"><a href="miscellaneous.html#cb149-13" tabindex="-1"></a>    ipma_df,</span>
<span id="cb149-14"><a href="miscellaneous.html#cb149-14" tabindex="-1"></a>    cases_per,</span>
<span id="cb149-15"><a href="miscellaneous.html#cb149-15" tabindex="-1"></a>    cases_num</span>
<span id="cb149-16"><a href="miscellaneous.html#cb149-16" tabindex="-1"></a>  )</span>
<span id="cb149-17"><a href="miscellaneous.html#cb149-17" tabindex="-1"></a>  <span class="fu">rownames</span>(cipma_df) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(ipma_df)</span>
<span id="cb149-18"><a href="miscellaneous.html#cb149-18" tabindex="-1"></a>  <span class="fu">colnames</span>(cipma_df)[<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Bottleneck_cases_per&quot;</span>, <span class="st">&quot;Bottleneck_cases_num&quot;</span>)</span>
<span id="cb149-19"><a href="miscellaneous.html#cb149-19" tabindex="-1"></a>  </span>
<span id="cb149-20"><a href="miscellaneous.html#cb149-20" tabindex="-1"></a>  </span>
<span id="cb149-21"><a href="miscellaneous.html#cb149-21" tabindex="-1"></a>  <span class="co"># Add necessity classification</span></span>
<span id="cb149-22"><a href="miscellaneous.html#cb149-22" tabindex="-1"></a>  cipma_df<span class="sc">$</span>Necessity <span class="ot">&lt;-</span> necessity</span>
<span id="cb149-23"><a href="miscellaneous.html#cb149-23" tabindex="-1"></a>  </span>
<span id="cb149-24"><a href="miscellaneous.html#cb149-24" tabindex="-1"></a>  <span class="co"># Add predictor labels:</span></span>
<span id="cb149-25"><a href="miscellaneous.html#cb149-25" tabindex="-1"></a>  cipma_df<span class="sc">$</span>Predictor_with_cases <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb149-26"><a href="miscellaneous.html#cb149-26" tabindex="-1"></a>    cipma_df<span class="sc">$</span>Necessity <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>,</span>
<span id="cb149-27"><a href="miscellaneous.html#cb149-27" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb149-28"><a href="miscellaneous.html#cb149-28" tabindex="-1"></a>      cipma_df<span class="sc">$</span>predictor, </span>
<span id="cb149-29"><a href="miscellaneous.html#cb149-29" tabindex="-1"></a>      <span class="st">&quot; (&quot;</span>, </span>
<span id="cb149-30"><a href="miscellaneous.html#cb149-30" tabindex="-1"></a>      <span class="fu">round</span>(cipma_df<span class="sc">$</span>Bottleneck_cases_per, <span class="dv">0</span>), <span class="st">&quot;%, n=&quot;</span>,</span>
<span id="cb149-31"><a href="miscellaneous.html#cb149-31" tabindex="-1"></a>      cipma_df<span class="sc">$</span>Bottleneck_cases_num,</span>
<span id="cb149-32"><a href="miscellaneous.html#cb149-32" tabindex="-1"></a>      <span class="st">&quot;)&quot;</span></span>
<span id="cb149-33"><a href="miscellaneous.html#cb149-33" tabindex="-1"></a>    ),</span>
<span id="cb149-34"><a href="miscellaneous.html#cb149-34" tabindex="-1"></a>    <span class="fu">paste0</span>(cipma_df<span class="sc">$</span>predictor, <span class="st">&quot; (NN)&quot;</span>)</span>
<span id="cb149-35"><a href="miscellaneous.html#cb149-35" tabindex="-1"></a>  )</span>
<span id="cb149-36"><a href="miscellaneous.html#cb149-36" tabindex="-1"></a>  </span>
<span id="cb149-37"><a href="miscellaneous.html#cb149-37" tabindex="-1"></a>  <span class="fu">return</span>(cipma_df)</span>
<span id="cb149-38"><a href="miscellaneous.html#cb149-38" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="getcipmaplot" class="section level3 hasAnchor" number="7.4.13">
<h3><span class="header-section-number">7.4.13</span> <code>get_cipma_plot.R</code><a href="miscellaneous.html#getcipmaplot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="miscellaneous.html#cb150-1" tabindex="-1"></a><span class="co"># Helper function for producing the cIPMA plot</span></span>
<span id="cb150-2"><a href="miscellaneous.html#cb150-2" tabindex="-1"></a><span class="co"># Revised August 10, 2025 </span></span>
<span id="cb150-3"><a href="miscellaneous.html#cb150-3" tabindex="-1"></a></span>
<span id="cb150-4"><a href="miscellaneous.html#cb150-4" tabindex="-1"></a>get_cipma_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(cipma_df, <span class="at">x_range =</span> <span class="cn">NULL</span>, <span class="at">y_range =</span> <span class="cn">NULL</span>, size_limits, size_range) {</span>
<span id="cb150-5"><a href="miscellaneous.html#cb150-5" tabindex="-1"></a>  </span>
<span id="cb150-6"><a href="miscellaneous.html#cb150-6" tabindex="-1"></a>  <span class="co"># Load required libraries</span></span>
<span id="cb150-7"><a href="miscellaneous.html#cb150-7" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb150-8"><a href="miscellaneous.html#cb150-8" tabindex="-1"></a>  <span class="fu">library</span>(ggrepel)</span>
<span id="cb150-9"><a href="miscellaneous.html#cb150-9" tabindex="-1"></a>  </span>
<span id="cb150-10"><a href="miscellaneous.html#cb150-10" tabindex="-1"></a>  <span class="co"># Dynamically determine x_range if not provided</span></span>
<span id="cb150-11"><a href="miscellaneous.html#cb150-11" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(x_range)) {</span>
<span id="cb150-12"><a href="miscellaneous.html#cb150-12" tabindex="-1"></a>    x_range <span class="ot">&lt;-</span> <span class="fu">range</span>(bipma_df<span class="sc">$</span>Importance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb150-13"><a href="miscellaneous.html#cb150-13" tabindex="-1"></a>  }</span>
<span id="cb150-14"><a href="miscellaneous.html#cb150-14" tabindex="-1"></a>  </span>
<span id="cb150-15"><a href="miscellaneous.html#cb150-15" tabindex="-1"></a>  <span class="co"># Dynamically determine y_range if not provided</span></span>
<span id="cb150-16"><a href="miscellaneous.html#cb150-16" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(y_range)) {</span>
<span id="cb150-17"><a href="miscellaneous.html#cb150-17" tabindex="-1"></a>    y_range <span class="ot">&lt;-</span> <span class="fu">range</span>(bipma_df<span class="sc">$</span>Performance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb150-18"><a href="miscellaneous.html#cb150-18" tabindex="-1"></a>  }</span>
<span id="cb150-19"><a href="miscellaneous.html#cb150-19" tabindex="-1"></a>  </span>
<span id="cb150-20"><a href="miscellaneous.html#cb150-20" tabindex="-1"></a>  <span class="co"># Extract target Y value from column name</span></span>
<span id="cb150-21"><a href="miscellaneous.html#cb150-21" tabindex="-1"></a>  colname <span class="ot">&lt;-</span> <span class="fu">colnames</span>(cipma_df)[<span class="dv">4</span>]</span>
<span id="cb150-22"><a href="miscellaneous.html#cb150-22" tabindex="-1"></a>  target.Y <span class="ot">&lt;-</span> target_outcome</span>
<span id="cb150-23"><a href="miscellaneous.html#cb150-23" tabindex="-1"></a></span>
<span id="cb150-24"><a href="miscellaneous.html#cb150-24" tabindex="-1"></a>  <span class="co"># Set fill color: black only for NN cases</span></span>
<span id="cb150-25"><a href="miscellaneous.html#cb150-25" tabindex="-1"></a>  cipma_df<span class="sc">$</span>fill_color <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb150-26"><a href="miscellaneous.html#cb150-26" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">(NN</span><span class="sc">\\</span><span class="st">)&quot;</span>, cipma_df<span class="sc">$</span>Predictor_with_cases),</span>
<span id="cb150-27"><a href="miscellaneous.html#cb150-27" tabindex="-1"></a>    <span class="st">&quot;black&quot;</span>,</span>
<span id="cb150-28"><a href="miscellaneous.html#cb150-28" tabindex="-1"></a>    <span class="cn">NA</span></span>
<span id="cb150-29"><a href="miscellaneous.html#cb150-29" tabindex="-1"></a>  )</span>
<span id="cb150-30"><a href="miscellaneous.html#cb150-30" tabindex="-1"></a>  </span>
<span id="cb150-31"><a href="miscellaneous.html#cb150-31" tabindex="-1"></a>  <span class="co"># Set dot size: fixed small size for NN, scaled otherwise</span></span>
<span id="cb150-32"><a href="miscellaneous.html#cb150-32" tabindex="-1"></a>  cipma_df<span class="sc">$</span>dot_size <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb150-33"><a href="miscellaneous.html#cb150-33" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">(NN</span><span class="sc">\\</span><span class="st">)&quot;</span>, cipma_df<span class="sc">$</span>Predictor_with_cases),</span>
<span id="cb150-34"><a href="miscellaneous.html#cb150-34" tabindex="-1"></a>    <span class="dv">1</span>,</span>
<span id="cb150-35"><a href="miscellaneous.html#cb150-35" tabindex="-1"></a>    cipma_df[[colname]]</span>
<span id="cb150-36"><a href="miscellaneous.html#cb150-36" tabindex="-1"></a>  )</span>
<span id="cb150-37"><a href="miscellaneous.html#cb150-37" tabindex="-1"></a>  </span>
<span id="cb150-38"><a href="miscellaneous.html#cb150-38" tabindex="-1"></a>  <span class="co"># Generate the plot</span></span>
<span id="cb150-39"><a href="miscellaneous.html#cb150-39" tabindex="-1"></a>  pc <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(cipma_df, <span class="fu">aes</span>(<span class="at">x =</span> Importance, <span class="at">y =</span> Performance)) <span class="sc">+</span></span>
<span id="cb150-40"><a href="miscellaneous.html#cb150-40" tabindex="-1"></a>    <span class="fu">geom_point</span>(</span>
<span id="cb150-41"><a href="miscellaneous.html#cb150-41" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">size =</span> dot_size),</span>
<span id="cb150-42"><a href="miscellaneous.html#cb150-42" tabindex="-1"></a>      <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb150-43"><a href="miscellaneous.html#cb150-43" tabindex="-1"></a>      <span class="at">fill =</span> cipma_df<span class="sc">$</span>fill_color,</span>
<span id="cb150-44"><a href="miscellaneous.html#cb150-44" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb150-45"><a href="miscellaneous.html#cb150-45" tabindex="-1"></a>      <span class="at">stroke =</span> <span class="fl">0.7</span></span>
<span id="cb150-46"><a href="miscellaneous.html#cb150-46" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb150-47"><a href="miscellaneous.html#cb150-47" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(</span>
<span id="cb150-48"><a href="miscellaneous.html#cb150-48" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">label =</span> Predictor_with_cases),</span>
<span id="cb150-49"><a href="miscellaneous.html#cb150-49" tabindex="-1"></a>      <span class="at">size =</span> <span class="fl">3.5</span>,</span>
<span id="cb150-50"><a href="miscellaneous.html#cb150-50" tabindex="-1"></a>      <span class="at">box.padding =</span> <span class="dv">2</span></span>
<span id="cb150-51"><a href="miscellaneous.html#cb150-51" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb150-52"><a href="miscellaneous.html#cb150-52" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> x_range, <span class="at">ylim =</span> y_range) <span class="sc">+</span></span>
<span id="cb150-53"><a href="miscellaneous.html#cb150-53" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> x_range) <span class="sc">+</span></span>
<span id="cb150-54"><a href="miscellaneous.html#cb150-54" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> y_range) <span class="sc">+</span></span>
<span id="cb150-55"><a href="miscellaneous.html#cb150-55" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">limits =</span> size_limits, <span class="at">range =</span> size_range) <span class="sc">+</span></span>
<span id="cb150-56"><a href="miscellaneous.html#cb150-56" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb150-57"><a href="miscellaneous.html#cb150-57" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;cIPMA for target outcome Y =&quot;</span>, target.Y, <span class="st">&quot; &quot;</span>, name_plot),</span>
<span id="cb150-58"><a href="miscellaneous.html#cb150-58" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Importance&quot;</span>,</span>
<span id="cb150-59"><a href="miscellaneous.html#cb150-59" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">&quot;Performance&quot;</span></span>
<span id="cb150-60"><a href="miscellaneous.html#cb150-60" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb150-61"><a href="miscellaneous.html#cb150-61" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb150-62"><a href="miscellaneous.html#cb150-62" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">size =</span> <span class="st">&quot;none&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;none&quot;</span>)  <span class="co"># REMOVE LEGEND</span></span>
<span id="cb150-63"><a href="miscellaneous.html#cb150-63" tabindex="-1"></a>  </span>
<span id="cb150-64"><a href="miscellaneous.html#cb150-64" tabindex="-1"></a>  <span class="co"># Display the plot</span></span>
<span id="cb150-65"><a href="miscellaneous.html#cb150-65" tabindex="-1"></a>  <span class="fu">print</span>(pc)</span>
<span id="cb150-66"><a href="miscellaneous.html#cb150-66" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="getsinglebottleneckcases" class="section level3 hasAnchor" number="7.4.14">
<h3><span class="header-section-number">7.4.14</span> <code>get_single_bottleneck_cases.R</code><a href="miscellaneous.html#getsinglebottleneckcases" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="miscellaneous.html#cb151-1" tabindex="-1"></a><span class="co"># Helper function to find the number of single bottleneck cases per condition  </span></span>
<span id="cb151-2"><a href="miscellaneous.html#cb151-2" tabindex="-1"></a><span class="co"># Revised August 10, 2025</span></span>
<span id="cb151-3"><a href="miscellaneous.html#cb151-3" tabindex="-1"></a></span>
<span id="cb151-4"><a href="miscellaneous.html#cb151-4" tabindex="-1"></a>get_single_bottleneck_cases <span class="ot">&lt;-</span> <span class="cf">function</span>(data, conditions, outcome, <span class="at">corner =</span> <span class="dv">1</span>, target_outcome, ceiling) {</span>
<span id="cb151-5"><a href="miscellaneous.html#cb151-5" tabindex="-1"></a>  <span class="co"># Check if target_outcome is within the range of the outcome variable</span></span>
<span id="cb151-6"><a href="miscellaneous.html#cb151-6" tabindex="-1"></a>  outcome_min <span class="ot">&lt;-</span> <span class="fu">min</span>(data[[outcome]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb151-7"><a href="miscellaneous.html#cb151-7" tabindex="-1"></a>  outcome_max <span class="ot">&lt;-</span> <span class="fu">max</span>(data[[outcome]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb151-8"><a href="miscellaneous.html#cb151-8" tabindex="-1"></a>  </span>
<span id="cb151-9"><a href="miscellaneous.html#cb151-9" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(corner) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> corner <span class="sc">==</span> <span class="dv">1</span>) {corner <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(conditions))}</span>
<span id="cb151-10"><a href="miscellaneous.html#cb151-10" tabindex="-1"></a>  </span>
<span id="cb151-11"><a href="miscellaneous.html#cb151-11" tabindex="-1"></a>  <span class="cf">if</span> (target_outcome <span class="sc">&lt;</span> outcome_min <span class="sc">||</span> target_outcome <span class="sc">&gt;</span> outcome_max) {</span>
<span id="cb151-12"><a href="miscellaneous.html#cb151-12" tabindex="-1"></a>    <span class="fu">stop</span>(</span>
<span id="cb151-13"><a href="miscellaneous.html#cb151-13" tabindex="-1"></a>      <span class="fu">sprintf</span>(</span>
<span id="cb151-14"><a href="miscellaneous.html#cb151-14" tabindex="-1"></a>        <span class="st">&quot;Error: target_outcome (%f) is out of range for the outcome variable &#39;%s&#39;. Minimum: %f, Maximum: %f&quot;</span>,</span>
<span id="cb151-15"><a href="miscellaneous.html#cb151-15" tabindex="-1"></a>        target_outcome, outcome, outcome_min, outcome_max</span>
<span id="cb151-16"><a href="miscellaneous.html#cb151-16" tabindex="-1"></a>      )</span>
<span id="cb151-17"><a href="miscellaneous.html#cb151-17" tabindex="-1"></a>    )</span>
<span id="cb151-18"><a href="miscellaneous.html#cb151-18" tabindex="-1"></a>  }</span>
<span id="cb151-19"><a href="miscellaneous.html#cb151-19" tabindex="-1"></a>  </span>
<span id="cb151-20"><a href="miscellaneous.html#cb151-20" tabindex="-1"></a>  <span class="co"># Initialize matrices to store bottlenecks</span></span>
<span id="cb151-21"><a href="miscellaneous.html#cb151-21" tabindex="-1"></a>  bottleneck_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(data), <span class="at">ncol =</span> <span class="fu">length</span>(conditions))</span>
<span id="cb151-22"><a href="miscellaneous.html#cb151-22" tabindex="-1"></a>  <span class="fu">colnames</span>(bottleneck_matrix) <span class="ot">&lt;-</span> conditions</span>
<span id="cb151-23"><a href="miscellaneous.html#cb151-23" tabindex="-1"></a>  </span>
<span id="cb151-24"><a href="miscellaneous.html#cb151-24" tabindex="-1"></a>  threshold <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">numeric</span>(<span class="fu">length</span>(conditions)), conditions)</span>
<span id="cb151-25"><a href="miscellaneous.html#cb151-25" tabindex="-1"></a>  eps <span class="ot">&lt;-</span> .Machine<span class="sc">$</span>double.eps<span class="sc">^</span><span class="fl">0.5</span>  <span class="co"># Smallest safe numerical tolerance</span></span>
<span id="cb151-26"><a href="miscellaneous.html#cb151-26" tabindex="-1"></a>  </span>
<span id="cb151-27"><a href="miscellaneous.html#cb151-27" tabindex="-1"></a>  <span class="cf">for</span> (condition <span class="cf">in</span> conditions) {</span>
<span id="cb151-28"><a href="miscellaneous.html#cb151-28" tabindex="-1"></a>    </span>
<span id="cb151-29"><a href="miscellaneous.html#cb151-29" tabindex="-1"></a>    <span class="co"># Find index of the condition</span></span>
<span id="cb151-30"><a href="miscellaneous.html#cb151-30" tabindex="-1"></a>    condition_index <span class="ot">&lt;-</span> <span class="fu">which</span>(conditions <span class="sc">==</span> condition)[<span class="dv">1</span>]  <span class="co"># Get the index of the current condition</span></span>
<span id="cb151-31"><a href="miscellaneous.html#cb151-31" tabindex="-1"></a>    </span>
<span id="cb151-32"><a href="miscellaneous.html#cb151-32" tabindex="-1"></a>    <span class="co"># Get corner value</span></span>
<span id="cb151-33"><a href="miscellaneous.html#cb151-33" tabindex="-1"></a>    corner_val <span class="ot">&lt;-</span> corner[condition_index]</span>
<span id="cb151-34"><a href="miscellaneous.html#cb151-34" tabindex="-1"></a>    </span>
<span id="cb151-35"><a href="miscellaneous.html#cb151-35" tabindex="-1"></a>    <span class="co"># Check if corner_val is NA or not in valid range (1 to 4)</span></span>
<span id="cb151-36"><a href="miscellaneous.html#cb151-36" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(corner_val)) {</span>
<span id="cb151-37"><a href="miscellaneous.html#cb151-37" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">sprintf</span>(<span class="st">&quot;Warning: corner value for condition &#39;%s&#39; is NA. Defaulting to 1.&quot;</span>, condition))</span>
<span id="cb151-38"><a href="miscellaneous.html#cb151-38" tabindex="-1"></a>      corner_val <span class="ot">&lt;-</span> <span class="dv">1</span><span class="dt">L</span></span>
<span id="cb151-39"><a href="miscellaneous.html#cb151-39" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span>(corner_val <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)) {</span>
<span id="cb151-40"><a href="miscellaneous.html#cb151-40" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">sprintf</span>(<span class="st">&quot;Warning: corner value for condition &#39;%s&#39; (%d) is out of valid range (1-4). Defaulting to 1.&quot;</span>, condition, corner_val))</span>
<span id="cb151-41"><a href="miscellaneous.html#cb151-41" tabindex="-1"></a>      corner_val <span class="ot">&lt;-</span> <span class="dv">1</span><span class="dt">L</span></span>
<span id="cb151-42"><a href="miscellaneous.html#cb151-42" tabindex="-1"></a>    }</span>
<span id="cb151-43"><a href="miscellaneous.html#cb151-43" tabindex="-1"></a>    </span>
<span id="cb151-44"><a href="miscellaneous.html#cb151-44" tabindex="-1"></a>    <span class="co"># Perform NCA for the given condition</span></span>
<span id="cb151-45"><a href="miscellaneous.html#cb151-45" tabindex="-1"></a>    model1 <span class="ot">&lt;-</span> <span class="fu">nca_analysis</span>(</span>
<span id="cb151-46"><a href="miscellaneous.html#cb151-46" tabindex="-1"></a>      data, </span>
<span id="cb151-47"><a href="miscellaneous.html#cb151-47" tabindex="-1"></a>      condition, </span>
<span id="cb151-48"><a href="miscellaneous.html#cb151-48" tabindex="-1"></a>      outcome, </span>
<span id="cb151-49"><a href="miscellaneous.html#cb151-49" tabindex="-1"></a>      <span class="at">corner =</span> corner_val,</span>
<span id="cb151-50"><a href="miscellaneous.html#cb151-50" tabindex="-1"></a>      <span class="at">ceilings =</span> ceiling, </span>
<span id="cb151-51"><a href="miscellaneous.html#cb151-51" tabindex="-1"></a>      <span class="at">bottleneck.y =</span> <span class="st">&quot;actual&quot;</span>, </span>
<span id="cb151-52"><a href="miscellaneous.html#cb151-52" tabindex="-1"></a>      <span class="at">bottleneck.x =</span> <span class="st">&quot;actual&quot;</span>, </span>
<span id="cb151-53"><a href="miscellaneous.html#cb151-53" tabindex="-1"></a>      <span class="at">steps =</span> <span class="fu">c</span>(target_outcome, <span class="cn">NA</span>)</span>
<span id="cb151-54"><a href="miscellaneous.html#cb151-54" tabindex="-1"></a>    )</span>
<span id="cb151-55"><a href="miscellaneous.html#cb151-55" tabindex="-1"></a>    <span class="co"># Extract accurate threshold</span></span>
<span id="cb151-56"><a href="miscellaneous.html#cb151-56" tabindex="-1"></a>    threshold[condition] <span class="ot">&lt;-</span> <span class="fu">attr</span>(model1[[<span class="st">&quot;bottlenecks&quot;</span>]][[ceiling]][[condition]],<span class="st">&quot;mpx.actual&quot;</span>)[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb151-57"><a href="miscellaneous.html#cb151-57" tabindex="-1"></a>    </span>
<span id="cb151-58"><a href="miscellaneous.html#cb151-58" tabindex="-1"></a>    <span class="cf">if</span> (corner_val <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)) {</span>
<span id="cb151-59"><a href="miscellaneous.html#cb151-59" tabindex="-1"></a>      bottleneck_matrix[, condition] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(</span>
<span id="cb151-60"><a href="miscellaneous.html#cb151-60" tabindex="-1"></a>        data[[condition]] <span class="sc">&lt;</span> (threshold[condition] <span class="sc">-</span> eps)</span>
<span id="cb151-61"><a href="miscellaneous.html#cb151-61" tabindex="-1"></a>      )</span>
<span id="cb151-62"><a href="miscellaneous.html#cb151-62" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb151-63"><a href="miscellaneous.html#cb151-63" tabindex="-1"></a>      bottleneck_matrix[, condition] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(</span>
<span id="cb151-64"><a href="miscellaneous.html#cb151-64" tabindex="-1"></a>        data[[condition]] <span class="sc">&gt;</span> (threshold[condition] <span class="sc">-</span> eps)</span>
<span id="cb151-65"><a href="miscellaneous.html#cb151-65" tabindex="-1"></a>      )</span>
<span id="cb151-66"><a href="miscellaneous.html#cb151-66" tabindex="-1"></a>    }</span>
<span id="cb151-67"><a href="miscellaneous.html#cb151-67" tabindex="-1"></a>    </span>
<span id="cb151-68"><a href="miscellaneous.html#cb151-68" tabindex="-1"></a>    <span class="co"># If no cases are bottlenecks, reset to 0</span></span>
<span id="cb151-69"><a href="miscellaneous.html#cb151-69" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(bottleneck_matrix[, condition]) <span class="sc">==</span> <span class="fu">nrow</span>(data)) {</span>
<span id="cb151-70"><a href="miscellaneous.html#cb151-70" tabindex="-1"></a>      bottleneck_matrix[, condition] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb151-71"><a href="miscellaneous.html#cb151-71" tabindex="-1"></a>    }</span>
<span id="cb151-72"><a href="miscellaneous.html#cb151-72" tabindex="-1"></a>    <span class="cf">if</span> (threshold[condition] <span class="sc">==</span> <span class="sc">-</span><span class="cn">Inf</span>) {</span>
<span id="cb151-73"><a href="miscellaneous.html#cb151-73" tabindex="-1"></a>      threshold[condition] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb151-74"><a href="miscellaneous.html#cb151-74" tabindex="-1"></a>    }</span>
<span id="cb151-75"><a href="miscellaneous.html#cb151-75" tabindex="-1"></a>  }</span>
<span id="cb151-76"><a href="miscellaneous.html#cb151-76" tabindex="-1"></a>  </span>
<span id="cb151-77"><a href="miscellaneous.html#cb151-77" tabindex="-1"></a>  <span class="co"># Calculate the total bottlenecks for each row</span></span>
<span id="cb151-78"><a href="miscellaneous.html#cb151-78" tabindex="-1"></a>  total_bottlenecks_per_row <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(bottleneck_matrix)</span>
<span id="cb151-79"><a href="miscellaneous.html#cb151-79" tabindex="-1"></a>  </span>
<span id="cb151-80"><a href="miscellaneous.html#cb151-80" tabindex="-1"></a>  <span class="co"># Count the number of rows where each case is the sole bottleneck</span></span>
<span id="cb151-81"><a href="miscellaneous.html#cb151-81" tabindex="-1"></a>  single_bottlenecks_per_condition <span class="ot">&lt;-</span> <span class="fu">colSums</span>(bottleneck_matrix <span class="sc">&amp;</span> (total_bottlenecks_per_row <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb151-82"><a href="miscellaneous.html#cb151-82" tabindex="-1"></a>  </span>
<span id="cb151-83"><a href="miscellaneous.html#cb151-83" tabindex="-1"></a>  single_bottleneck_cases_num <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span> (single_bottlenecks_per_condition) <span class="co"># number</span></span>
<span id="cb151-84"><a href="miscellaneous.html#cb151-84" tabindex="-1"></a>  <span class="fu">colnames</span>(single_bottleneck_cases_num)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Bottlenecks (Y = &quot;</span>, target_outcome, <span class="st">&quot;)&quot;</span>)</span>
<span id="cb151-85"><a href="miscellaneous.html#cb151-85" tabindex="-1"></a>  single_bottleneck_cases_per <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span> (<span class="dv">100</span> <span class="sc">*</span> (single_bottleneck_cases_num <span class="sc">/</span> <span class="fu">nrow</span>(data))) <span class="co"># percentage</span></span>
<span id="cb151-86"><a href="miscellaneous.html#cb151-86" tabindex="-1"></a> </span>
<span id="cb151-87"><a href="miscellaneous.html#cb151-87" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb151-88"><a href="miscellaneous.html#cb151-88" tabindex="-1"></a>    <span class="at">single_bottleneck_cases_per =</span> single_bottleneck_cases_per,</span>
<span id="cb151-89"><a href="miscellaneous.html#cb151-89" tabindex="-1"></a>    <span class="at">single_bottleneck_cases_num =</span> single_bottleneck_cases_num</span>
<span id="cb151-90"><a href="miscellaneous.html#cb151-90" tabindex="-1"></a>  ))</span>
<span id="cb151-91"><a href="miscellaneous.html#cb151-91" tabindex="-1"></a>  </span>
<span id="cb151-92"><a href="miscellaneous.html#cb151-92" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="getbipmadf" class="section level3 hasAnchor" number="7.4.15">
<h3><span class="header-section-number">7.4.15</span> <code>get_bipma_df.R</code><a href="miscellaneous.html#getbipmadf" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="miscellaneous.html#cb152-1" tabindex="-1"></a><span class="co"># Helper function to create a BIPMA dataset with Importance, Performance, </span></span>
<span id="cb152-2"><a href="miscellaneous.html#cb152-2" tabindex="-1"></a><span class="co"># and Bottlenecks (percentage and number of SINGLE bottleneck cases)</span></span>
<span id="cb152-3"><a href="miscellaneous.html#cb152-3" tabindex="-1"></a><span class="co"># Revised November 8, 2025</span></span>
<span id="cb152-4"><a href="miscellaneous.html#cb152-4" tabindex="-1"></a></span>
<span id="cb152-5"><a href="miscellaneous.html#cb152-5" tabindex="-1"></a>get_bipma_df <span class="ot">&lt;-</span> <span class="cf">function</span>(ipma_df, single_bottlenecks, necessity, sufficiency) { </span>
<span id="cb152-6"><a href="miscellaneous.html#cb152-6" tabindex="-1"></a>  </span>
<span id="cb152-7"><a href="miscellaneous.html#cb152-7" tabindex="-1"></a>  <span class="co"># Extract number and percentage of single bottleneck cases</span></span>
<span id="cb152-8"><a href="miscellaneous.html#cb152-8" tabindex="-1"></a>  single_cases_num <span class="ot">&lt;-</span> single_bottlenecks<span class="sc">$</span>single_bottleneck_cases_num</span>
<span id="cb152-9"><a href="miscellaneous.html#cb152-9" tabindex="-1"></a>  single_cases_per <span class="ot">&lt;-</span> single_bottlenecks<span class="sc">$</span>single_bottleneck_cases_per</span>
<span id="cb152-10"><a href="miscellaneous.html#cb152-10" tabindex="-1"></a>  </span>
<span id="cb152-11"><a href="miscellaneous.html#cb152-11" tabindex="-1"></a>  <span class="co"># Combine IPMA data with bottleneck info</span></span>
<span id="cb152-12"><a href="miscellaneous.html#cb152-12" tabindex="-1"></a>    bipma_df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb152-13"><a href="miscellaneous.html#cb152-13" tabindex="-1"></a>    ipma_df,</span>
<span id="cb152-14"><a href="miscellaneous.html#cb152-14" tabindex="-1"></a>    single_cases_per,</span>
<span id="cb152-15"><a href="miscellaneous.html#cb152-15" tabindex="-1"></a>    single_cases_num</span>
<span id="cb152-16"><a href="miscellaneous.html#cb152-16" tabindex="-1"></a>  )</span>
<span id="cb152-17"><a href="miscellaneous.html#cb152-17" tabindex="-1"></a>  </span>
<span id="cb152-18"><a href="miscellaneous.html#cb152-18" tabindex="-1"></a>  <span class="fu">rownames</span>(bipma_df) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(ipma_df)</span>
<span id="cb152-19"><a href="miscellaneous.html#cb152-19" tabindex="-1"></a>  <span class="fu">colnames</span>(bipma_df)[<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Single_bottleneck_cases_per&quot;</span>, <span class="st">&quot;Single_bottleneck_cases_num&quot;</span>)</span>
<span id="cb152-20"><a href="miscellaneous.html#cb152-20" tabindex="-1"></a>  </span>
<span id="cb152-21"><a href="miscellaneous.html#cb152-21" tabindex="-1"></a>  <span class="co"># Add necessity classification</span></span>
<span id="cb152-22"><a href="miscellaneous.html#cb152-22" tabindex="-1"></a>  bipma_df<span class="sc">$</span>Necessity <span class="ot">&lt;-</span> necessity</span>
<span id="cb152-23"><a href="miscellaneous.html#cb152-23" tabindex="-1"></a>  </span>
<span id="cb152-24"><a href="miscellaneous.html#cb152-24" tabindex="-1"></a>  <span class="co"># Add corner classification</span></span>
<span id="cb152-25"><a href="miscellaneous.html#cb152-25" tabindex="-1"></a>  bipma_df<span class="sc">$</span>Corner <span class="ot">&lt;-</span> corner</span>
<span id="cb152-26"><a href="miscellaneous.html#cb152-26" tabindex="-1"></a>  </span>
<span id="cb152-27"><a href="miscellaneous.html#cb152-27" tabindex="-1"></a>  <span class="co"># Add target_outcome</span></span>
<span id="cb152-28"><a href="miscellaneous.html#cb152-28" tabindex="-1"></a>  bipma_df<span class="sc">$</span>Target_outcome <span class="ot">&lt;-</span> target_outcome</span>
<span id="cb152-29"><a href="miscellaneous.html#cb152-29" tabindex="-1"></a>  </span>
<span id="cb152-30"><a href="miscellaneous.html#cb152-30" tabindex="-1"></a>  <span class="co"># Add probabilistic sufficiency classification</span></span>
<span id="cb152-31"><a href="miscellaneous.html#cb152-31" tabindex="-1"></a>  bipma_df<span class="sc">$</span>Sufficiency <span class="ot">&lt;-</span> sufficiency</span>
<span id="cb152-32"><a href="miscellaneous.html#cb152-32" tabindex="-1"></a>  </span>
<span id="cb152-33"><a href="miscellaneous.html#cb152-33" tabindex="-1"></a>  <span class="co"># Add predictor labels:</span></span>
<span id="cb152-34"><a href="miscellaneous.html#cb152-34" tabindex="-1"></a>  bipma_df<span class="sc">$</span>Predictor_with_single_cases <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb152-35"><a href="miscellaneous.html#cb152-35" tabindex="-1"></a>    bipma_df<span class="sc">$</span>Necessity <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>,</span>
<span id="cb152-36"><a href="miscellaneous.html#cb152-36" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb152-37"><a href="miscellaneous.html#cb152-37" tabindex="-1"></a>      bipma_df<span class="sc">$</span>predictor,</span>
<span id="cb152-38"><a href="miscellaneous.html#cb152-38" tabindex="-1"></a>      <span class="st">&quot; (&quot;</span>,</span>
<span id="cb152-39"><a href="miscellaneous.html#cb152-39" tabindex="-1"></a>      <span class="fu">round</span>(bipma_df<span class="sc">$</span>Single_bottleneck_cases_per, <span class="dv">0</span>), <span class="st">&quot;%, n=&quot;</span>,</span>
<span id="cb152-40"><a href="miscellaneous.html#cb152-40" tabindex="-1"></a>      bipma_df<span class="sc">$</span>Single_bottleneck_cases_num,</span>
<span id="cb152-41"><a href="miscellaneous.html#cb152-41" tabindex="-1"></a>      <span class="fu">ifelse</span>(</span>
<span id="cb152-42"><a href="miscellaneous.html#cb152-42" tabindex="-1"></a>        bipma_df<span class="sc">$</span>Corner <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb152-43"><a href="miscellaneous.html#cb152-43" tabindex="-1"></a>        <span class="fu">paste0</span>(<span class="st">&quot;, corner=&quot;</span>, bipma_df<span class="sc">$</span>Corner),</span>
<span id="cb152-44"><a href="miscellaneous.html#cb152-44" tabindex="-1"></a>        <span class="st">&quot;&quot;</span></span>
<span id="cb152-45"><a href="miscellaneous.html#cb152-45" tabindex="-1"></a>      ),</span>
<span id="cb152-46"><a href="miscellaneous.html#cb152-46" tabindex="-1"></a>      <span class="st">&quot;)&quot;</span></span>
<span id="cb152-47"><a href="miscellaneous.html#cb152-47" tabindex="-1"></a>    ),</span>
<span id="cb152-48"><a href="miscellaneous.html#cb152-48" tabindex="-1"></a>    <span class="fu">paste0</span>(bipma_df<span class="sc">$</span>predictor, <span class="st">&quot; (NN)&quot;</span>)</span>
<span id="cb152-49"><a href="miscellaneous.html#cb152-49" tabindex="-1"></a>  )</span>
<span id="cb152-50"><a href="miscellaneous.html#cb152-50" tabindex="-1"></a>  </span>
<span id="cb152-51"><a href="miscellaneous.html#cb152-51" tabindex="-1"></a>  <span class="fu">return</span>(bipma_df)</span>
<span id="cb152-52"><a href="miscellaneous.html#cb152-52" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="getbipmaplot" class="section level3 hasAnchor" number="7.4.16">
<h3><span class="header-section-number">7.4.16</span> <code>get_bipma_plot.R</code><a href="miscellaneous.html#getbipmaplot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="miscellaneous.html#cb153-1" tabindex="-1"></a><span class="co"># Helper function for producing the BIPMA plot</span></span>
<span id="cb153-2"><a href="miscellaneous.html#cb153-2" tabindex="-1"></a><span class="co"># Revised November 8, 2025</span></span>
<span id="cb153-3"><a href="miscellaneous.html#cb153-3" tabindex="-1"></a></span>
<span id="cb153-4"><a href="miscellaneous.html#cb153-4" tabindex="-1"></a>get_bipma_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(bipma_df, <span class="at">x_range =</span> <span class="cn">NULL</span>, <span class="at">y_range =</span> <span class="cn">NULL</span>, size_limits, size_range) {</span>
<span id="cb153-5"><a href="miscellaneous.html#cb153-5" tabindex="-1"></a>  </span>
<span id="cb153-6"><a href="miscellaneous.html#cb153-6" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb153-7"><a href="miscellaneous.html#cb153-7" tabindex="-1"></a>  <span class="fu">library</span>(ggrepel)</span>
<span id="cb153-8"><a href="miscellaneous.html#cb153-8" tabindex="-1"></a>  </span>
<span id="cb153-9"><a href="miscellaneous.html#cb153-9" tabindex="-1"></a>  <span class="co"># For visibility of overlapping filled points</span></span>
<span id="cb153-10"><a href="miscellaneous.html#cb153-10" tabindex="-1"></a>  bipma_df <span class="ot">&lt;-</span> bipma_df[<span class="fu">order</span>(bipma_df<span class="sc">$</span>Single_bottleneck_cases_num, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb153-11"><a href="miscellaneous.html#cb153-11" tabindex="-1"></a>  </span>
<span id="cb153-12"><a href="miscellaneous.html#cb153-12" tabindex="-1"></a>  <span class="co"># Dynamically determine x_range if not provided</span></span>
<span id="cb153-13"><a href="miscellaneous.html#cb153-13" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(x_range)) {</span>
<span id="cb153-14"><a href="miscellaneous.html#cb153-14" tabindex="-1"></a>    x_range <span class="ot">&lt;-</span> <span class="fu">range</span>(bipma_df<span class="sc">$</span>Importance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb153-15"><a href="miscellaneous.html#cb153-15" tabindex="-1"></a>  }</span>
<span id="cb153-16"><a href="miscellaneous.html#cb153-16" tabindex="-1"></a>  </span>
<span id="cb153-17"><a href="miscellaneous.html#cb153-17" tabindex="-1"></a>  <span class="co"># Dynamically determine y_range if not provided</span></span>
<span id="cb153-18"><a href="miscellaneous.html#cb153-18" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(y_range)) {</span>
<span id="cb153-19"><a href="miscellaneous.html#cb153-19" tabindex="-1"></a>    y_range <span class="ot">&lt;-</span> <span class="fu">range</span>(bipma_df<span class="sc">$</span>Performance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb153-20"><a href="miscellaneous.html#cb153-20" tabindex="-1"></a>  }</span>
<span id="cb153-21"><a href="miscellaneous.html#cb153-21" tabindex="-1"></a>  </span>
<span id="cb153-22"><a href="miscellaneous.html#cb153-22" tabindex="-1"></a>  <span class="co"># Extract the bottleneck column name</span></span>
<span id="cb153-23"><a href="miscellaneous.html#cb153-23" tabindex="-1"></a>  colname <span class="ot">&lt;-</span> <span class="fu">colnames</span>(bipma_df)[<span class="dv">4</span>]</span>
<span id="cb153-24"><a href="miscellaneous.html#cb153-24" tabindex="-1"></a>  target.Y <span class="ot">&lt;-</span> target_outcome</span>
<span id="cb153-25"><a href="miscellaneous.html#cb153-25" tabindex="-1"></a>  </span>
<span id="cb153-26"><a href="miscellaneous.html#cb153-26" tabindex="-1"></a>  bipma_df<span class="sc">$</span>fill_color <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb153-27"><a href="miscellaneous.html#cb153-27" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">(NN</span><span class="sc">\\</span><span class="st">)&quot;</span>, bipma_df<span class="sc">$</span>Predictor_with_single_cases),</span>
<span id="cb153-28"><a href="miscellaneous.html#cb153-28" tabindex="-1"></a>    <span class="st">&quot;black&quot;</span>,</span>
<span id="cb153-29"><a href="miscellaneous.html#cb153-29" tabindex="-1"></a>    <span class="cn">NA_character_</span></span>
<span id="cb153-30"><a href="miscellaneous.html#cb153-30" tabindex="-1"></a>  )</span>
<span id="cb153-31"><a href="miscellaneous.html#cb153-31" tabindex="-1"></a>  bipma_df<span class="sc">$</span>fill_color[<span class="fu">is.na</span>(bipma_df<span class="sc">$</span>fill_color) <span class="sc">&amp;</span> bipma_df<span class="sc">$</span>Sufficiency <span class="sc">==</span> <span class="st">&quot;no&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;grey90&quot;</span></span>
<span id="cb153-32"><a href="miscellaneous.html#cb153-32" tabindex="-1"></a>  bipma_df<span class="sc">$</span>fill_color[<span class="fu">is.na</span>(bipma_df<span class="sc">$</span>fill_color)] <span class="ot">&lt;-</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb153-33"><a href="miscellaneous.html#cb153-33" tabindex="-1"></a>  </span>
<span id="cb153-34"><a href="miscellaneous.html#cb153-34" tabindex="-1"></a>  <span class="co"># Define dot size: fixed small size for NN, scaled otherwise</span></span>
<span id="cb153-35"><a href="miscellaneous.html#cb153-35" tabindex="-1"></a>  bipma_df<span class="sc">$</span>dot_size <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb153-36"><a href="miscellaneous.html#cb153-36" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">(NN</span><span class="sc">\\</span><span class="st">)&quot;</span>, bipma_df<span class="sc">$</span>Predictor_with_single_cases),</span>
<span id="cb153-37"><a href="miscellaneous.html#cb153-37" tabindex="-1"></a>    <span class="dv">1</span>,</span>
<span id="cb153-38"><a href="miscellaneous.html#cb153-38" tabindex="-1"></a>    bipma_df[[colname]]</span>
<span id="cb153-39"><a href="miscellaneous.html#cb153-39" tabindex="-1"></a>  )</span>
<span id="cb153-40"><a href="miscellaneous.html#cb153-40" tabindex="-1"></a>  </span>
<span id="cb153-41"><a href="miscellaneous.html#cb153-41" tabindex="-1"></a>  <span class="co"># Adjust importance for plotting</span></span>
<span id="cb153-42"><a href="miscellaneous.html#cb153-42" tabindex="-1"></a>  x_no <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.00</span>  <span class="co"># x-position for &quot;no sufficiency&quot; predictors</span></span>
<span id="cb153-43"><a href="miscellaneous.html#cb153-43" tabindex="-1"></a>  bipma_df<span class="sc">$</span>Importance_adj <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb153-44"><a href="miscellaneous.html#cb153-44" tabindex="-1"></a>    bipma_df<span class="sc">$</span>Sufficiency <span class="sc">==</span> <span class="st">&quot;no&quot;</span>,</span>
<span id="cb153-45"><a href="miscellaneous.html#cb153-45" tabindex="-1"></a>    x_no,</span>
<span id="cb153-46"><a href="miscellaneous.html#cb153-46" tabindex="-1"></a>    bipma_df<span class="sc">$</span>Importance</span>
<span id="cb153-47"><a href="miscellaneous.html#cb153-47" tabindex="-1"></a>  )</span>
<span id="cb153-48"><a href="miscellaneous.html#cb153-48" tabindex="-1"></a>  </span>
<span id="cb153-49"><a href="miscellaneous.html#cb153-49" tabindex="-1"></a>  <span class="co"># Define x-range (include the no sufficiency zone to give space for points)</span></span>
<span id="cb153-50"><a href="miscellaneous.html#cb153-50" tabindex="-1"></a>  x_range_adj <span class="ot">&lt;-</span> <span class="fu">c</span>(x_no <span class="sc">-</span> <span class="fl">0.02</span> , <span class="fu">max</span>(bipma_df<span class="sc">$</span>Importance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fl">0.1</span>)</span>
<span id="cb153-51"><a href="miscellaneous.html#cb153-51" tabindex="-1"></a>  x_breaks <span class="ot">&lt;-</span> <span class="fu">pretty</span>(bipma_df<span class="sc">$</span>Importance)</span>
<span id="cb153-52"><a href="miscellaneous.html#cb153-52" tabindex="-1"></a>  </span>
<span id="cb153-53"><a href="miscellaneous.html#cb153-53" tabindex="-1"></a>  <span class="do">## 1) keep the NN &amp; NS names BEFORE removing them</span></span>
<span id="cb153-54"><a href="miscellaneous.html#cb153-54" tabindex="-1"></a>  dropped_idx <span class="ot">&lt;-</span> (bipma_df<span class="sc">$</span>Necessity <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">&amp;</span> bipma_df<span class="sc">$</span>Sufficiency <span class="sc">==</span> <span class="st">&quot;no&quot;</span>)</span>
<span id="cb153-55"><a href="miscellaneous.html#cb153-55" tabindex="-1"></a>  dropped_names <span class="ot">&lt;-</span> bipma_df<span class="sc">$</span>predictor[dropped_idx]</span>
<span id="cb153-56"><a href="miscellaneous.html#cb153-56" tabindex="-1"></a>  </span>
<span id="cb153-57"><a href="miscellaneous.html#cb153-57" tabindex="-1"></a>  <span class="co"># Remove predictors that are not necessary and not sufficient</span></span>
<span id="cb153-58"><a href="miscellaneous.html#cb153-58" tabindex="-1"></a>  bipma_df <span class="ot">&lt;-</span> bipma_df[<span class="sc">!</span>dropped_idx, ]</span>
<span id="cb153-59"><a href="miscellaneous.html#cb153-59" tabindex="-1"></a>  </span>
<span id="cb153-60"><a href="miscellaneous.html#cb153-60" tabindex="-1"></a>  <span class="co"># Plot</span></span>
<span id="cb153-61"><a href="miscellaneous.html#cb153-61" tabindex="-1"></a>  pc1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bipma_df, <span class="fu">aes</span>(<span class="at">x =</span> Importance_adj, <span class="at">y =</span> Performance)) <span class="sc">+</span></span>
<span id="cb153-62"><a href="miscellaneous.html#cb153-62" tabindex="-1"></a>    </span>
<span id="cb153-63"><a href="miscellaneous.html#cb153-63" tabindex="-1"></a>    <span class="fu">geom_point</span>(</span>
<span id="cb153-64"><a href="miscellaneous.html#cb153-64" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">size =</span> dot_size, <span class="at">fill =</span> fill_color),</span>
<span id="cb153-65"><a href="miscellaneous.html#cb153-65" tabindex="-1"></a>      <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb153-66"><a href="miscellaneous.html#cb153-66" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb153-67"><a href="miscellaneous.html#cb153-67" tabindex="-1"></a>      <span class="at">stroke =</span> <span class="fl">0.7</span></span>
<span id="cb153-68"><a href="miscellaneous.html#cb153-68" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb153-69"><a href="miscellaneous.html#cb153-69" tabindex="-1"></a>    <span class="fu">scale_fill_identity</span>() <span class="sc">+</span></span>
<span id="cb153-70"><a href="miscellaneous.html#cb153-70" tabindex="-1"></a>    </span>
<span id="cb153-71"><a href="miscellaneous.html#cb153-71" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(</span>
<span id="cb153-72"><a href="miscellaneous.html#cb153-72" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">label =</span> Predictor_with_single_cases),</span>
<span id="cb153-73"><a href="miscellaneous.html#cb153-73" tabindex="-1"></a>      <span class="at">size =</span> <span class="fl">3.5</span>,</span>
<span id="cb153-74"><a href="miscellaneous.html#cb153-74" tabindex="-1"></a>      <span class="at">box.padding =</span> <span class="dv">2</span></span>
<span id="cb153-75"><a href="miscellaneous.html#cb153-75" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb153-76"><a href="miscellaneous.html#cb153-76" tabindex="-1"></a>    </span>
<span id="cb153-77"><a href="miscellaneous.html#cb153-77" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> x_range_adj, <span class="at">ylim =</span> y_range) <span class="sc">+</span></span>
<span id="cb153-78"><a href="miscellaneous.html#cb153-78" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(</span>
<span id="cb153-79"><a href="miscellaneous.html#cb153-79" tabindex="-1"></a>      <span class="at">breaks =</span> x_breaks,</span>
<span id="cb153-80"><a href="miscellaneous.html#cb153-80" tabindex="-1"></a>      <span class="at">limits =</span> x_range_adj</span>
<span id="cb153-81"><a href="miscellaneous.html#cb153-81" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb153-82"><a href="miscellaneous.html#cb153-82" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> y_range) <span class="sc">+</span></span>
<span id="cb153-83"><a href="miscellaneous.html#cb153-83" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">limits =</span> size_limits, <span class="at">range =</span> size_range) <span class="sc">+</span></span>
<span id="cb153-84"><a href="miscellaneous.html#cb153-84" tabindex="-1"></a>    </span>
<span id="cb153-85"><a href="miscellaneous.html#cb153-85" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb153-86"><a href="miscellaneous.html#cb153-86" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;BIPMA for target outcome Y =&quot;</span>, target.Y, name_plot),</span>
<span id="cb153-87"><a href="miscellaneous.html#cb153-87" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Importance&quot;</span>,</span>
<span id="cb153-88"><a href="miscellaneous.html#cb153-88" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">&quot;Performance&quot;</span></span>
<span id="cb153-89"><a href="miscellaneous.html#cb153-89" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb153-90"><a href="miscellaneous.html#cb153-90" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb153-91"><a href="miscellaneous.html#cb153-91" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb153-92"><a href="miscellaneous.html#cb153-92" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(),</span>
<span id="cb153-93"><a href="miscellaneous.html#cb153-93" tabindex="-1"></a>      <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(),</span>
<span id="cb153-94"><a href="miscellaneous.html#cb153-94" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb153-95"><a href="miscellaneous.html#cb153-95" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb153-96"><a href="miscellaneous.html#cb153-96" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">size =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb153-97"><a href="miscellaneous.html#cb153-97" tabindex="-1"></a>  </span>
<span id="cb153-98"><a href="miscellaneous.html#cb153-98" tabindex="-1"></a>  <span class="do">## 2) add the textbox in the lower-left corner (only if there were dropped ones)</span></span>
<span id="cb153-99"><a href="miscellaneous.html#cb153-99" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(dropped_names) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb153-100"><a href="miscellaneous.html#cb153-100" tabindex="-1"></a>    pc1 <span class="ot">&lt;-</span> pc1 <span class="sc">+</span></span>
<span id="cb153-101"><a href="miscellaneous.html#cb153-101" tabindex="-1"></a>      <span class="fu">annotate</span>(</span>
<span id="cb153-102"><a href="miscellaneous.html#cb153-102" tabindex="-1"></a>        <span class="st">&quot;label&quot;</span>,</span>
<span id="cb153-103"><a href="miscellaneous.html#cb153-103" tabindex="-1"></a>        <span class="at">x =</span> x_range_adj[<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">0.01</span>,     <span class="co"># a little inside the panel</span></span>
<span id="cb153-104"><a href="miscellaneous.html#cb153-104" tabindex="-1"></a>        <span class="at">y =</span> y_range[<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">0.01</span>,</span>
<span id="cb153-105"><a href="miscellaneous.html#cb153-105" tabindex="-1"></a>        <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb153-106"><a href="miscellaneous.html#cb153-106" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb153-107"><a href="miscellaneous.html#cb153-107" tabindex="-1"></a>        <span class="at">label =</span> <span class="fu">paste</span>(</span>
<span id="cb153-108"><a href="miscellaneous.html#cb153-108" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">&quot;Non-significant necessity and average effects:&quot;</span>, dropped_names),</span>
<span id="cb153-109"><a href="miscellaneous.html#cb153-109" tabindex="-1"></a>          <span class="at">collapse =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb153-110"><a href="miscellaneous.html#cb153-110" tabindex="-1"></a>        ),</span>
<span id="cb153-111"><a href="miscellaneous.html#cb153-111" tabindex="-1"></a>        <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb153-112"><a href="miscellaneous.html#cb153-112" tabindex="-1"></a>      )</span>
<span id="cb153-113"><a href="miscellaneous.html#cb153-113" tabindex="-1"></a>  }</span>
<span id="cb153-114"><a href="miscellaneous.html#cb153-114" tabindex="-1"></a>  <span class="fu">print</span>(pc1)</span>
<span id="cb153-115"><a href="miscellaneous.html#cb153-115" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="ncasem" class="section level3 hasAnchor" number="7.4.17">
<h3><span class="header-section-number">7.4.17</span> <code>ncasem.R</code><a href="miscellaneous.html#ncasem" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="miscellaneous.html#cb154-1" tabindex="-1"></a><span class="co"># Function to conduct NCA-SEM </span></span>
<span id="cb154-2"><a href="miscellaneous.html#cb154-2" tabindex="-1"></a><span class="co"># Revised November 8, 2025</span></span>
<span id="cb154-3"><a href="miscellaneous.html#cb154-3" tabindex="-1"></a></span>
<span id="cb154-4"><a href="miscellaneous.html#cb154-4" tabindex="-1"></a><span class="co">#Helper functions to be sourced (below):</span></span>
<span id="cb154-5"><a href="miscellaneous.html#cb154-5" tabindex="-1"></a><span class="co"># source(&quot;unstandardize.R&quot;)</span></span>
<span id="cb154-6"><a href="miscellaneous.html#cb154-6" tabindex="-1"></a><span class="co"># source(&quot;normalize.R&quot;)</span></span>
<span id="cb154-7"><a href="miscellaneous.html#cb154-7" tabindex="-1"></a><span class="co"># source(&quot;get_outliers.R&quot;)</span></span>
<span id="cb154-8"><a href="miscellaneous.html#cb154-8" tabindex="-1"></a><span class="co"># source(&quot;get_ipma_df.R&quot;)</span></span>
<span id="cb154-9"><a href="miscellaneous.html#cb154-9" tabindex="-1"></a><span class="co"># source(&quot;get_ipma_plot.R&quot;)</span></span>
<span id="cb154-10"><a href="miscellaneous.html#cb154-10" tabindex="-1"></a><span class="co"># source(&quot;get_bottleneck_cases.R&quot;)</span></span>
<span id="cb154-11"><a href="miscellaneous.html#cb154-11" tabindex="-1"></a><span class="co"># source(&quot;get_cipma_df.R&quot;)</span></span>
<span id="cb154-12"><a href="miscellaneous.html#cb154-12" tabindex="-1"></a><span class="co"># source(&quot;get_cipma_plot.R&quot;)</span></span>
<span id="cb154-13"><a href="miscellaneous.html#cb154-13" tabindex="-1"></a><span class="co"># source(&quot;get_single_bottleneck_cases.R&quot;)</span></span>
<span id="cb154-14"><a href="miscellaneous.html#cb154-14" tabindex="-1"></a><span class="co"># source(&quot;get_bipma_df.R&quot;)</span></span>
<span id="cb154-15"><a href="miscellaneous.html#cb154-15" tabindex="-1"></a><span class="co"># source(&quot;get_bipma_plot.R&quot;)</span></span>
<span id="cb154-16"><a href="miscellaneous.html#cb154-16" tabindex="-1"></a></span>
<span id="cb154-17"><a href="miscellaneous.html#cb154-17" tabindex="-1"></a>ncasem <span class="ot">&lt;-</span> <span class="cf">function</span>(sem,</span>
<span id="cb154-18"><a href="miscellaneous.html#cb154-18" tabindex="-1"></a>                   sem_sig,</span>
<span id="cb154-19"><a href="miscellaneous.html#cb154-19" tabindex="-1"></a>                   <span class="at">outliers =</span> <span class="dv">0</span>,</span>
<span id="cb154-20"><a href="miscellaneous.html#cb154-20" tabindex="-1"></a>                   <span class="at">standardize =</span> <span class="dv">0</span>, <span class="co"># unstandardized</span></span>
<span id="cb154-21"><a href="miscellaneous.html#cb154-21" tabindex="-1"></a>                   <span class="at">normalize =</span> <span class="dv">1</span>, <span class="co"># normalized</span></span>
<span id="cb154-22"><a href="miscellaneous.html#cb154-22" tabindex="-1"></a>                   <span class="at">scale =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>), <span class="co"># normalized 0-100 (percentage)</span></span>
<span id="cb154-23"><a href="miscellaneous.html#cb154-23" tabindex="-1"></a>                   predictors,</span>
<span id="cb154-24"><a href="miscellaneous.html#cb154-24" tabindex="-1"></a>                   predicted,</span>
<span id="cb154-25"><a href="miscellaneous.html#cb154-25" tabindex="-1"></a>                   theoretical_min,</span>
<span id="cb154-26"><a href="miscellaneous.html#cb154-26" tabindex="-1"></a>                   theoretical_max,</span>
<span id="cb154-27"><a href="miscellaneous.html#cb154-27" tabindex="-1"></a>                   <span class="at">corner =</span> corner,</span>
<span id="cb154-28"><a href="miscellaneous.html#cb154-28" tabindex="-1"></a>                   <span class="at">ceiling =</span> <span class="st">&quot;ce_fdh&quot;</span>,</span>
<span id="cb154-29"><a href="miscellaneous.html#cb154-29" tabindex="-1"></a>                   <span class="at">test.rep =</span> test.rep,</span>
<span id="cb154-30"><a href="miscellaneous.html#cb154-30" tabindex="-1"></a>                   <span class="at">d_threshold =</span> <span class="fl">0.10</span>,</span>
<span id="cb154-31"><a href="miscellaneous.html#cb154-31" tabindex="-1"></a>                   <span class="at">p_threshold =</span> <span class="fl">0.05</span>, </span>
<span id="cb154-32"><a href="miscellaneous.html#cb154-32" tabindex="-1"></a>                   <span class="at">scope =</span> <span class="cn">NULL</span>, <span class="co"># empirical scope</span></span>
<span id="cb154-33"><a href="miscellaneous.html#cb154-33" tabindex="-1"></a>                   target_outcome,</span>
<span id="cb154-34"><a href="miscellaneous.html#cb154-34" tabindex="-1"></a>                   <span class="at">plots =</span> <span class="cn">FALSE</span>,</span>
<span id="cb154-35"><a href="miscellaneous.html#cb154-35" tabindex="-1"></a>                   <span class="at">name_plot =</span> name_plot) {</span>
<span id="cb154-36"><a href="miscellaneous.html#cb154-36" tabindex="-1"></a></span>
<span id="cb154-37"><a href="miscellaneous.html#cb154-37" tabindex="-1"></a>  </span>
<span id="cb154-38"><a href="miscellaneous.html#cb154-38" tabindex="-1"></a>  <span class="co">#Step 3 select latent variable scores</span></span>
<span id="cb154-39"><a href="miscellaneous.html#cb154-39" tabindex="-1"></a>  data <span class="ot">&lt;-</span> sem<span class="sc">$</span>construct_scores</span>
<span id="cb154-40"><a href="miscellaneous.html#cb154-40" tabindex="-1"></a>  <span class="co"># Standardization step</span></span>
<span id="cb154-41"><a href="miscellaneous.html#cb154-41" tabindex="-1"></a>  <span class="cf">if</span> (standardize <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb154-42"><a href="miscellaneous.html#cb154-42" tabindex="-1"></a>    <span class="fu">source</span>(<span class="st">&quot;unstandardize.R&quot;</span>)</span>
<span id="cb154-43"><a href="miscellaneous.html#cb154-43" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">unstandardize</span>(sem)</span>
<span id="cb154-44"><a href="miscellaneous.html#cb154-44" tabindex="-1"></a>  }</span>
<span id="cb154-45"><a href="miscellaneous.html#cb154-45" tabindex="-1"></a>  </span>
<span id="cb154-46"><a href="miscellaneous.html#cb154-46" tabindex="-1"></a>  <span class="co"># Normalization step</span></span>
<span id="cb154-47"><a href="miscellaneous.html#cb154-47" tabindex="-1"></a>  <span class="cf">if</span> (normalize <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb154-48"><a href="miscellaneous.html#cb154-48" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data  <span class="co"># No normalization</span></span>
<span id="cb154-49"><a href="miscellaneous.html#cb154-49" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb154-50"><a href="miscellaneous.html#cb154-50" tabindex="-1"></a>    <span class="fu">source</span>(<span class="st">&quot;normalize.R&quot;</span>)</span>
<span id="cb154-51"><a href="miscellaneous.html#cb154-51" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">min_max_normalize</span>(data, theoretical_min, theoretical_max, scale)</span>
<span id="cb154-52"><a href="miscellaneous.html#cb154-52" tabindex="-1"></a>  }</span>
<span id="cb154-53"><a href="miscellaneous.html#cb154-53" tabindex="-1"></a>  </span>
<span id="cb154-54"><a href="miscellaneous.html#cb154-54" tabindex="-1"></a>  </span>
<span id="cb154-55"><a href="miscellaneous.html#cb154-55" tabindex="-1"></a>  <span class="co"># Step 4: Conduct NCA</span></span>
<span id="cb154-56"><a href="miscellaneous.html#cb154-56" tabindex="-1"></a>  </span>
<span id="cb154-57"><a href="miscellaneous.html#cb154-57" tabindex="-1"></a>  <span class="fu">library</span>(NCA)</span>
<span id="cb154-58"><a href="miscellaneous.html#cb154-58" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data</span>
<span id="cb154-59"><a href="miscellaneous.html#cb154-59" tabindex="-1"></a>  ceilings <span class="ot">=</span> ceiling</span>
<span id="cb154-60"><a href="miscellaneous.html#cb154-60" tabindex="-1"></a>  corner <span class="ot">=</span> corner</span>
<span id="cb154-61"><a href="miscellaneous.html#cb154-61" tabindex="-1"></a>  test.rep <span class="ot">=</span> test.rep <span class="co">#set the number of permutations for estimating the p value</span></span>
<span id="cb154-62"><a href="miscellaneous.html#cb154-62" tabindex="-1"></a>  <span class="co"># bottleneck.y = &quot;actual&quot;</span></span>
<span id="cb154-63"><a href="miscellaneous.html#cb154-63" tabindex="-1"></a>  <span class="co"># bottleneck.x = &quot;percentile&quot;</span></span>
<span id="cb154-64"><a href="miscellaneous.html#cb154-64" tabindex="-1"></a>  <span class="co"># steps=seq(0, 100, 5)</span></span>
<span id="cb154-65"><a href="miscellaneous.html#cb154-65" tabindex="-1"></a>  scope<span class="ot">=</span>scope </span>
<span id="cb154-66"><a href="miscellaneous.html#cb154-66" tabindex="-1"></a>  </span>
<span id="cb154-67"><a href="miscellaneous.html#cb154-67" tabindex="-1"></a>  <span class="co"># Process outliers if needed</span></span>
<span id="cb154-68"><a href="miscellaneous.html#cb154-68" tabindex="-1"></a>  <span class="cf">if</span> (outliers <span class="sc">!=</span> <span class="dv">0</span>) {</span>
<span id="cb154-69"><a href="miscellaneous.html#cb154-69" tabindex="-1"></a>    <span class="fu">source</span>(<span class="st">&quot;get_outliers.R&quot;</span>)</span>
<span id="cb154-70"><a href="miscellaneous.html#cb154-70" tabindex="-1"></a>    conditions <span class="ot">=</span> predictors</span>
<span id="cb154-71"><a href="miscellaneous.html#cb154-71" tabindex="-1"></a>    outcome <span class="ot">=</span> predicted</span>
<span id="cb154-72"><a href="miscellaneous.html#cb154-72" tabindex="-1"></a>    k <span class="ot">=</span> outliers</span>
<span id="cb154-73"><a href="miscellaneous.html#cb154-73" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">get_outliers</span>(<span class="at">data =</span> data, </span>
<span id="cb154-74"><a href="miscellaneous.html#cb154-74" tabindex="-1"></a>                        <span class="at">conditions =</span> conditions,</span>
<span id="cb154-75"><a href="miscellaneous.html#cb154-75" tabindex="-1"></a>                        <span class="at">outcome =</span> outcome, </span>
<span id="cb154-76"><a href="miscellaneous.html#cb154-76" tabindex="-1"></a>                        <span class="at">ceiling =</span> ceiling,</span>
<span id="cb154-77"><a href="miscellaneous.html#cb154-77" tabindex="-1"></a>                        <span class="at">k =</span> k)</span>
<span id="cb154-78"><a href="miscellaneous.html#cb154-78" tabindex="-1"></a>    all_outliers <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">unlist</span>(out<span class="sc">$</span>outliers_df)[<span class="sc">!</span><span class="fu">is.na</span>(out<span class="sc">$</span>outliers_df)])</span>
<span id="cb154-79"><a href="miscellaneous.html#cb154-79" tabindex="-1"></a>    <span class="co"># Remove outliers</span></span>
<span id="cb154-80"><a href="miscellaneous.html#cb154-80" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data[<span class="sc">-</span>all_outliers, ]</span>
<span id="cb154-81"><a href="miscellaneous.html#cb154-81" tabindex="-1"></a>  }</span>
<span id="cb154-82"><a href="miscellaneous.html#cb154-82" tabindex="-1"></a>  </span>
<span id="cb154-83"><a href="miscellaneous.html#cb154-83" tabindex="-1"></a>  <span class="co"># Run the NCA analysis</span></span>
<span id="cb154-84"><a href="miscellaneous.html#cb154-84" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">nca_analysis</span>(</span>
<span id="cb154-85"><a href="miscellaneous.html#cb154-85" tabindex="-1"></a>    data, </span>
<span id="cb154-86"><a href="miscellaneous.html#cb154-86" tabindex="-1"></a>    predictors, </span>
<span id="cb154-87"><a href="miscellaneous.html#cb154-87" tabindex="-1"></a>    predicted, </span>
<span id="cb154-88"><a href="miscellaneous.html#cb154-88" tabindex="-1"></a>    <span class="at">corner =</span> corner,</span>
<span id="cb154-89"><a href="miscellaneous.html#cb154-89" tabindex="-1"></a>    <span class="at">ceilings =</span> ceiling, </span>
<span id="cb154-90"><a href="miscellaneous.html#cb154-90" tabindex="-1"></a>  <span class="co">#  bottleneck.x = bottleneck.x,</span></span>
<span id="cb154-91"><a href="miscellaneous.html#cb154-91" tabindex="-1"></a>  <span class="co">#  bottleneck.y = bottleneck.y, </span></span>
<span id="cb154-92"><a href="miscellaneous.html#cb154-92" tabindex="-1"></a>  <span class="co">#  steps = steps,</span></span>
<span id="cb154-93"><a href="miscellaneous.html#cb154-93" tabindex="-1"></a>    <span class="at">test.rep =</span> test.rep,</span>
<span id="cb154-94"><a href="miscellaneous.html#cb154-94" tabindex="-1"></a>    <span class="at">scope =</span> scope</span>
<span id="cb154-95"><a href="miscellaneous.html#cb154-95" tabindex="-1"></a>  )</span>
<span id="cb154-96"><a href="miscellaneous.html#cb154-96" tabindex="-1"></a>  </span>
<span id="cb154-97"><a href="miscellaneous.html#cb154-97" tabindex="-1"></a>  <span class="fu">nca_output</span>(model, <span class="at">summaries =</span> <span class="cn">FALSE</span>, <span class="at">pdf =</span> plots)</span>
<span id="cb154-98"><a href="miscellaneous.html#cb154-98" tabindex="-1"></a>  </span>
<span id="cb154-99"><a href="miscellaneous.html#cb154-99" tabindex="-1"></a>  <span class="co"># Step 5: Produce BIPMA</span></span>
<span id="cb154-100"><a href="miscellaneous.html#cb154-100" tabindex="-1"></a>  <span class="co"># IPMA</span></span>
<span id="cb154-101"><a href="miscellaneous.html#cb154-101" tabindex="-1"></a>  <span class="fu">source</span>(<span class="st">&quot;get_ipma_df.R&quot;</span>)</span>
<span id="cb154-102"><a href="miscellaneous.html#cb154-102" tabindex="-1"></a>  IPMA_df <span class="ot">&lt;-</span> <span class="fu">get_ipma_df</span>(<span class="at">data =</span> data, <span class="at">sem =</span> sem, <span class="at">predictors =</span> predictors, <span class="at">predicted =</span> predicted)</span>
<span id="cb154-103"><a href="miscellaneous.html#cb154-103" tabindex="-1"></a>  ipma_df <span class="ot">&lt;-</span> IPMA_df</span>
<span id="cb154-104"><a href="miscellaneous.html#cb154-104" tabindex="-1"></a>  <span class="fu">source</span>(<span class="st">&quot;get_ipma_plot.R&quot;</span>)</span>
<span id="cb154-105"><a href="miscellaneous.html#cb154-105" tabindex="-1"></a>  IPMA_plot <span class="ot">&lt;-</span> <span class="fu">get_ipma_plot</span>(<span class="at">ipma_df =</span> ipma_df, <span class="at">x_range =</span> x_range, <span class="at">y_range =</span> y_range)</span>
<span id="cb154-106"><a href="miscellaneous.html#cb154-106" tabindex="-1"></a>  <span class="cf">if</span> (plots) { </span>
<span id="cb154-107"><a href="miscellaneous.html#cb154-107" tabindex="-1"></a>    current_time <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">&quot;%Y-%m-%d_%H-%M-%S&quot;</span>)</span>
<span id="cb154-108"><a href="miscellaneous.html#cb154-108" tabindex="-1"></a>    filename <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;IPMA plot_&quot;</span>, current_time, <span class="st">&quot;.pdf&quot;</span>)</span>
<span id="cb154-109"><a href="miscellaneous.html#cb154-109" tabindex="-1"></a>    <span class="fu">ggsave</span>(filename, <span class="at">plot =</span> IPMA_plot, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb154-110"><a href="miscellaneous.html#cb154-110" tabindex="-1"></a>  }</span>
<span id="cb154-111"><a href="miscellaneous.html#cb154-111" tabindex="-1"></a>  </span>
<span id="cb154-112"><a href="miscellaneous.html#cb154-112" tabindex="-1"></a>  <span class="co"># CIPMA</span></span>
<span id="cb154-113"><a href="miscellaneous.html#cb154-113" tabindex="-1"></a>  <span class="co"># NCA parameters</span></span>
<span id="cb154-114"><a href="miscellaneous.html#cb154-114" tabindex="-1"></a>  effect_size <span class="ot">&lt;-</span> <span class="fu">sapply</span>(predictors, <span class="cf">function</span>(d) model<span class="sc">$</span>summaries[[d]][[<span class="dv">2</span>]][[<span class="dv">2</span>]])</span>
<span id="cb154-115"><a href="miscellaneous.html#cb154-115" tabindex="-1"></a>  p_value <span class="ot">&lt;-</span> <span class="fu">sapply</span>(predictors, <span class="cf">function</span>(p) model<span class="sc">$</span>summaries[[p]][[<span class="dv">2</span>]][[<span class="dv">6</span>]])</span>
<span id="cb154-116"><a href="miscellaneous.html#cb154-116" tabindex="-1"></a>  <span class="co"># Select predictors that are necessary</span></span>
<span id="cb154-117"><a href="miscellaneous.html#cb154-117" tabindex="-1"></a>  necessity <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(effect_size <span class="sc">&gt;=</span> d_threshold <span class="sc">&amp;</span> p_value <span class="sc">&lt;=</span> p_threshold, <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)</span>
<span id="cb154-118"><a href="miscellaneous.html#cb154-118" tabindex="-1"></a>  </span>
<span id="cb154-119"><a href="miscellaneous.html#cb154-119" tabindex="-1"></a>  <span class="co">#number and percentage of bottleneck cases (more accurate via loop)</span></span>
<span id="cb154-120"><a href="miscellaneous.html#cb154-120" tabindex="-1"></a>  <span class="fu">source</span>(<span class="st">&quot;get_bottleneck_cases.R&quot;</span>) </span>
<span id="cb154-121"><a href="miscellaneous.html#cb154-121" tabindex="-1"></a>  bottlenecks <span class="ot">&lt;-</span> <span class="fu">get_bottleneck_cases</span>(<span class="at">data =</span> data, <span class="at">conditions =</span> predictors, <span class="at">outcome =</span> predicted, <span class="at">corner =</span> corner, <span class="at">target_outcome =</span> target_outcome, <span class="at">ceiling =</span> ceiling) </span>
<span id="cb154-122"><a href="miscellaneous.html#cb154-122" tabindex="-1"></a></span>
<span id="cb154-123"><a href="miscellaneous.html#cb154-123" tabindex="-1"></a>  <span class="fu">source</span>(<span class="st">&quot;get_cipma_df.R&quot;</span>)</span>
<span id="cb154-124"><a href="miscellaneous.html#cb154-124" tabindex="-1"></a>  CIPMA_df <span class="ot">&lt;-</span>  <span class="fu">get_cipma_df</span>(<span class="at">ipma_df =</span> ipma_df, <span class="at">bottlenecks =</span> bottlenecks, <span class="at">necessity =</span> necessity)</span>
<span id="cb154-125"><a href="miscellaneous.html#cb154-125" tabindex="-1"></a></span>
<span id="cb154-126"><a href="miscellaneous.html#cb154-126" tabindex="-1"></a>  <span class="fu">source</span>(<span class="st">&quot;get_cipma_plot.R&quot;</span>)</span>
<span id="cb154-127"><a href="miscellaneous.html#cb154-127" tabindex="-1"></a>  cipma_df <span class="ot">&lt;-</span> CIPMA_df</span>
<span id="cb154-128"><a href="miscellaneous.html#cb154-128" tabindex="-1"></a>  CIPMA_plot <span class="ot">&lt;-</span> <span class="fu">get_cipma_plot</span>(<span class="at">cipma_df =</span> cipma_df, <span class="at">x_range =</span> x_range, <span class="at">y_range =</span> y_range, <span class="at">size_limits =</span> size_limits, <span class="at">size_range =</span> size_range)</span>
<span id="cb154-129"><a href="miscellaneous.html#cb154-129" tabindex="-1"></a>  <span class="cf">if</span> (plots) { </span>
<span id="cb154-130"><a href="miscellaneous.html#cb154-130" tabindex="-1"></a>    current_time <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">&quot;%Y-%m-%d_%H-%M-%S&quot;</span>)</span>
<span id="cb154-131"><a href="miscellaneous.html#cb154-131" tabindex="-1"></a>    filename <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;CIPMA plot_&quot;</span>, current_time, <span class="st">&quot;.pdf&quot;</span>)</span>
<span id="cb154-132"><a href="miscellaneous.html#cb154-132" tabindex="-1"></a>    <span class="fu">ggsave</span>(filename, <span class="at">plot =</span> CIPMA_plot, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb154-133"><a href="miscellaneous.html#cb154-133" tabindex="-1"></a>  }</span>
<span id="cb154-134"><a href="miscellaneous.html#cb154-134" tabindex="-1"></a>  </span>
<span id="cb154-135"><a href="miscellaneous.html#cb154-135" tabindex="-1"></a>  <span class="co"># BIPMA</span></span>
<span id="cb154-136"><a href="miscellaneous.html#cb154-136" tabindex="-1"></a>  for_select_predicted <span class="ot">&lt;-</span> sem_sig[sem_sig<span class="sc">$</span>Predicted <span class="sc">==</span> predicted, ]</span>
<span id="cb154-137"><a href="miscellaneous.html#cb154-137" tabindex="-1"></a>  sufficiency <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(for_select_predicted<span class="sc">$</span>Sig_Total, <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)</span>
<span id="cb154-138"><a href="miscellaneous.html#cb154-138" tabindex="-1"></a>  <span class="fu">names</span>(sufficiency) <span class="ot">&lt;-</span> predictors</span>
<span id="cb154-139"><a href="miscellaneous.html#cb154-139" tabindex="-1"></a></span>
<span id="cb154-140"><a href="miscellaneous.html#cb154-140" tabindex="-1"></a>  <span class="fu">source</span>(<span class="st">&quot;get_single_bottleneck_cases.R&quot;</span>)</span>
<span id="cb154-141"><a href="miscellaneous.html#cb154-141" tabindex="-1"></a>  single_bottlenecks <span class="ot">&lt;-</span> <span class="fu">get_single_bottleneck_cases</span> (data, <span class="at">conditions =</span> predictors, <span class="at">outcome =</span> predicted, <span class="at">corner =</span> corner, <span class="at">target_outcome =</span> target_outcome, <span class="at">ceiling =</span> ceiling)</span>
<span id="cb154-142"><a href="miscellaneous.html#cb154-142" tabindex="-1"></a>  </span>
<span id="cb154-143"><a href="miscellaneous.html#cb154-143" tabindex="-1"></a>  <span class="fu">source</span>(<span class="st">&quot;get_bipma_df.R&quot;</span>)</span>
<span id="cb154-144"><a href="miscellaneous.html#cb154-144" tabindex="-1"></a>  BIPMA_df <span class="ot">&lt;-</span> <span class="fu">get_bipma_df</span>(<span class="at">ipma_df =</span> ipma_df, <span class="at">single_bottlenecks=</span>single_bottlenecks, <span class="at">necessity =</span> necessity, <span class="at">sufficiency =</span> sufficiency)</span>
<span id="cb154-145"><a href="miscellaneous.html#cb154-145" tabindex="-1"></a>  bipma_df <span class="ot">&lt;-</span> BIPMA_df</span>
<span id="cb154-146"><a href="miscellaneous.html#cb154-146" tabindex="-1"></a>  </span>
<span id="cb154-147"><a href="miscellaneous.html#cb154-147" tabindex="-1"></a>  <span class="fu">source</span>(<span class="st">&quot;get_bipma_plot.R&quot;</span>)</span>
<span id="cb154-148"><a href="miscellaneous.html#cb154-148" tabindex="-1"></a>  BIPMA_plot <span class="ot">&lt;-</span> <span class="fu">get_bipma_plot</span>(<span class="at">bipma_df =</span> bipma_df, <span class="at">x_range =</span> x_range, <span class="at">y_range =</span> y_range, <span class="at">size_limits =</span> size_limits, <span class="at">size_range =</span> size_range)</span>
<span id="cb154-149"><a href="miscellaneous.html#cb154-149" tabindex="-1"></a>  <span class="cf">if</span> (plots) { </span>
<span id="cb154-150"><a href="miscellaneous.html#cb154-150" tabindex="-1"></a>    current_time <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">&quot;%Y-%m-%d_%H-%M-%S&quot;</span>)</span>
<span id="cb154-151"><a href="miscellaneous.html#cb154-151" tabindex="-1"></a>    filename <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;BIPMA plot_&quot;</span>, current_time, <span class="st">&quot;.pdf&quot;</span>)</span>
<span id="cb154-152"><a href="miscellaneous.html#cb154-152" tabindex="-1"></a>    <span class="fu">ggsave</span>(filename, <span class="at">plot =</span> BIPMA_plot, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb154-153"><a href="miscellaneous.html#cb154-153" tabindex="-1"></a>  }</span>
<span id="cb154-154"><a href="miscellaneous.html#cb154-154" tabindex="-1"></a>  </span>
<span id="cb154-155"><a href="miscellaneous.html#cb154-155" tabindex="-1"></a>  <span class="co"># Extract results</span></span>
<span id="cb154-156"><a href="miscellaneous.html#cb154-156" tabindex="-1"></a>  effect_size <span class="ot">&lt;-</span> <span class="fu">sapply</span>(predictors, <span class="cf">function</span>(p) model<span class="sc">$</span>summaries[[p]][[<span class="dv">2</span>]][[<span class="dv">2</span>]])</span>
<span id="cb154-157"><a href="miscellaneous.html#cb154-157" tabindex="-1"></a>  p_value <span class="ot">&lt;-</span> <span class="fu">sapply</span>(predictors, <span class="cf">function</span>(p) model<span class="sc">$</span>summaries[[p]][[<span class="dv">2</span>]][[<span class="dv">6</span>]])</span>
<span id="cb154-158"><a href="miscellaneous.html#cb154-158" tabindex="-1"></a>  necessity <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(effect_size <span class="sc">&gt;=</span> d_threshold <span class="sc">&amp;</span> p_value <span class="sc">&lt;=</span> p_threshold, <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)</span>
<span id="cb154-159"><a href="miscellaneous.html#cb154-159" tabindex="-1"></a>  results_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb154-160"><a href="miscellaneous.html#cb154-160" tabindex="-1"></a>    <span class="at">predictor =</span> predictors,</span>
<span id="cb154-161"><a href="miscellaneous.html#cb154-161" tabindex="-1"></a>    <span class="at">effect_size =</span> effect_size,</span>
<span id="cb154-162"><a href="miscellaneous.html#cb154-162" tabindex="-1"></a>    <span class="at">p_value =</span> p_value,</span>
<span id="cb154-163"><a href="miscellaneous.html#cb154-163" tabindex="-1"></a>    <span class="at">necessity =</span> necessity,</span>
<span id="cb154-164"><a href="miscellaneous.html#cb154-164" tabindex="-1"></a>    bottleneck_per <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(single_bottlenecks<span class="sc">$</span>single_bottleneck_cases_per[[<span class="dv">1</span>]]),</span>
<span id="cb154-165"><a href="miscellaneous.html#cb154-165" tabindex="-1"></a>    bottleneck_num <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(single_bottlenecks<span class="sc">$</span>single_bottleneck_cases_num[[<span class="dv">1</span>]]),</span>
<span id="cb154-166"><a href="miscellaneous.html#cb154-166" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb154-167"><a href="miscellaneous.html#cb154-167" tabindex="-1"></a>  )</span>
<span id="cb154-168"><a href="miscellaneous.html#cb154-168" tabindex="-1"></a>  <span class="fu">colnames</span>(results_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Predictor&quot;</span>,</span>
<span id="cb154-169"><a href="miscellaneous.html#cb154-169" tabindex="-1"></a>                            <span class="st">&quot;Effect size&quot;</span>,</span>
<span id="cb154-170"><a href="miscellaneous.html#cb154-170" tabindex="-1"></a>                            <span class="st">&quot;p value&quot;</span>,</span>
<span id="cb154-171"><a href="miscellaneous.html#cb154-171" tabindex="-1"></a>                            <span class="st">&quot;Necessity&quot;</span>,</span>
<span id="cb154-172"><a href="miscellaneous.html#cb154-172" tabindex="-1"></a>                            <span class="st">&quot;Single bottlenecks(%)&quot;</span>,</span>
<span id="cb154-173"><a href="miscellaneous.html#cb154-173" tabindex="-1"></a>                            <span class="st">&quot;Single bottlenecks(#)&quot;</span>)</span>
<span id="cb154-174"><a href="miscellaneous.html#cb154-174" tabindex="-1"></a>  </span>
<span id="cb154-175"><a href="miscellaneous.html#cb154-175" tabindex="-1"></a>  <span class="co"># Compute rank and show it as &quot;rank/total&quot;</span></span>
<span id="cb154-176"><a href="miscellaneous.html#cb154-176" tabindex="-1"></a>  n_pred <span class="ot">&lt;-</span> <span class="fu">nrow</span>(results_df)</span>
<span id="cb154-177"><a href="miscellaneous.html#cb154-177" tabindex="-1"></a>  rank_num <span class="ot">&lt;-</span> <span class="fu">rank</span>(<span class="sc">-</span>results_df[ , <span class="st">&quot;Single bottlenecks(#)&quot;</span>], <span class="at">ties.method =</span> <span class="st">&quot;first&quot;</span>)</span>
<span id="cb154-178"><a href="miscellaneous.html#cb154-178" tabindex="-1"></a>  results_df<span class="sc">$</span>Priority_num <span class="ot">&lt;-</span> rank_num</span>
<span id="cb154-179"><a href="miscellaneous.html#cb154-179" tabindex="-1"></a>  results_df<span class="sc">$</span>Priority <span class="ot">&lt;-</span> <span class="fu">paste0</span>(rank_num, <span class="st">&quot;/&quot;</span>, n_pred)</span>
<span id="cb154-180"><a href="miscellaneous.html#cb154-180" tabindex="-1"></a></span>
<span id="cb154-181"><a href="miscellaneous.html#cb154-181" tabindex="-1"></a>  <span class="co"># Replace columns 5 and 6 with &quot;NN&quot; where Necessity is &quot;no&quot;</span></span>
<span id="cb154-182"><a href="miscellaneous.html#cb154-182" tabindex="-1"></a>  results_df[results_df<span class="sc">$</span>Necessity <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="st">&quot;NN&quot;</span></span>
<span id="cb154-183"><a href="miscellaneous.html#cb154-183" tabindex="-1"></a>  results_df[results_df<span class="sc">$</span>Necessity <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="st">&quot;NN&quot;</span></span>
<span id="cb154-184"><a href="miscellaneous.html#cb154-184" tabindex="-1"></a>  results_df[results_df<span class="sc">$</span>Necessity <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">7</span>] <span class="ot">&lt;-</span> <span class="st">&quot;NN&quot;</span></span>
<span id="cb154-185"><a href="miscellaneous.html#cb154-185" tabindex="-1"></a>  </span>
<span id="cb154-186"><a href="miscellaneous.html#cb154-186" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">data =</span> data, <span class="at">results =</span>results_df)</span>
<span id="cb154-187"><a href="miscellaneous.html#cb154-187" tabindex="-1"></a></span>
<span id="cb154-188"><a href="miscellaneous.html#cb154-188" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb154-189"><a href="miscellaneous.html#cb154-189" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="ncasemexample" class="section level3 hasAnchor" number="7.4.18">
<h3><span class="header-section-number">7.4.18</span> <code>ncasem_example_TAM.R</code><a href="miscellaneous.html#ncasemexample" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="miscellaneous.html#cb155-1" tabindex="-1"></a><span class="co"># Script to conduct NCA-SEM for TAM example</span></span>
<span id="cb155-2"><a href="miscellaneous.html#cb155-2" tabindex="-1"></a><span class="co"># Revised August 10, 2025</span></span>
<span id="cb155-3"><a href="miscellaneous.html#cb155-3" tabindex="-1"></a></span>
<span id="cb155-4"><a href="miscellaneous.html#cb155-4" tabindex="-1"></a><span class="co"># To be sourced:</span></span>
<span id="cb155-5"><a href="miscellaneous.html#cb155-5" tabindex="-1"></a><span class="co"># source(&quot;ncasem.R&quot;)</span></span>
<span id="cb155-6"><a href="miscellaneous.html#cb155-6" tabindex="-1"></a><span class="co"># source(&quot;get_indicator_data_TAM.R&quot;)</span></span>
<span id="cb155-7"><a href="miscellaneous.html#cb155-7" tabindex="-1"></a><span class="co"># source(&quot;estimate_sem_model_TAM.R&quot;)</span></span>
<span id="cb155-8"><a href="miscellaneous.html#cb155-8" tabindex="-1"></a><span class="co"># source (&quot;get_significance_sem.R&quot;)</span></span>
<span id="cb155-9"><a href="miscellaneous.html#cb155-9" tabindex="-1"></a></span>
<span id="cb155-10"><a href="miscellaneous.html#cb155-10" tabindex="-1"></a><span class="co"># Assuming Step 1 (hypotheses) and Step 2 (SEM) have been conducted</span></span>
<span id="cb155-11"><a href="miscellaneous.html#cb155-11" tabindex="-1"></a></span>
<span id="cb155-12"><a href="miscellaneous.html#cb155-12" tabindex="-1"></a><span class="co"># Step 2: Conduct PLS-SEM with SEMinR on TAM data</span></span>
<span id="cb155-13"><a href="miscellaneous.html#cb155-13" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;get_indicator_data_TAM.R&quot;</span>)</span>
<span id="cb155-14"><a href="miscellaneous.html#cb155-14" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;estimate_sem_model_TAM.R&quot;</span>)</span>
<span id="cb155-15"><a href="miscellaneous.html#cb155-15" tabindex="-1"></a><span class="fu">source</span> (<span class="st">&quot;get_significance_sem.R&quot;</span>)</span>
<span id="cb155-16"><a href="miscellaneous.html#cb155-16" tabindex="-1"></a></span>
<span id="cb155-17"><a href="miscellaneous.html#cb155-17" tabindex="-1"></a><span class="co"># Get indicator data</span></span>
<span id="cb155-18"><a href="miscellaneous.html#cb155-18" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">get_indicator_data_TAM</span>()</span>
<span id="cb155-19"><a href="miscellaneous.html#cb155-19" tabindex="-1"></a></span>
<span id="cb155-20"><a href="miscellaneous.html#cb155-20" tabindex="-1"></a><span class="co"># Estimates SEM model</span></span>
<span id="cb155-21"><a href="miscellaneous.html#cb155-21" tabindex="-1"></a>TAM_sem <span class="ot">&lt;-</span> <span class="fu">estimate_sem_model_TAM</span>(data)</span>
<span id="cb155-22"><a href="miscellaneous.html#cb155-22" tabindex="-1"></a></span>
<span id="cb155-23"><a href="miscellaneous.html#cb155-23" tabindex="-1"></a><span class="co"># Get significance of paths</span></span>
<span id="cb155-24"><a href="miscellaneous.html#cb155-24" tabindex="-1"></a>TAM_sig <span class="ot">&lt;-</span> <span class="fu">get_significance_sem</span>(<span class="at">sem =</span> TAM_sem, <span class="at">nboot =</span> <span class="dv">500</span>) <span class="co">#5000 for final analysis</span></span>
<span id="cb155-25"><a href="miscellaneous.html#cb155-25" tabindex="-1"></a><span class="fu">print</span>(TAM_sig)</span>
<span id="cb155-26"><a href="miscellaneous.html#cb155-26" tabindex="-1"></a></span>
<span id="cb155-27"><a href="miscellaneous.html#cb155-27" tabindex="-1"></a><span class="co"># Step 3-5 using ncasem function</span></span>
<span id="cb155-28"><a href="miscellaneous.html#cb155-28" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;ncasem.R&quot;</span>)</span>
<span id="cb155-29"><a href="miscellaneous.html#cb155-29" tabindex="-1"></a></span>
<span id="cb155-30"><a href="miscellaneous.html#cb155-30" tabindex="-1"></a><span class="co"># Settings</span></span>
<span id="cb155-31"><a href="miscellaneous.html#cb155-31" tabindex="-1"></a>standardize <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># use unstandardized data</span></span>
<span id="cb155-32"><a href="miscellaneous.html#cb155-32" tabindex="-1"></a>normalize <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># use normalized data</span></span>
<span id="cb155-33"><a href="miscellaneous.html#cb155-33" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Perceived usefulness&quot;</span>, <span class="st">&quot;Compatibility&quot;</span>, <span class="st">&quot;Perceived ease of use&quot;</span>, <span class="st">&quot;Emotional value&quot;</span>, <span class="st">&quot;Adoption intention&quot;</span>)</span>
<span id="cb155-34"><a href="miscellaneous.html#cb155-34" tabindex="-1"></a>predicted <span class="ot">&lt;-</span> <span class="st">&quot;Technology use&quot;</span></span>
<span id="cb155-35"><a href="miscellaneous.html#cb155-35" tabindex="-1"></a><span class="co"># predictors &lt;- c(&quot;Perceived usefulness&quot;, &quot;Compatibility&quot;, &quot;Perceived ease of use&quot;, &quot;Emotional value&quot;)</span></span>
<span id="cb155-36"><a href="miscellaneous.html#cb155-36" tabindex="-1"></a><span class="co"># predicted &lt;- &quot;Adoption intention&quot;</span></span>
<span id="cb155-37"><a href="miscellaneous.html#cb155-37" tabindex="-1"></a>theoretical_min <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)   <span class="co"># Min values original scale</span></span>
<span id="cb155-38"><a href="miscellaneous.html#cb155-38" tabindex="-1"></a>theoretical_max <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">7</span>)   <span class="co"># Max values original scale</span></span>
<span id="cb155-39"><a href="miscellaneous.html#cb155-39" tabindex="-1"></a></span>
<span id="cb155-40"><a href="miscellaneous.html#cb155-40" tabindex="-1"></a><span class="co"># NCA</span></span>
<span id="cb155-41"><a href="miscellaneous.html#cb155-41" tabindex="-1"></a>ceiling <span class="ot">=</span> <span class="st">&quot;ce_fdh&quot;</span> <span class="co"># step functions; discrete data (Likert scales)</span></span>
<span id="cb155-42"><a href="miscellaneous.html#cb155-42" tabindex="-1"></a>corner <span class="ot">=</span> <span class="dv">1</span> <span class="co"># for all conditions</span></span>
<span id="cb155-43"><a href="miscellaneous.html#cb155-43" tabindex="-1"></a>test.rep <span class="ot">=</span> <span class="dv">100</span> <span class="co"># set 10000 for final analysis</span></span>
<span id="cb155-44"><a href="miscellaneous.html#cb155-44" tabindex="-1"></a>target_outcome <span class="ot">&lt;-</span> <span class="dv">85</span> <span class="co"># (example)</span></span>
<span id="cb155-45"><a href="miscellaneous.html#cb155-45" tabindex="-1"></a>d_threshold <span class="ot">&lt;-</span> <span class="fl">0.10</span> <span class="co"># common threshold</span></span>
<span id="cb155-46"><a href="miscellaneous.html#cb155-46" tabindex="-1"></a>p_threshold <span class="ot">&lt;-</span> <span class="fl">0.05</span> <span class="co"># common threshold</span></span>
<span id="cb155-47"><a href="miscellaneous.html#cb155-47" tabindex="-1"></a>outliers <span class="ot">=</span> <span class="dv">0</span> <span class="co"># include all data</span></span>
<span id="cb155-48"><a href="miscellaneous.html#cb155-48" tabindex="-1"></a>scope <span class="ot">=</span> <span class="cn">NULL</span> <span class="co"># use empirial scope</span></span>
<span id="cb155-49"><a href="miscellaneous.html#cb155-49" tabindex="-1"></a></span>
<span id="cb155-50"><a href="miscellaneous.html#cb155-50" tabindex="-1"></a><span class="co"># (x)IPMA plots</span></span>
<span id="cb155-51"><a href="miscellaneous.html#cb155-51" tabindex="-1"></a>plots <span class="ot">=</span> <span class="cn">FALSE</span> <span class="co"># FALSE = do not save the plots (only display)</span></span>
<span id="cb155-52"><a href="miscellaneous.html#cb155-52" tabindex="-1"></a>scale <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)  <span class="co"># Define new scale (normalized scales in percentages)</span></span>
<span id="cb155-53"><a href="miscellaneous.html#cb155-53" tabindex="-1"></a>x_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.6</span>) <span class="co"># range of values of the Importance x-axis of the (x)IPMA plot</span></span>
<span id="cb155-54"><a href="miscellaneous.html#cb155-54" tabindex="-1"></a>y_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>) <span class="co"># range of values of the Performance y-axis of the (x)IPMA plot</span></span>
<span id="cb155-55"><a href="miscellaneous.html#cb155-55" tabindex="-1"></a>size_limits <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>) </span>
<span id="cb155-56"><a href="miscellaneous.html#cb155-56" tabindex="-1"></a>size_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="dv">50</span>) <span class="co"># the size of the bubble of the (x)IPMA plot</span></span>
<span id="cb155-57"><a href="miscellaneous.html#cb155-57" tabindex="-1"></a>name_plot <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span> <span class="co"># name of the CIPMA and BIPMA plots</span></span>
<span id="cb155-58"><a href="miscellaneous.html#cb155-58" tabindex="-1"></a></span>
<span id="cb155-59"><a href="miscellaneous.html#cb155-59" tabindex="-1"></a><span class="co"># Original analysis</span></span>
<span id="cb155-60"><a href="miscellaneous.html#cb155-60" tabindex="-1"></a>sem <span class="ot">=</span> TAM_sem</span>
<span id="cb155-61"><a href="miscellaneous.html#cb155-61" tabindex="-1"></a>sem_sig <span class="ot">=</span> TAM_sig</span>
<span id="cb155-62"><a href="miscellaneous.html#cb155-62" tabindex="-1"></a>name_plot <span class="ot">&lt;-</span> <span class="st">&quot;Original&quot;</span></span>
<span id="cb155-63"><a href="miscellaneous.html#cb155-63" tabindex="-1"></a>original <span class="ot">&lt;-</span> <span class="fu">ncasem</span>(<span class="at">sem =</span> sem, <span class="at">sem_sig =</span> sem_sig, <span class="at">outliers =</span> outliers, <span class="at">standardize =</span> standardize,</span>
<span id="cb155-64"><a href="miscellaneous.html#cb155-64" tabindex="-1"></a>                   <span class="at">normalize =</span> normalize, <span class="at">scale =</span> scale, <span class="at">predictors =</span> predictors,</span>
<span id="cb155-65"><a href="miscellaneous.html#cb155-65" tabindex="-1"></a>                   <span class="at">predicted =</span> predicted, <span class="at">corner =</span> corner, <span class="at">theoretical_min =</span> theoretical_min,</span>
<span id="cb155-66"><a href="miscellaneous.html#cb155-66" tabindex="-1"></a>                   <span class="at">theoretical_max =</span> theoretical_max, <span class="at">ceiling =</span> ceiling, </span>
<span id="cb155-67"><a href="miscellaneous.html#cb155-67" tabindex="-1"></a>                   <span class="at">test.rep =</span> test.rep, <span class="at">d_threshold =</span> d_threshold, </span>
<span id="cb155-68"><a href="miscellaneous.html#cb155-68" tabindex="-1"></a>                   <span class="at">p_threshold =</span> p_threshold, <span class="at">scope =</span> scope, </span>
<span id="cb155-69"><a href="miscellaneous.html#cb155-69" tabindex="-1"></a>                   <span class="at">target_outcome =</span> target_outcome, <span class="at">plots =</span> plots, <span class="at">name_plot =</span> name_plot</span>
<span id="cb155-70"><a href="miscellaneous.html#cb155-70" tabindex="-1"></a>                   )</span>
<span id="cb155-71"><a href="miscellaneous.html#cb155-71" tabindex="-1"></a></span>
<span id="cb155-72"><a href="miscellaneous.html#cb155-72" tabindex="-1"></a><span class="co"># Get the tabular BIPMA results</span></span>
<span id="cb155-73"><a href="miscellaneous.html#cb155-73" tabindex="-1"></a>original<span class="sc">$</span>results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">`</span><span class="at">Robustness check</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Original&quot;</span>, original<span class="sc">$</span>results)</span>
<span id="cb155-74"><a href="miscellaneous.html#cb155-74" tabindex="-1"></a>original<span class="sc">$</span>results</span>
<span id="cb155-75"><a href="miscellaneous.html#cb155-75" tabindex="-1"></a></span>
<span id="cb155-76"><a href="miscellaneous.html#cb155-76" tabindex="-1"></a><span class="co"># Step 6 Robustness checks</span></span>
<span id="cb155-77"><a href="miscellaneous.html#cb155-77" tabindex="-1"></a><span class="do">### Ceiling change</span></span>
<span id="cb155-78"><a href="miscellaneous.html#cb155-78" tabindex="-1"></a>name_plot <span class="ot">&lt;-</span> <span class="st">&quot;Ceiling change&quot;</span></span>
<span id="cb155-79"><a href="miscellaneous.html#cb155-79" tabindex="-1"></a>ceiling <span class="ot">=</span> <span class="st">&quot;cr_fdh&quot;</span></span>
<span id="cb155-80"><a href="miscellaneous.html#cb155-80" tabindex="-1"></a>other_ceiling <span class="ot">&lt;-</span> <span class="fu">ncasem</span>(<span class="at">sem =</span> TAM_sem, <span class="at">sem_sig =</span> TAM_sig, <span class="at">outliers =</span> outliers, <span class="at">standardize =</span> standardize,</span>
<span id="cb155-81"><a href="miscellaneous.html#cb155-81" tabindex="-1"></a>                        <span class="at">normalize =</span> normalize, <span class="at">scale =</span> scale, <span class="at">predictors =</span> predictors,</span>
<span id="cb155-82"><a href="miscellaneous.html#cb155-82" tabindex="-1"></a>                        <span class="at">predicted =</span> predicted, <span class="at">corner =</span> corner, <span class="at">theoretical_min =</span> theoretical_min,</span>
<span id="cb155-83"><a href="miscellaneous.html#cb155-83" tabindex="-1"></a>                        <span class="at">theoretical_max =</span> theoretical_max, <span class="at">ceiling =</span> ceiling, </span>
<span id="cb155-84"><a href="miscellaneous.html#cb155-84" tabindex="-1"></a>                        <span class="at">test.rep =</span> test.rep, <span class="at">d_threshold =</span> d_threshold, </span>
<span id="cb155-85"><a href="miscellaneous.html#cb155-85" tabindex="-1"></a>                        <span class="at">p_threshold =</span> p_threshold, <span class="at">scope =</span> scope, </span>
<span id="cb155-86"><a href="miscellaneous.html#cb155-86" tabindex="-1"></a>                        <span class="at">target_outcome =</span> target_outcome, <span class="at">plots =</span> plots, <span class="at">name_plot =</span> name_plot</span>
<span id="cb155-87"><a href="miscellaneous.html#cb155-87" tabindex="-1"></a>                        )</span>
<span id="cb155-88"><a href="miscellaneous.html#cb155-88" tabindex="-1"></a>other_ceiling<span class="sc">$</span>results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">`</span><span class="at">Robustness check</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Ceiling change&quot;</span>, other_ceiling<span class="sc">$</span>results)</span>
<span id="cb155-89"><a href="miscellaneous.html#cb155-89" tabindex="-1"></a>other_ceiling<span class="sc">$</span>results</span>
<span id="cb155-90"><a href="miscellaneous.html#cb155-90" tabindex="-1"></a></span>
<span id="cb155-91"><a href="miscellaneous.html#cb155-91" tabindex="-1"></a><span class="do">### d threshold change</span></span>
<span id="cb155-92"><a href="miscellaneous.html#cb155-92" tabindex="-1"></a>name_plot <span class="ot">&lt;-</span> <span class="st">&quot;d threshold change&quot;</span></span>
<span id="cb155-93"><a href="miscellaneous.html#cb155-93" tabindex="-1"></a>ceiling <span class="ot">=</span> <span class="st">&quot;ce_fdh&quot;</span></span>
<span id="cb155-94"><a href="miscellaneous.html#cb155-94" tabindex="-1"></a>d_threshold <span class="ot">&lt;-</span> <span class="fl">0.20</span></span>
<span id="cb155-95"><a href="miscellaneous.html#cb155-95" tabindex="-1"></a>other_d <span class="ot">&lt;-</span> <span class="fu">ncasem</span>(<span class="at">sem =</span> TAM_sem, <span class="at">sem_sig =</span> TAM_sig, <span class="at">outliers =</span> outliers, <span class="at">standardize =</span> standardize,</span>
<span id="cb155-96"><a href="miscellaneous.html#cb155-96" tabindex="-1"></a>                  <span class="at">normalize =</span> normalize, <span class="at">scale =</span> scale, <span class="at">predictors =</span> predictors,</span>
<span id="cb155-97"><a href="miscellaneous.html#cb155-97" tabindex="-1"></a>                  <span class="at">predicted =</span> predicted, <span class="at">corner =</span> corner, <span class="at">theoretical_min =</span> theoretical_min,</span>
<span id="cb155-98"><a href="miscellaneous.html#cb155-98" tabindex="-1"></a>                  <span class="at">theoretical_max =</span> theoretical_max, <span class="at">ceiling =</span> ceiling, </span>
<span id="cb155-99"><a href="miscellaneous.html#cb155-99" tabindex="-1"></a>                  <span class="at">test.rep =</span> test.rep, <span class="at">d_threshold =</span> d_threshold, </span>
<span id="cb155-100"><a href="miscellaneous.html#cb155-100" tabindex="-1"></a>                  <span class="at">p_threshold =</span> p_threshold, <span class="at">scope =</span> scope, </span>
<span id="cb155-101"><a href="miscellaneous.html#cb155-101" tabindex="-1"></a>                  <span class="at">target_outcome =</span> target_outcome, <span class="at">plots =</span> plots, <span class="at">name_plot =</span> name_plot</span>
<span id="cb155-102"><a href="miscellaneous.html#cb155-102" tabindex="-1"></a>                  )</span>
<span id="cb155-103"><a href="miscellaneous.html#cb155-103" tabindex="-1"></a>other_d<span class="sc">$</span>results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">`</span><span class="at">Robustness check</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;d threshold change&quot;</span>, other_d<span class="sc">$</span>results)</span>
<span id="cb155-104"><a href="miscellaneous.html#cb155-104" tabindex="-1"></a>other_d<span class="sc">$</span>results</span>
<span id="cb155-105"><a href="miscellaneous.html#cb155-105" tabindex="-1"></a></span>
<span id="cb155-106"><a href="miscellaneous.html#cb155-106" tabindex="-1"></a><span class="do">### p threshold change</span></span>
<span id="cb155-107"><a href="miscellaneous.html#cb155-107" tabindex="-1"></a>name_plot <span class="ot">&lt;-</span> <span class="st">&quot;p threshold change&quot;</span></span>
<span id="cb155-108"><a href="miscellaneous.html#cb155-108" tabindex="-1"></a>d_threshold <span class="ot">&lt;-</span> <span class="fl">0.10</span></span>
<span id="cb155-109"><a href="miscellaneous.html#cb155-109" tabindex="-1"></a>p_threshold <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb155-110"><a href="miscellaneous.html#cb155-110" tabindex="-1"></a>other_p <span class="ot">&lt;-</span> <span class="fu">ncasem</span>(<span class="at">sem =</span> TAM_sem, <span class="at">sem_sig =</span> TAM_sig, <span class="at">outliers =</span> outliers, <span class="at">standardize =</span> standardize,</span>
<span id="cb155-111"><a href="miscellaneous.html#cb155-111" tabindex="-1"></a>                  <span class="at">normalize =</span> normalize, <span class="at">scale =</span> scale, <span class="at">predictors =</span> predictors,</span>
<span id="cb155-112"><a href="miscellaneous.html#cb155-112" tabindex="-1"></a>                  <span class="at">predicted =</span> predicted, <span class="at">corner =</span> corner, <span class="at">theoretical_min =</span> theoretical_min,</span>
<span id="cb155-113"><a href="miscellaneous.html#cb155-113" tabindex="-1"></a>                  <span class="at">theoretical_max =</span> theoretical_max, <span class="at">ceiling =</span> ceiling, </span>
<span id="cb155-114"><a href="miscellaneous.html#cb155-114" tabindex="-1"></a>                  <span class="at">test.rep =</span> test.rep, <span class="at">d_threshold =</span> d_threshold, </span>
<span id="cb155-115"><a href="miscellaneous.html#cb155-115" tabindex="-1"></a>                  <span class="at">p_threshold =</span> p_threshold, <span class="at">scope =</span> scope, </span>
<span id="cb155-116"><a href="miscellaneous.html#cb155-116" tabindex="-1"></a>                  <span class="at">target_outcome =</span> target_outcome, <span class="at">plots =</span> plots, <span class="at">name_plot =</span> name_plot</span>
<span id="cb155-117"><a href="miscellaneous.html#cb155-117" tabindex="-1"></a>                  )</span>
<span id="cb155-118"><a href="miscellaneous.html#cb155-118" tabindex="-1"></a>other_p<span class="sc">$</span>results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">`</span><span class="at">Robustness check</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;p threshold change&quot;</span>, other_p<span class="sc">$</span>results)</span>
<span id="cb155-119"><a href="miscellaneous.html#cb155-119" tabindex="-1"></a>other_p<span class="sc">$</span>results</span>
<span id="cb155-120"><a href="miscellaneous.html#cb155-120" tabindex="-1"></a></span>
<span id="cb155-121"><a href="miscellaneous.html#cb155-121" tabindex="-1"></a><span class="do">### Scope change</span></span>
<span id="cb155-122"><a href="miscellaneous.html#cb155-122" tabindex="-1"></a>name_plot <span class="ot">&lt;-</span> <span class="st">&quot;Scope change&quot;</span></span>
<span id="cb155-123"><a href="miscellaneous.html#cb155-123" tabindex="-1"></a>p_threshold <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb155-124"><a href="miscellaneous.html#cb155-124" tabindex="-1"></a>scope <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="co">#theoretical scope</span></span>
<span id="cb155-125"><a href="miscellaneous.html#cb155-125" tabindex="-1"></a>other_scope <span class="ot">&lt;-</span> <span class="fu">ncasem</span>(<span class="at">sem =</span> TAM_sem, <span class="at">sem_sig =</span> TAM_sig, <span class="at">outliers =</span> outliers, <span class="at">standardize =</span> standardize,</span>
<span id="cb155-126"><a href="miscellaneous.html#cb155-126" tabindex="-1"></a>                      <span class="at">normalize =</span> normalize, <span class="at">scale =</span> scale, <span class="at">predictors =</span> predictors,</span>
<span id="cb155-127"><a href="miscellaneous.html#cb155-127" tabindex="-1"></a>                      <span class="at">predicted =</span> predicted, <span class="at">corner =</span> corner, <span class="at">theoretical_min =</span> theoretical_min,</span>
<span id="cb155-128"><a href="miscellaneous.html#cb155-128" tabindex="-1"></a>                      <span class="at">theoretical_max =</span> theoretical_max, <span class="at">ceiling =</span> ceiling, </span>
<span id="cb155-129"><a href="miscellaneous.html#cb155-129" tabindex="-1"></a>                      <span class="at">test.rep =</span> test.rep, <span class="at">d_threshold =</span> d_threshold, </span>
<span id="cb155-130"><a href="miscellaneous.html#cb155-130" tabindex="-1"></a>                      <span class="at">p_threshold =</span> p_threshold, <span class="at">scope =</span> scope, </span>
<span id="cb155-131"><a href="miscellaneous.html#cb155-131" tabindex="-1"></a>                      <span class="at">target_outcome =</span> target_outcome, <span class="at">plots =</span> plots, <span class="at">name_plot =</span> name_plot</span>
<span id="cb155-132"><a href="miscellaneous.html#cb155-132" tabindex="-1"></a>                      )</span>
<span id="cb155-133"><a href="miscellaneous.html#cb155-133" tabindex="-1"></a>other_scope<span class="sc">$</span>results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">`</span><span class="at">Robustness check</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Scope change&quot;</span>, other_scope<span class="sc">$</span>results)</span>
<span id="cb155-134"><a href="miscellaneous.html#cb155-134" tabindex="-1"></a>other_scope<span class="sc">$</span>results</span>
<span id="cb155-135"><a href="miscellaneous.html#cb155-135" tabindex="-1"></a></span>
<span id="cb155-136"><a href="miscellaneous.html#cb155-136" tabindex="-1"></a><span class="do">### Single outlier removal</span></span>
<span id="cb155-137"><a href="miscellaneous.html#cb155-137" tabindex="-1"></a>name_plot <span class="ot">&lt;-</span> <span class="st">&quot;Single outlier removal&quot;</span></span>
<span id="cb155-138"><a href="miscellaneous.html#cb155-138" tabindex="-1"></a>scope <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb155-139"><a href="miscellaneous.html#cb155-139" tabindex="-1"></a>outliers <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb155-140"><a href="miscellaneous.html#cb155-140" tabindex="-1"></a>other_outliers_single <span class="ot">&lt;-</span> <span class="fu">ncasem</span>(<span class="at">sem =</span> TAM_sem, <span class="at">sem_sig =</span> TAM_sig, <span class="at">outliers =</span> outliers, <span class="at">standardize =</span> standardize,</span>
<span id="cb155-141"><a href="miscellaneous.html#cb155-141" tabindex="-1"></a>                                <span class="at">normalize =</span> normalize, <span class="at">scale =</span> scale, <span class="at">predictors =</span> predictors,</span>
<span id="cb155-142"><a href="miscellaneous.html#cb155-142" tabindex="-1"></a>                                <span class="at">predicted =</span> predicted, <span class="at">corner =</span> corner, <span class="at">theoretical_min =</span> theoretical_min,</span>
<span id="cb155-143"><a href="miscellaneous.html#cb155-143" tabindex="-1"></a>                                <span class="at">theoretical_max =</span> theoretical_max, <span class="at">ceiling =</span> ceiling, </span>
<span id="cb155-144"><a href="miscellaneous.html#cb155-144" tabindex="-1"></a>                                <span class="at">test.rep =</span> test.rep, <span class="at">d_threshold =</span> d_threshold, </span>
<span id="cb155-145"><a href="miscellaneous.html#cb155-145" tabindex="-1"></a>                                <span class="at">p_threshold =</span> p_threshold, <span class="at">scope =</span> scope, </span>
<span id="cb155-146"><a href="miscellaneous.html#cb155-146" tabindex="-1"></a>                                <span class="at">target_outcome =</span> target_outcome, <span class="at">plots =</span> plots, <span class="at">name_plot =</span> name_plot</span>
<span id="cb155-147"><a href="miscellaneous.html#cb155-147" tabindex="-1"></a>                                )</span>
<span id="cb155-148"><a href="miscellaneous.html#cb155-148" tabindex="-1"></a>other_outliers_single<span class="sc">$</span>results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">`</span><span class="at">Robustness check</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Single outlier removal&quot;</span>, other_outliers_single<span class="sc">$</span>results)</span>
<span id="cb155-149"><a href="miscellaneous.html#cb155-149" tabindex="-1"></a>other_outliers_single<span class="sc">$</span>results</span>
<span id="cb155-150"><a href="miscellaneous.html#cb155-150" tabindex="-1"></a></span>
<span id="cb155-151"><a href="miscellaneous.html#cb155-151" tabindex="-1"></a><span class="do">### Multiple outlier removal</span></span>
<span id="cb155-152"><a href="miscellaneous.html#cb155-152" tabindex="-1"></a>name_plot <span class="ot">&lt;-</span> <span class="st">&quot;Multiple outlier removal&quot;</span></span>
<span id="cb155-153"><a href="miscellaneous.html#cb155-153" tabindex="-1"></a>outliers <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb155-154"><a href="miscellaneous.html#cb155-154" tabindex="-1"></a>other_outliers_multiple <span class="ot">&lt;-</span> <span class="fu">ncasem</span>(<span class="at">sem =</span> TAM_sem, <span class="at">sem_sig =</span> TAM_sig, <span class="at">outliers =</span> outliers, <span class="at">standardize =</span> standardize,</span>
<span id="cb155-155"><a href="miscellaneous.html#cb155-155" tabindex="-1"></a>                                  <span class="at">normalize =</span> normalize, <span class="at">scale =</span> scale, <span class="at">predictors =</span> predictors,</span>
<span id="cb155-156"><a href="miscellaneous.html#cb155-156" tabindex="-1"></a>                                  <span class="at">predicted =</span> predicted, <span class="at">corner =</span> corner, <span class="at">theoretical_min =</span> theoretical_min,</span>
<span id="cb155-157"><a href="miscellaneous.html#cb155-157" tabindex="-1"></a>                                  <span class="at">theoretical_max =</span> theoretical_max, <span class="at">ceiling =</span> ceiling, </span>
<span id="cb155-158"><a href="miscellaneous.html#cb155-158" tabindex="-1"></a>                                  <span class="at">test.rep =</span> test.rep, <span class="at">d_threshold =</span> d_threshold, </span>
<span id="cb155-159"><a href="miscellaneous.html#cb155-159" tabindex="-1"></a>                                  <span class="at">p_threshold =</span> p_threshold, <span class="at">scope =</span> scope, </span>
<span id="cb155-160"><a href="miscellaneous.html#cb155-160" tabindex="-1"></a>                                  <span class="at">target_outcome =</span> target_outcome, <span class="at">plots =</span> plots, <span class="at">name_plot =</span> name_plot</span>
<span id="cb155-161"><a href="miscellaneous.html#cb155-161" tabindex="-1"></a>                                  )</span>
<span id="cb155-162"><a href="miscellaneous.html#cb155-162" tabindex="-1"></a>other_outliers_multiple<span class="sc">$</span>results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">`</span><span class="at">Robustness check</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Multiple outlier removal&quot;</span>,other_outliers_multiple<span class="sc">$</span>results)</span>
<span id="cb155-163"><a href="miscellaneous.html#cb155-163" tabindex="-1"></a>other_outliers_multiple<span class="sc">$</span>results</span>
<span id="cb155-164"><a href="miscellaneous.html#cb155-164" tabindex="-1"></a></span>
<span id="cb155-165"><a href="miscellaneous.html#cb155-165" tabindex="-1"></a><span class="do">### Target lower (80)</span></span>
<span id="cb155-166"><a href="miscellaneous.html#cb155-166" tabindex="-1"></a>name_plot <span class="ot">&lt;-</span> <span class="st">&quot;Target lower&quot;</span></span>
<span id="cb155-167"><a href="miscellaneous.html#cb155-167" tabindex="-1"></a>outliers <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb155-168"><a href="miscellaneous.html#cb155-168" tabindex="-1"></a>target_outcome <span class="ot">&lt;-</span> <span class="dv">80</span></span>
<span id="cb155-169"><a href="miscellaneous.html#cb155-169" tabindex="-1"></a>other_target_lower <span class="ot">&lt;-</span> <span class="fu">ncasem</span>(<span class="at">sem =</span> TAM_sem, <span class="at">sem_sig =</span> TAM_sig, <span class="at">outliers =</span> outliers, <span class="at">standardize =</span> standardize,</span>
<span id="cb155-170"><a href="miscellaneous.html#cb155-170" tabindex="-1"></a>                             <span class="at">normalize =</span> normalize, <span class="at">scale =</span> scale, <span class="at">predictors =</span> predictors,</span>
<span id="cb155-171"><a href="miscellaneous.html#cb155-171" tabindex="-1"></a>                             <span class="at">predicted =</span> predicted, <span class="at">corner =</span> corner, <span class="at">theoretical_min =</span> theoretical_min,</span>
<span id="cb155-172"><a href="miscellaneous.html#cb155-172" tabindex="-1"></a>                             <span class="at">theoretical_max =</span> theoretical_max, <span class="at">ceiling =</span> ceiling, </span>
<span id="cb155-173"><a href="miscellaneous.html#cb155-173" tabindex="-1"></a>                             <span class="at">test.rep =</span> test.rep, <span class="at">d_threshold =</span> d_threshold, </span>
<span id="cb155-174"><a href="miscellaneous.html#cb155-174" tabindex="-1"></a>                             <span class="at">p_threshold =</span> p_threshold, <span class="at">scope =</span> scope, </span>
<span id="cb155-175"><a href="miscellaneous.html#cb155-175" tabindex="-1"></a>                             <span class="at">target_outcome =</span> target_outcome, <span class="at">plots =</span> plots, <span class="at">name_plot =</span> name_plot</span>
<span id="cb155-176"><a href="miscellaneous.html#cb155-176" tabindex="-1"></a>                             )</span>
<span id="cb155-177"><a href="miscellaneous.html#cb155-177" tabindex="-1"></a>other_target_lower<span class="sc">$</span>results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">`</span><span class="at">Robustness check</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Target lower&quot;</span>, other_target_lower<span class="sc">$</span>results)</span>
<span id="cb155-178"><a href="miscellaneous.html#cb155-178" tabindex="-1"></a>other_target_lower<span class="sc">$</span>results</span>
<span id="cb155-179"><a href="miscellaneous.html#cb155-179" tabindex="-1"></a></span>
<span id="cb155-180"><a href="miscellaneous.html#cb155-180" tabindex="-1"></a><span class="do">### Target higher (90)</span></span>
<span id="cb155-181"><a href="miscellaneous.html#cb155-181" tabindex="-1"></a>name_plot <span class="ot">&lt;-</span> <span class="st">&quot;Target higher&quot;</span></span>
<span id="cb155-182"><a href="miscellaneous.html#cb155-182" tabindex="-1"></a>target_outcome <span class="ot">&lt;-</span> <span class="dv">90</span></span>
<span id="cb155-183"><a href="miscellaneous.html#cb155-183" tabindex="-1"></a>other_target_higher <span class="ot">&lt;-</span> <span class="fu">ncasem</span>(<span class="at">sem =</span> TAM_sem, <span class="at">sem_sig =</span> TAM_sig, <span class="at">outliers =</span> outliers, <span class="at">standardize =</span> standardize,</span>
<span id="cb155-184"><a href="miscellaneous.html#cb155-184" tabindex="-1"></a>                              <span class="at">normalize =</span> normalize, <span class="at">scale =</span> scale, <span class="at">predictors =</span> predictors,</span>
<span id="cb155-185"><a href="miscellaneous.html#cb155-185" tabindex="-1"></a>                              <span class="at">predicted =</span> predicted, <span class="at">corner =</span> corner, <span class="at">theoretical_min =</span> theoretical_min,</span>
<span id="cb155-186"><a href="miscellaneous.html#cb155-186" tabindex="-1"></a>                              <span class="at">theoretical_max =</span> theoretical_max, <span class="at">ceiling =</span> ceiling, </span>
<span id="cb155-187"><a href="miscellaneous.html#cb155-187" tabindex="-1"></a>                              <span class="at">test.rep =</span> test.rep, <span class="at">d_threshold =</span> d_threshold, </span>
<span id="cb155-188"><a href="miscellaneous.html#cb155-188" tabindex="-1"></a>                              <span class="at">p_threshold =</span> p_threshold, <span class="at">scope =</span> scope, </span>
<span id="cb155-189"><a href="miscellaneous.html#cb155-189" tabindex="-1"></a>                              <span class="at">target_outcome =</span> target_outcome, <span class="at">plots =</span> plots, <span class="at">name_plot =</span> name_plot</span>
<span id="cb155-190"><a href="miscellaneous.html#cb155-190" tabindex="-1"></a>                              )</span>
<span id="cb155-191"><a href="miscellaneous.html#cb155-191" tabindex="-1"></a>other_target_higher<span class="sc">$</span>results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">`</span><span class="at">Robustness check</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Target higher&quot;</span>, other_target_higher<span class="sc">$</span>results)</span>
<span id="cb155-192"><a href="miscellaneous.html#cb155-192" tabindex="-1"></a>other_target_higher<span class="sc">$</span>results</span>
<span id="cb155-193"><a href="miscellaneous.html#cb155-193" tabindex="-1"></a></span>
<span id="cb155-194"><a href="miscellaneous.html#cb155-194" tabindex="-1"></a>results_all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(original<span class="sc">$</span>results,</span>
<span id="cb155-195"><a href="miscellaneous.html#cb155-195" tabindex="-1"></a>                     other_ceiling<span class="sc">$</span>results,</span>
<span id="cb155-196"><a href="miscellaneous.html#cb155-196" tabindex="-1"></a>                     other_d<span class="sc">$</span>results,</span>
<span id="cb155-197"><a href="miscellaneous.html#cb155-197" tabindex="-1"></a>                     other_p<span class="sc">$</span>results,</span>
<span id="cb155-198"><a href="miscellaneous.html#cb155-198" tabindex="-1"></a>                     other_scope<span class="sc">$</span>results, </span>
<span id="cb155-199"><a href="miscellaneous.html#cb155-199" tabindex="-1"></a>                     other_outliers_single<span class="sc">$</span>results,</span>
<span id="cb155-200"><a href="miscellaneous.html#cb155-200" tabindex="-1"></a>                     other_outliers_multiple<span class="sc">$</span>results,</span>
<span id="cb155-201"><a href="miscellaneous.html#cb155-201" tabindex="-1"></a>                     other_target_lower<span class="sc">$</span>results,</span>
<span id="cb155-202"><a href="miscellaneous.html#cb155-202" tabindex="-1"></a>                     other_target_higher<span class="sc">$</span>results)</span>
<span id="cb155-203"><a href="miscellaneous.html#cb155-203" tabindex="-1"></a></span>
<span id="cb155-204"><a href="miscellaneous.html#cb155-204" tabindex="-1"></a>results_all <span class="ot">&lt;-</span> results_all[<span class="fu">c</span>(<span class="st">&quot;Predictor&quot;</span>,</span>
<span id="cb155-205"><a href="miscellaneous.html#cb155-205" tabindex="-1"></a>                             <span class="st">&quot;Robustness check&quot;</span>,</span>
<span id="cb155-206"><a href="miscellaneous.html#cb155-206" tabindex="-1"></a>                             <span class="st">&quot;Effect size&quot;</span>,</span>
<span id="cb155-207"><a href="miscellaneous.html#cb155-207" tabindex="-1"></a>                             <span class="st">&quot;p value&quot;</span>,</span>
<span id="cb155-208"><a href="miscellaneous.html#cb155-208" tabindex="-1"></a>                             <span class="st">&quot;Necessity&quot;</span>,</span>
<span id="cb155-209"><a href="miscellaneous.html#cb155-209" tabindex="-1"></a>                             <span class="st">&quot;Single bottlenecks(%)&quot;</span>,</span>
<span id="cb155-210"><a href="miscellaneous.html#cb155-210" tabindex="-1"></a>                             <span class="st">&quot;Single bottlenecks(#)&quot;</span>,</span>
<span id="cb155-211"><a href="miscellaneous.html#cb155-211" tabindex="-1"></a>                             <span class="st">&quot;Priority&quot;</span></span>
<span id="cb155-212"><a href="miscellaneous.html#cb155-212" tabindex="-1"></a>                             )]</span>
<span id="cb155-213"><a href="miscellaneous.html#cb155-213" tabindex="-1"></a></span>
<span id="cb155-214"><a href="miscellaneous.html#cb155-214" tabindex="-1"></a><span class="co"># View </span></span>
<span id="cb155-215"><a href="miscellaneous.html#cb155-215" tabindex="-1"></a><span class="fu">print</span>(results_all)</span>
<span id="cb155-216"><a href="miscellaneous.html#cb155-216" tabindex="-1"></a></span>
<span id="cb155-217"><a href="miscellaneous.html#cb155-217" tabindex="-1"></a><span class="co"># Reorganize the dataframe into new blocks</span></span>
<span id="cb155-218"><a href="miscellaneous.html#cb155-218" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(predictors) <span class="co"># Block size</span></span>
<span id="cb155-219"><a href="miscellaneous.html#cb155-219" tabindex="-1"></a>rows_per_block <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, n) <span class="co"># Sequence of row indices in one block</span></span>
<span id="cb155-220"><a href="miscellaneous.html#cb155-220" tabindex="-1"></a></span>
<span id="cb155-221"><a href="miscellaneous.html#cb155-221" tabindex="-1"></a><span class="co"># Create a new column to assign new block numbers</span></span>
<span id="cb155-222"><a href="miscellaneous.html#cb155-222" tabindex="-1"></a>results_all<span class="sc">$</span>NewBlock <span class="ot">&lt;-</span> <span class="fu">rep</span>(rows_per_block, <span class="at">length.out =</span> <span class="fu">nrow</span>(results_all))</span>
<span id="cb155-223"><a href="miscellaneous.html#cb155-223" tabindex="-1"></a></span>
<span id="cb155-224"><a href="miscellaneous.html#cb155-224" tabindex="-1"></a><span class="co"># Split the dataframe into blocks and combine the blocks sequentially</span></span>
<span id="cb155-225"><a href="miscellaneous.html#cb155-225" tabindex="-1"></a>reorganized_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(rows_per_block, <span class="cf">function</span>(i) {</span>
<span id="cb155-226"><a href="miscellaneous.html#cb155-226" tabindex="-1"></a>  results_all[results_all<span class="sc">$</span>NewBlock <span class="sc">==</span> i, ] <span class="co"># Subset rows for the current block</span></span>
<span id="cb155-227"><a href="miscellaneous.html#cb155-227" tabindex="-1"></a>}))</span>
<span id="cb155-228"><a href="miscellaneous.html#cb155-228" tabindex="-1"></a></span>
<span id="cb155-229"><a href="miscellaneous.html#cb155-229" tabindex="-1"></a><span class="co"># Remove the helper column and reset row names</span></span>
<span id="cb155-230"><a href="miscellaneous.html#cb155-230" tabindex="-1"></a>reorganized_df <span class="ot">&lt;-</span> reorganized_df[, <span class="sc">-</span><span class="fu">ncol</span>(reorganized_df)]</span>
<span id="cb155-231"><a href="miscellaneous.html#cb155-231" tabindex="-1"></a><span class="fu">row.names</span>(reorganized_df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb155-232"><a href="miscellaneous.html#cb155-232" tabindex="-1"></a></span>
<span id="cb155-233"><a href="miscellaneous.html#cb155-233" tabindex="-1"></a><span class="co"># View the reorganized dataframe</span></span>
<span id="cb155-234"><a href="miscellaneous.html#cb155-234" tabindex="-1"></a><span class="fu">print</span>(reorganized_df)</span>
<span id="cb155-235"><a href="miscellaneous.html#cb155-235" tabindex="-1"></a></span>
<span id="cb155-236"><a href="miscellaneous.html#cb155-236" tabindex="-1"></a><span class="co"># Save the robustness table</span></span>
<span id="cb155-237"><a href="miscellaneous.html#cb155-237" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb155-238"><a href="miscellaneous.html#cb155-238" tabindex="-1"></a><span class="co">#write.xlsx(reorganized_df, &quot;robustness_table_sem_TAM.xlsx&quot;, rowNames = FALSE)</span></span></code></pre></div>

</div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-dul2016orm" class="csl-entry">
Dul, J. (2016b). <span>Necessary Condition Analysis</span> (<span>NCA</span>): Logic and methodology of <span>“necessary but not sufficient”</span> causality. <em>Organizational Research Methods</em>, <em>19</em>(1), 10–52. <a href="https://doi.org/10.1177/1094428115584005">https://doi.org/10.1177/1094428115584005</a>
</div>
<div id="ref-ncar" class="csl-entry">
Dul, J., &amp; Buijs, G. (2026). <em>NCA</em> (Version 5.0.0). The Comprehensive R Archive Network. <a href="https://cran.r-project.org/web/packages/NCA/index.html">https://cran.r-project.org/web/packages/NCA/index.html</a>
</div>
<div id="ref-ncasmartpls" class="csl-entry">
SmartPLS Development Team. (2023). <em>SmartPLS</em> (Version 4). SmartPLS GmbH, Germany. <a href="https://www.smartpls.com/">https://www.smartpls.com/</a>
</div>
<div id="ref-ncastata" class="csl-entry">
Spinelli, D., Dul, J., &amp; Buijs, G. (2023). <em><span class="nocase">nca</span>: Stata module to perform necessary condition analysis <span>(NCA)</span></em> (Version 0.0.1). Statistical Software Components S459269, Boston College Department of Economics. <a href="https://ideas.repec.org/c/boc/bocode/s459269.html">https://ideas.repec.org/c/boc/bocode/s459269.html</a>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="statistical.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="glossary.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": true,
    "weibo": true,
    "instapaper": false,
    "vk": false,
    "whatsapp": true,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "serif",
    "size": 2
  },
  "edit": null,
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  },
  "info": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
